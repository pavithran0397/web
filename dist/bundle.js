/*! For license information please see bundle.js.LICENSE.txt */
(()=>{"use strict";var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}();const t=function(e){const t=[];let n=0;for(let s=0;s<e.length;s++){let i=e.charCodeAt(s);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296==(64512&i)&&s+1<e.length&&56320==(64512&e.charCodeAt(s+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++s)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},n={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let t=0;t<e.length;t+=3){const i=e[t],r=t+1<e.length,o=r?e[t+1]:0,a=t+2<e.length,l=a?e[t+2]:0,c=i>>2,u=(3&i)<<4|o>>4;let h=(15&o)<<2|l>>6,d=63&l;a||(d=64,r||(h=64)),s.push(n[c],n[u],n[h],n[d])}return s.join("")},encodeString(e,n){return this.HAS_NATIVE_SUPPORT&&!n?btoa(e):this.encodeByteArray(t(e),n)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,s=0;for(;n<e.length;){const i=e[n++];if(i<128)t[s++]=String.fromCharCode(i);else if(i>191&&i<224){const r=e[n++];t[s++]=String.fromCharCode((31&i)<<6|63&r)}else if(i>239&&i<365){const r=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[s++]=String.fromCharCode(55296+(r>>10)),t[s++]=String.fromCharCode(56320+(1023&r))}else{const r=e[n++],o=e[n++];t[s++]=String.fromCharCode((15&i)<<12|(63&r)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let t=0;t<e.length;){const r=n[e.charAt(t++)],o=t<e.length?n[e.charAt(t)]:0;++t;const a=t<e.length?n[e.charAt(t)]:64;++t;const l=t<e.length?n[e.charAt(t)]:64;if(++t,null==r||null==o||null==a||null==l)throw new s;const c=r<<2|o>>4;if(i.push(c),64!==a){const e=o<<4&240|a>>2;if(i.push(e),64!==l){const e=a<<6&192|l;i.push(e)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class s extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const i=function(e){return function(e){const s=t(e);return n.encodeByteArray(s,!0)}(e).replace(/\./g,"")},r=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==e.g)return e.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const e=process.env.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}const t=e&&function(e){try{return n.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null}(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},o=()=>{var e;return null===(e=r())||void 0===e?void 0:e.config};class a{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}class l extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,l.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,c.prototype.create)}}class c{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],r=i?function(e,t){return e.replace(u,((e,n)=>{const s=t[n];return null!=s?String(s):`<${n}?>`}))}(i,n):"Error",o=`${this.serviceName}: ${r} (${s}).`;return new l(s,o,n)}}const u=/\{\$([^}]+)}/g;function h(e,t){if(e===t)return!0;const n=Object.keys(e),s=Object.keys(t);for(const i of n){if(!s.includes(i))return!1;const n=e[i],r=t[i];if(d(n)&&d(r)){if(!h(n,r))return!1}else if(n!==r)return!1}for(const e of s)if(!n.includes(e))return!1;return!0}function d(e){return null!==e&&"object"==typeof e}function f(e){return e&&e._delegate?e._delegate:e}class g{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const m="[DEFAULT]";class p{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new a;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),s=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(s)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(s)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:m})}catch(e){}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=m){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(e=m){return this.instances.has(e)}getOptions(e=m){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(s);return s}onInit(e,t){var n;const s=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(s))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(s,i);const r=this.instances.get(s);return r&&e(r,s),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const s of n)try{s(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(s=e,s===m?void 0:s),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}var s;return n||null}normalizeInstanceIdentifier(e=m){return this.component?this.component.multipleInstances?e:m:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class y{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new p(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const v=[];var w,E;(E=w||(w={}))[E.DEBUG=0]="DEBUG",E[E.VERBOSE=1]="VERBOSE",E[E.INFO=2]="INFO",E[E.WARN=3]="WARN",E[E.ERROR=4]="ERROR",E[E.SILENT=5]="SILENT";const b={debug:w.DEBUG,verbose:w.VERBOSE,info:w.INFO,warn:w.WARN,error:w.ERROR,silent:w.SILENT},_=w.INFO,I={[w.DEBUG]:"log",[w.VERBOSE]:"log",[w.INFO]:"info",[w.WARN]:"warn",[w.ERROR]:"error"},S=(e,t,...n)=>{if(t<e.logLevel)return;const s=(new Date).toISOString(),i=I[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${s}]  ${e.name}:`,...n)};class T{constructor(e){this.name=e,this._logLevel=_,this._logHandler=S,this._userLogHandler=null,v.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in w))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?b[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,w.DEBUG,...e),this._logHandler(this,w.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,w.VERBOSE,...e),this._logHandler(this,w.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,w.INFO,...e),this._logHandler(this,w.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,w.WARN,...e),this._logHandler(this,w.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,w.ERROR,...e),this._logHandler(this,w.ERROR,...e)}}const C=(e,t)=>t.some((t=>e instanceof t));let k,A;const D=new WeakMap,N=new WeakMap,x=new WeakMap,L=new WeakMap,R=new WeakMap;let M={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return N.get(e);if("objectStoreNames"===t)return e.objectStoreNames||x.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return O(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function P(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(A||(A=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(F(this),e),O(D.get(this))}:function(...e){return O(t.apply(F(this),e))}:function(e,...n){const s=t.call(F(this),e,...n);return x.set(s,e.sort?e.sort():[e]),O(s)}:(e instanceof IDBTransaction&&function(e){if(N.has(e))return;const t=new Promise(((t,n)=>{const s=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",r),e.removeEventListener("abort",r)},i=()=>{t(),s()},r=()=>{n(e.error||new DOMException("AbortError","AbortError")),s()};e.addEventListener("complete",i),e.addEventListener("error",r),e.addEventListener("abort",r)}));N.set(e,t)}(e),C(e,k||(k=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,M):e);var t}function O(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const s=()=>{e.removeEventListener("success",i),e.removeEventListener("error",r)},i=()=>{t(O(e.result)),s()},r=()=>{n(e.error),s()};e.addEventListener("success",i),e.addEventListener("error",r)}));return t.then((t=>{t instanceof IDBCursor&&D.set(t,e)})).catch((()=>{})),R.set(t,e),t}(e);if(L.has(e))return L.get(e);const t=P(e);return t!==e&&(L.set(e,t),R.set(t,e)),t}const F=e=>R.get(e),V=["get","getKey","getAll","getAllKeys","count"],B=["put","add","delete","clear"],U=new Map;function q(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(U.get(t))return U.get(t);const n=t.replace(/FromIndex$/,""),s=t!==n,i=B.includes(n);if(!(n in(s?IDBIndex:IDBObjectStore).prototype)||!i&&!V.includes(n))return;const r=async function(e,...t){const r=this.transaction(e,i?"readwrite":"readonly");let o=r.store;return s&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),i&&r.done]))[0]};return U.set(t,r),r}var $;$=M,M={...$,get:(e,t,n)=>q(e,t)||$.get(e,t,n),has:(e,t)=>!!q(e,t)||$.has(e,t)};class j{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null})).filter((e=>e)).join(" ")}}const z="@firebase/app",H="0.9.15",K=new T("@firebase/app"),G="[DEFAULT]",Q={[z]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},W=new Map,X=new Map;function Y(e,t){try{e.container.addComponent(t)}catch(n){K.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function J(e){const t=e.name;if(X.has(t))return K.debug(`There were multiple attempts to register component ${t}.`),!1;X.set(t,e);for(const t of W.values())Y(t,e);return!0}const Z=new c("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class ee{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new g("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Z.create("app-deleted",{appName:this._name})}}function te(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});const s=Object.assign({name:G,automaticDataCollectionEnabled:!1},t),i=s.name;if("string"!=typeof i||!i)throw Z.create("bad-app-name",{appName:String(i)});if(n||(n=o()),!n)throw Z.create("no-options");const r=W.get(i);if(r){if(h(n,r.options)&&h(s,r.config))return r;throw Z.create("duplicate-app",{appName:i})}const a=new y(i);for(const e of X.values())a.addComponent(e);const l=new ee(n,s,a);return W.set(i,l),l}function ne(e,t,n){var s;let i=null!==(s=Q[e])&&void 0!==s?s:e;n&&(i+=`-${n}`);const r=i.match(/\s|\//),o=t.match(/\s|\//);if(r||o){const e=[`Unable to register library "${i}" with version "${t}":`];return r&&e.push(`library name "${i}" contains illegal characters (whitespace or "/")`),r&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void K.warn(e.join(" "))}J(new g(`${i}-version`,(()=>({library:i,version:t})),"VERSION"))}const se="firebase-heartbeat-database",ie=1,re="firebase-heartbeat-store";let oe=null;function ae(){return oe||(oe=function(e,t,{blocked:n,upgrade:s,blocking:i,terminated:r}={}){const o=indexedDB.open(e,t),a=O(o);return s&&o.addEventListener("upgradeneeded",(e=>{s(O(o.result),e.oldVersion,e.newVersion,O(o.transaction),e)})),n&&o.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),a.then((e=>{r&&e.addEventListener("close",(()=>r())),i&&e.addEventListener("versionchange",(e=>i(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),a}(se,ie,{upgrade:(e,t)=>{0===t&&e.createObjectStore(re)}}).catch((e=>{throw Z.create("idb-open",{originalErrorMessage:e.message})}))),oe}async function le(e,t){try{const n=(await ae()).transaction(re,"readwrite"),s=n.objectStore(re);await s.put(t,ce(e)),await n.done}catch(e){if(e instanceof l)K.warn(e.message);else{const t=Z.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});K.warn(t.message)}}}function ce(e){return`${e.name}!${e.options.appId}`}class ue{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new de(t),this._heartbeatsCachePromise=this._storage.read().then((e=>(this._heartbeatsCache=e,e)))}async triggerHeartbeat(){const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=he();if(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate!==t&&!this._heartbeatsCache.heartbeats.some((e=>e.date===t)))return this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";const e=he(),{heartbeatsToSend:t,unsentEntries:n}=function(e,t=1024){const n=[];let s=e.slice();for(const i of e){const e=n.find((e=>e.agent===i.agent));if(e){if(e.dates.push(i.date),fe(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),fe(n)>t){n.pop();break}s=s.slice(1)}return{heartbeatsToSend:n,unsentEntries:s}}(this._heartbeatsCache.heartbeats),s=i(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}}function he(){return(new Date).toISOString().substring(0,10)}class de{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!function(){try{return"object"==typeof indexedDB}catch(e){return!1}}()&&new Promise(((e,t)=>{try{let n=!0;const s="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(s);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(s),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}})).then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=await ae();return await t.transaction(re).objectStore(re).get(ce(e))}catch(e){if(e instanceof l)K.warn(e.message);else{const t=Z.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});K.warn(t.message)}}}(this.app);return e||{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return le(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return le(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function fe(e){return i(JSON.stringify({version:2,heartbeats:e})).length}J(new g("platform-logger",(e=>new j(e)),"PRIVATE")),J(new g("heartbeat",(e=>new ue(e)),"PRIVATE")),ne(z,H,""),ne(z,H,"esm2017"),ne("fire-js",""),ne("firebase","10.1.0","app");var ge,me="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},pe={},ye=ye||{},ve=me||self;function we(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function Ee(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var be="closure_uid_"+(1e9*Math.random()>>>0),_e=0;function Ie(e,t,n){return e.call.apply(e.bind,arguments)}function Se(e,t,n){if(!e)throw Error();if(2<arguments.length){var s=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,s),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function Te(e,t,n){return(Te=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Ie:Se).apply(null,arguments)}function Ce(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function ke(e,t){function n(){}n.prototype=t.prototype,e.$=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.ac=function(e,n,s){for(var i=Array(arguments.length-2),r=2;r<arguments.length;r++)i[r-2]=arguments[r];return t.prototype[n].apply(e,i)}}function Ae(){this.s=this.s,this.o=this.o}Ae.prototype.s=!1,Ae.prototype.sa=function(){var e;!this.s&&(this.s=!0,this.N(),0)&&(e=this,Object.prototype.hasOwnProperty.call(e,be)&&e[be]||(e[be]=++_e))},Ae.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const De=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1};function Ne(e){const t=e.length;if(0<t){const n=Array(t);for(let s=0;s<t;s++)n[s]=e[s];return n}return[]}function xe(e,t){for(let t=1;t<arguments.length;t++){const n=arguments[t];if(we(n)){const t=e.length||0,s=n.length||0;e.length=t+s;for(let i=0;i<s;i++)e[t+i]=n[i]}else e.push(n)}}function Le(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}Le.prototype.h=function(){this.defaultPrevented=!0};var Re=function(){if(!ve.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{ve.addEventListener("test",(()=>{}),t),ve.removeEventListener("test",(()=>{}),t)}catch(e){}return e}();function Me(e){return/^[\s\xa0]*$/.test(e)}function Pe(){var e=ve.navigator;return e&&(e=e.userAgent)?e:""}function Oe(e){return-1!=Pe().indexOf(e)}function Fe(e){return Fe[" "](e),e}Fe[" "]=function(){};var Ve,Be,Ue,qe=Oe("Opera"),$e=Oe("Trident")||Oe("MSIE"),je=Oe("Edge"),ze=je||$e,He=Oe("Gecko")&&!(-1!=Pe().toLowerCase().indexOf("webkit")&&!Oe("Edge"))&&!(Oe("Trident")||Oe("MSIE"))&&!Oe("Edge"),Ke=-1!=Pe().toLowerCase().indexOf("webkit")&&!Oe("Edge");function Ge(){var e=ve.document;return e?e.documentMode:void 0}e:{var Qe="",We=(Be=Pe(),He?/rv:([^\);]+)(\)|;)/.exec(Be):je?/Edge\/([\d\.]+)/.exec(Be):$e?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Be):Ke?/WebKit\/(\S+)/.exec(Be):qe?/(?:Version)[ \/]?(\S+)/.exec(Be):void 0);if(We&&(Qe=We?We[1]:""),$e){var Xe=Ge();if(null!=Xe&&Xe>parseFloat(Qe)){Ve=String(Xe);break e}}Ve=Qe}ve.document&&$e?Ue=Ge()||parseInt(Ve,10)||void 0:Ue=void 0;var Ye=Ue;function Je(e,t){if(Le.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,s=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(He){e:{try{Fe(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,s?(this.clientX=void 0!==s.clientX?s.clientX:s.pageX,this.clientY=void 0!==s.clientY?s.clientY:s.pageY,this.screenX=s.screenX||0,this.screenY=s.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:Ze[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&Je.$.h.call(this)}}ke(Je,Le);var Ze={2:"touch",3:"pen",4:"mouse"};Je.prototype.h=function(){Je.$.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var et="closure_listenable_"+(1e6*Math.random()|0),tt=0;function nt(e,t,n,s,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!s,this.la=i,this.key=++tt,this.fa=this.ia=!1}function st(e){e.fa=!0,e.listener=null,e.proxy=null,e.src=null,e.la=null}function it(e,t,n){for(const s in e)t.call(n,e[s],s,e)}function rt(e){const t={};for(const n in e)t[n]=e[n];return t}const ot="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function at(e,t){let n,s;for(let t=1;t<arguments.length;t++){for(n in s=arguments[t],s)e[n]=s[n];for(let t=0;t<ot.length;t++)n=ot[t],Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n])}}function lt(e){this.src=e,this.g={},this.h=0}function ct(e,t){var n=t.type;if(n in e.g){var s,i=e.g[n],r=De(i,t);(s=0<=r)&&Array.prototype.splice.call(i,r,1),s&&(st(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function ut(e,t,n,s){for(var i=0;i<e.length;++i){var r=e[i];if(!r.fa&&r.listener==t&&r.capture==!!n&&r.la==s)return i}return-1}lt.prototype.add=function(e,t,n,s,i){var r=e.toString();(e=this.g[r])||(e=this.g[r]=[],this.h++);var o=ut(e,t,s,i);return-1<o?(t=e[o],n||(t.ia=!1)):((t=new nt(t,this.src,r,!!s,i)).ia=n,e.push(t)),t};var ht="closure_lm_"+(1e6*Math.random()|0),dt={};function ft(e,t,n,s,i){if(s&&s.once)return mt(e,t,n,s,i);if(Array.isArray(t)){for(var r=0;r<t.length;r++)ft(e,t[r],n,s,i);return null}return n=_t(n),e&&e[et]?e.O(t,n,Ee(s)?!!s.capture:!!s,i):gt(e,t,n,!1,s,i)}function gt(e,t,n,s,i,r){if(!t)throw Error("Invalid event type");var o=Ee(i)?!!i.capture:!!i,a=Et(e);if(a||(e[ht]=a=new lt(e)),(n=a.add(t,n,s,o,r)).proxy)return n;if(s=function(){const e=wt;return function t(n){return e.call(t.src,t.listener,n)}}(),n.proxy=s,s.src=e,s.listener=n,e.addEventListener)Re||(i=o),void 0===i&&(i=!1),e.addEventListener(t.toString(),s,i);else if(e.attachEvent)e.attachEvent(vt(t.toString()),s);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(s)}return n}function mt(e,t,n,s,i){if(Array.isArray(t)){for(var r=0;r<t.length;r++)mt(e,t[r],n,s,i);return null}return n=_t(n),e&&e[et]?e.P(t,n,Ee(s)?!!s.capture:!!s,i):gt(e,t,n,!0,s,i)}function pt(e,t,n,s,i){if(Array.isArray(t))for(var r=0;r<t.length;r++)pt(e,t[r],n,s,i);else s=Ee(s)?!!s.capture:!!s,n=_t(n),e&&e[et]?(e=e.i,(t=String(t).toString())in e.g&&-1<(n=ut(r=e.g[t],n,s,i))&&(st(r[n]),Array.prototype.splice.call(r,n,1),0==r.length&&(delete e.g[t],e.h--))):e&&(e=Et(e))&&(t=e.g[t.toString()],e=-1,t&&(e=ut(t,n,s,i)),(n=-1<e?t[e]:null)&&yt(n))}function yt(e){if("number"!=typeof e&&e&&!e.fa){var t=e.src;if(t&&t[et])ct(t.i,e);else{var n=e.type,s=e.proxy;t.removeEventListener?t.removeEventListener(n,s,e.capture):t.detachEvent?t.detachEvent(vt(n),s):t.addListener&&t.removeListener&&t.removeListener(s),(n=Et(t))?(ct(n,e),0==n.h&&(n.src=null,t[ht]=null)):st(e)}}}function vt(e){return e in dt?dt[e]:dt[e]="on"+e}function wt(e,t){if(e.fa)e=!0;else{t=new Je(t,this);var n=e.listener,s=e.la||e.src;e.ia&&yt(e),e=n.call(s,t)}return e}function Et(e){return(e=e[ht])instanceof lt?e:null}var bt="__closure_events_fn_"+(1e9*Math.random()>>>0);function _t(e){return"function"==typeof e?e:(e[bt]||(e[bt]=function(t){return e.handleEvent(t)}),e[bt])}function It(){Ae.call(this),this.i=new lt(this),this.S=this,this.J=null}function St(e,t){var n,s=e.J;if(s)for(n=[];s;s=s.J)n.push(s);if(e=e.S,s=t.type||t,"string"==typeof t)t=new Le(t,e);else if(t instanceof Le)t.target=t.target||e;else{var i=t;at(t=new Le(s,e),i)}if(i=!0,n)for(var r=n.length-1;0<=r;r--){var o=t.g=n[r];i=Tt(o,s,!0,t)&&i}if(i=Tt(o=t.g=e,s,!0,t)&&i,i=Tt(o,s,!1,t)&&i,n)for(r=0;r<n.length;r++)i=Tt(o=t.g=n[r],s,!1,t)&&i}function Tt(e,t,n,s){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,r=0;r<t.length;++r){var o=t[r];if(o&&!o.fa&&o.capture==n){var a=o.listener,l=o.la||o.src;o.ia&&ct(e.i,o),i=!1!==a.call(l,s)&&i}}return i&&!s.defaultPrevented}ke(It,Ae),It.prototype[et]=!0,It.prototype.removeEventListener=function(e,t,n,s){pt(this,e,t,n,s)},It.prototype.N=function(){if(It.$.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],s=0;s<n.length;s++)st(n[s]);delete t.g[e],t.h--}}this.J=null},It.prototype.O=function(e,t,n,s){return this.i.add(String(e),t,!1,n,s)},It.prototype.P=function(e,t,n,s){return this.i.add(String(e),t,!0,n,s)};var Ct=ve.JSON.stringify;function kt(){var e=Mt;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var At=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}((()=>new Dt),(e=>e.reset()));class Dt{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function Nt(e){var t=1;e=e.split(":");const n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function xt(e){ve.setTimeout((()=>{throw e}),0)}let Lt,Rt=!1,Mt=new class{constructor(){this.h=this.g=null}add(e,t){const n=At.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},Pt=()=>{const e=ve.Promise.resolve(void 0);Lt=()=>{e.then(Ot)}};var Ot=()=>{for(var e;e=kt();){try{e.h.call(e.g)}catch(e){xt(e)}var t=At;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}Rt=!1};function Ft(e,t){It.call(this),this.h=e||1,this.g=t||ve,this.j=Te(this.qb,this),this.l=Date.now()}function Vt(e){e.ga=!1,e.T&&(e.g.clearTimeout(e.T),e.T=null)}function Bt(e,t,n){if("function"==typeof e)n&&(e=Te(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=Te(e.handleEvent,e)}return 2147483647<Number(t)?-1:ve.setTimeout(e,t||0)}function Ut(e){e.g=Bt((()=>{e.g=null,e.i&&(e.i=!1,Ut(e))}),e.j);const t=e.h;e.h=null,e.m.apply(null,t)}ke(Ft,It),(ge=Ft.prototype).ga=!1,ge.T=null,ge.qb=function(){if(this.ga){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-e):(this.T&&(this.g.clearTimeout(this.T),this.T=null),St(this,"tick"),this.ga&&(Vt(this),this.start()))}},ge.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},ge.N=function(){Ft.$.N.call(this),Vt(this),delete this.g};class qt extends Ae{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:Ut(this)}N(){super.N(),this.g&&(ve.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function $t(e){Ae.call(this),this.h=e,this.g={}}ke($t,Ae);var jt=[];function zt(e,t,n,s){Array.isArray(n)||(n&&(jt[0]=n.toString()),n=jt);for(var i=0;i<n.length;i++){var r=ft(t,n[i],s||e.handleEvent,!1,e.h||e);if(!r)break;e.g[r.key]=r}}function Ht(e){it(e.g,(function(e,t){this.g.hasOwnProperty(t)&&yt(e)}),e),e.g={}}function Kt(){this.g=!0}function Gt(e,t,n,s){e.info((function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var s=n[e];if(!(2>s.length)){var i=s[1];if(Array.isArray(i)&&!(1>i.length)){var r=i[0];if("noop"!=r&&"stop"!=r&&"close"!=r)for(var o=1;o<i.length;o++)i[o]=""}}}return Ct(n)}catch(e){return t}}(e,n)+(s?" "+s:"")}))}$t.prototype.N=function(){$t.$.N.call(this),Ht(this)},$t.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Kt.prototype.Ea=function(){this.g=!1},Kt.prototype.info=function(){};var Qt={},Wt=null;function Xt(){return Wt=Wt||new It}function Yt(e){Le.call(this,Qt.Ta,e)}function Jt(e){const t=Xt();St(t,new Yt(t))}function Zt(e,t){Le.call(this,Qt.STAT_EVENT,e),this.stat=t}function en(e){const t=Xt();St(t,new Zt(t,e))}function tn(e,t){Le.call(this,Qt.Ua,e),this.size=t}function nn(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return ve.setTimeout((function(){e()}),t)}Qt.Ta="serverreachability",ke(Yt,Le),Qt.STAT_EVENT="statevent",ke(Zt,Le),Qt.Ua="timingevent",ke(tn,Le);var sn={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},rn={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function on(){}function an(e){return e.h||(e.h=e.i())}function ln(){}on.prototype.h=null;var cn,un={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function hn(){Le.call(this,"d")}function dn(){Le.call(this,"c")}function fn(){}function gn(e,t,n,s){this.l=e,this.j=t,this.m=n,this.W=s||1,this.U=new $t(this),this.P=pn,e=ze?125:void 0,this.V=new Ft(e),this.I=null,this.i=!1,this.s=this.A=this.v=this.L=this.G=this.Y=this.B=null,this.F=[],this.g=null,this.C=0,this.o=this.u=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new mn}function mn(){this.i=null,this.g="",this.h=!1}ke(hn,Le),ke(dn,Le),ke(fn,on),fn.prototype.g=function(){return new XMLHttpRequest},fn.prototype.i=function(){return{}},cn=new fn;var pn=45e3,yn={},vn={};function wn(e,t,n){e.L=1,e.v=Vn(Rn(t)),e.s=n,e.S=!0,En(e,null)}function En(e,t){e.G=Date.now(),Sn(e),e.A=Rn(e.v);var n=e.A,s=e.W;Array.isArray(s)||(s=[String(s)]),Yn(n.i,"t",s),e.C=0,n=e.l.J,e.h=new mn,e.g=Xs(e.l,n?t:null,!e.s),0<e.O&&(e.M=new qt(Te(e.Pa,e,e.g),e.O)),zt(e.U,e.g,"readystatechange",e.nb),t=e.I?rt(e.I):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ha(e.A,e.u,e.s,t)):(e.u="GET",e.g.ha(e.A,e.u,null,t)),Jt(),function(e,t,n,s,i,r){e.info((function(){if(e.g)if(r)for(var o="",a=r.split("&"),l=0;l<a.length;l++){var c=a[l].split("=");if(1<c.length){var u=c[0];c=c[1];var h=u.split("_");o=2<=h.length&&"type"==h[1]?o+(u+"=")+c+"&":o+(u+"=redacted&")}}else o=null;else o=r;return"XMLHTTP REQ ("+s+") [attempt "+i+"]: "+t+"\n"+n+"\n"+o}))}(e.j,e.u,e.A,e.m,e.W,e.s)}function bn(e){return!!e.g&&"GET"==e.u&&2!=e.L&&e.l.Ha}function _n(e,t,n){let s,i=!0;for(;!e.J&&e.C<n.length;){if(s=In(e,n),s==vn){4==t&&(e.o=4,en(14),i=!1),Gt(e.j,e.m,null,"[Incomplete Response]");break}if(s==yn){e.o=4,en(15),Gt(e.j,e.m,n,"[Invalid Chunk]"),i=!1;break}Gt(e.j,e.m,s,null),Dn(e,s)}bn(e)&&s!=vn&&s!=yn&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,en(16),i=!1),e.i=e.i&&i,i?0<n.length&&!e.ba&&(e.ba=!0,(t=e.l).g==e&&t.ca&&!t.M&&(t.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),$s(t),t.M=!0,en(11))):(Gt(e.j,e.m,n,"[Invalid Chunked Response]"),An(e),kn(e))}function In(e,t){var n=e.C,s=t.indexOf("\n",n);return-1==s?vn:(n=Number(t.substring(n,s)),isNaN(n)?yn:(s+=1)+n>t.length?vn:(t=t.slice(s,s+n),e.C=s+n,t))}function Sn(e){e.Y=Date.now()+e.P,Tn(e,e.P)}function Tn(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=nn(Te(e.lb,e),t)}function Cn(e){e.B&&(ve.clearTimeout(e.B),e.B=null)}function kn(e){0==e.l.H||e.J||Hs(e.l,e)}function An(e){Cn(e);var t=e.M;t&&"function"==typeof t.sa&&t.sa(),e.M=null,Vt(e.V),Ht(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.sa())}function Dn(e,t){try{var n=e.l;if(0!=n.H&&(n.g==e||ss(n.i,e)))if(!e.K&&ss(n.i,e)&&3==n.H){try{var s=n.Ja.g.parse(t)}catch(e){s=null}if(Array.isArray(s)&&3==s.length){var i=s;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.G+3e3<e.G))break e;zs(n),Ms(n)}qs(n),en(18)}}else n.Fa=i[1],0<n.Fa-n.V&&37500>i[2]&&n.G&&0==n.A&&!n.v&&(n.v=nn(Te(n.ib,n),6e3));if(1>=ns(n.i)&&n.oa){try{n.oa()}catch(e){}n.oa=void 0}}else Gs(n,11)}else if((e.K||n.g==e)&&zs(n),!Me(t))for(i=n.Ja.g.parse(t),t=0;t<i.length;t++){let c=i[t];if(n.V=c[0],c=c[1],2==n.H)if("c"==c[0]){n.K=c[1],n.pa=c[2];const t=c[3];null!=t&&(n.ra=t,n.l.info("VER="+n.ra));const i=c[4];null!=i&&(n.Ga=i,n.l.info("SVER="+n.Ga));const u=c[5];null!=u&&"number"==typeof u&&0<u&&(s=1.5*u,n.L=s,n.l.info("backChannelRequestTimeoutMs_="+s)),s=n;const h=e.g;if(h){const e=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var r=s.i;r.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(r.j=r.l,r.g=new Set,r.h&&(is(r,r.h),r.h=null))}if(s.F){const e=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(s.Da=e,Fn(s.I,s.F,e))}}n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-e.G,n.l.info("Handshake RTT: "+n.S+"ms"));var o=e;if((s=n).wa=Ws(s,s.J?s.pa:null,s.Y),o.K){rs(s.i,o);var a=o,l=s.L;l&&a.setTimeout(l),a.B&&(Cn(a),Sn(a)),s.g=o}else Us(s);0<n.j.length&&Os(n)}else"stop"!=c[0]&&"close"!=c[0]||Gs(n,7);else 3==n.H&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?Gs(n,7):Rs(n):"noop"!=c[0]&&n.h&&n.h.Aa(c),n.A=0)}Jt()}catch(e){}}function Nn(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(we(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.ta&&"function"==typeof e.ta)return e.ta();if(!e.Z||"function"!=typeof e.Z){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(we(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const s in e)t[n++]=s;return t}}}(e),s=function(e){if(e.Z&&"function"==typeof e.Z)return e.Z();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(we(e)){for(var t=[],n=e.length,s=0;s<n;s++)t.push(e[s]);return t}for(s in t=[],n=0,e)t[n++]=e[s];return t}(e),i=s.length,r=0;r<i;r++)t.call(void 0,s[r],n&&n[r],e)}(ge=gn.prototype).setTimeout=function(e){this.P=e},ge.nb=function(e){e=e.target;const t=this.M;t&&3==ks(e)?t.l():this.Pa(e)},ge.Pa=function(e){try{if(e==this.g)e:{const u=ks(this.g);var t=this.g.Ia();if(this.g.da(),!(3>u)&&(3!=u||ze||this.g&&(this.h.h||this.g.ja()||As(this.g)))){this.J||4!=u||7==t||Jt(),Cn(this);var n=this.g.da();this.ca=n;t:if(bn(this)){var s=As(this.g);e="";var i=s.length,r=4==ks(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){An(this),kn(this);var o="";break t}this.h.i=new ve.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(s[t],{stream:r&&t==i-1});s.splice(0,i),this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.ja();if(this.i=200==n,function(e,t,n,s,i,r,o){e.info((function(){return"XMLHTTP RESP ("+s+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+r+" "+o}))}(this.j,this.u,this.A,this.m,this.W,u,n),this.i){if(this.aa&&!this.K){t:{if(this.g){var a,l=this.g;if((a=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Me(a)){var c=a;break t}}c=null}if(!(n=c)){this.i=!1,this.o=3,en(12),An(this),kn(this);break e}Gt(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Dn(this,n)}this.S?(_n(this,u,o),ze&&this.i&&3==u&&(zt(this.U,this.V,"tick",this.mb),this.V.start())):(Gt(this.j,this.m,o,null),Dn(this,o)),4==u&&An(this),this.i&&!this.J&&(4==u?Hs(this.l,this):(this.i=!1,Sn(this)))}else(function(e){const t={};e=(e.g&&2<=ks(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let s=0;s<e.length;s++){if(Me(e[s]))continue;var n=Nt(e[s]);const i=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const r=t[i]||[];t[i]=r,r.push(n)}!function(e,t){for(const n in e)t.call(void 0,e[n],n,e)}(t,(function(e){return e.join(", ")}))})(this.g),400==n&&0<o.indexOf("Unknown SID")?(this.o=3,en(12)):(this.o=0,en(13)),An(this),kn(this)}}}catch(e){}},ge.mb=function(){if(this.g){var e=ks(this.g),t=this.g.ja();this.C<t.length&&(Cn(this),_n(this,e,t),this.i&&4!=e&&Sn(this))}},ge.cancel=function(){this.J=!0,An(this)},ge.lb=function(){this.B=null;const e=Date.now();0<=e-this.Y?(function(e,t){e.info((function(){return"TIMEOUT: "+t}))}(this.j,this.A),2!=this.L&&(Jt(),en(17)),An(this),this.o=2,kn(this)):Tn(this,this.Y-e)};var xn=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Ln(e){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,e instanceof Ln){this.h=e.h,Mn(this,e.j),this.s=e.s,this.g=e.g,Pn(this,e.m),this.l=e.l;var t=e.i,n=new Gn;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),On(this,n),this.o=e.o}else e&&(t=String(e).match(xn))?(this.h=!1,Mn(this,t[1]||"",!0),this.s=Bn(t[2]||""),this.g=Bn(t[3]||"",!0),Pn(this,t[4]),this.l=Bn(t[5]||"",!0),On(this,t[6]||"",!0),this.o=Bn(t[7]||"")):(this.h=!1,this.i=new Gn(null,this.h))}function Rn(e){return new Ln(e)}function Mn(e,t,n){e.j=n?Bn(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function Pn(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function On(e,t,n){t instanceof Gn?(e.i=t,function(e,t){t&&!e.j&&(Qn(e),e.i=null,e.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(Wn(this,t),Yn(this,n,e))}),e)),e.j=t}(e.i,e.h)):(n||(t=Un(t,Hn)),e.i=new Gn(t,e.h))}function Fn(e,t,n){e.i.set(t,n)}function Vn(e){return Fn(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function Bn(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function Un(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,qn),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function qn(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}Ln.prototype.toString=function(){var e=[],t=this.j;t&&e.push(Un(t,$n,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.s)&&e.push(Un(t,$n,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(Un(n,"/"==n.charAt(0)?zn:jn,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.o)&&e.push("#",Un(n,Kn)),e.join("")};var $n=/[#\/\?@]/g,jn=/[#\?:]/g,zn=/[#\?]/g,Hn=/[#\?@]/g,Kn=/#/g;function Gn(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function Qn(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var s=e[n].indexOf("="),i=null;if(0<=s){var r=e[n].substring(0,s);i=e[n].substring(s+1)}else r=e[n];t(r,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function Wn(e,t){Qn(e),t=Jn(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function Xn(e,t){return Qn(e),t=Jn(e,t),e.g.has(t)}function Yn(e,t,n){Wn(e,t),0<n.length&&(e.i=null,e.g.set(Jn(e,t),Ne(n)),e.h+=n.length)}function Jn(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function Zn(e){this.l=e||es,e=ve.PerformanceNavigationTiming?0<(e=ve.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(ve.g&&ve.g.Ka&&ve.g.Ka()&&ve.g.Ka().ec),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(ge=Gn.prototype).add=function(e,t){Qn(this),this.i=null,e=Jn(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},ge.forEach=function(e,t){Qn(this),this.g.forEach((function(n,s){n.forEach((function(n){e.call(t,n,s,this)}),this)}),this)},ge.ta=function(){Qn(this);const e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let s=0;s<t.length;s++){const i=e[s];for(let e=0;e<i.length;e++)n.push(t[s])}return n},ge.Z=function(e){Qn(this);let t=[];if("string"==typeof e)Xn(this,e)&&(t=t.concat(this.g.get(Jn(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},ge.set=function(e,t){return Qn(this),this.i=null,Xn(this,e=Jn(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},ge.get=function(e,t){return e&&0<(e=this.Z(e)).length?String(e[0]):t},ge.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var s=t[n];const r=encodeURIComponent(String(s)),o=this.Z(s);for(s=0;s<o.length;s++){var i=r;""!==o[s]&&(i+="="+encodeURIComponent(String(o[s]))),e.push(i)}}return this.i=e.join("&")};var es=10;function ts(e){return!!e.h||!!e.g&&e.g.size>=e.j}function ns(e){return e.h?1:e.g?e.g.size:0}function ss(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function is(e,t){e.g?e.g.add(t):e.h=t}function rs(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function os(e){if(null!=e.h)return e.i.concat(e.h.F);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.F);return t}return Ne(e.i)}Zn.prototype.cancel=function(){if(this.i=os(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var as=class{stringify(e){return ve.JSON.stringify(e,void 0)}parse(e){return ve.JSON.parse(e,void 0)}};function ls(){this.g=new as}function cs(e,t,n){const s=n||"";try{Nn(e,(function(e,n){let i=e;Ee(e)&&(i=Ct(e)),t.push(s+n+"="+encodeURIComponent(i))}))}catch(e){throw t.push(s+"type="+encodeURIComponent("_badmap")),e}}function us(e,t,n,s,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(s)}catch(e){}}function hs(e){this.l=e.fc||null,this.j=e.ob||!1}function ds(e,t){It.call(this),this.F=e,this.u=t,this.m=void 0,this.readyState=fs,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}ke(hs,on),hs.prototype.g=function(){return new ds(this.l,this.j)},hs.prototype.i=function(e){return function(){return e}}({}),ke(ds,It);var fs=0;function gs(e){e.j.read().then(e.Xa.bind(e)).catch(e.ka.bind(e))}function ms(e){e.readyState=4,e.l=null,e.j=null,e.A=null,ps(e)}function ps(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(ge=ds.prototype).open=function(e,t){if(this.readyState!=fs)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,ps(this)},ge.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.F||ve).fetch(new Request(this.B,t)).then(this.$a.bind(this),this.ka.bind(this))},ge.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,ms(this)),this.readyState=fs},ge.$a=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,ps(this)),this.g&&(this.readyState=3,ps(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(void 0!==ve.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;gs(this)}else e.text().then(this.Za.bind(this),this.ka.bind(this))},ge.Xa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?ms(this):ps(this),3==this.readyState&&gs(this)}},ge.Za=function(e){this.g&&(this.response=this.responseText=e,ms(this))},ge.Ya=function(e){this.g&&(this.response=e,ms(this))},ge.ka=function(){this.g&&ms(this)},ge.setRequestHeader=function(e,t){this.v.append(e,t)},ge.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},ge.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(ds.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var ys=ve.JSON.parse;function vs(e){It.call(this),this.headers=new Map,this.u=e||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=ws,this.L=this.M=!1}ke(vs,It);var ws="",Es=/^https?$/i,bs=["POST","PUT"];function _s(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,Is(e),Ts(e)}function Is(e){e.F||(e.F=!0,St(e,"complete"),St(e,"error"))}function Ss(e){if(e.h&&void 0!==ye&&(!e.C[1]||4!=ks(e)||2!=e.da()))if(e.v&&4==ks(e))Bt(e.La,0,e);else if(St(e,"readystatechange"),4==ks(e)){e.h=!1;try{const o=e.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var s;if(s=0===o){var i=String(e.I).match(xn)[1]||null;!i&&ve.self&&ve.self.location&&(i=ve.self.location.protocol.slice(0,-1)),s=!Es.test(i?i.toLowerCase():"")}n=s}if(n)St(e,"complete"),St(e,"success");else{e.m=6;try{var r=2<ks(e)?e.g.statusText:""}catch(e){r=""}e.j=r+" ["+e.da()+"]",Is(e)}}finally{Ts(e)}}}function Ts(e,t){if(e.g){Cs(e);const n=e.g,s=e.C[0]?()=>{}:null;e.g=null,e.C=null,t||St(e,"ready");try{n.onreadystatechange=s}catch(e){}}}function Cs(e){e.g&&e.L&&(e.g.ontimeout=null),e.A&&(ve.clearTimeout(e.A),e.A=null)}function ks(e){return e.g?e.g.readyState:0}function As(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.K){case ws:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function Ds(e){let t="";return it(e,(function(e,n){t+=n,t+=":",t+=e,t+="\r\n"})),t}function Ns(e,t,n){e:{for(s in n){var s=!1;break e}s=!0}s||(n=Ds(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):Fn(e,t,n))}function xs(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Ls(e){this.Ga=0,this.j=[],this.l=new Kt,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=xs("failFast",!1,e),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=xs("baseRetryDelayMs",5e3,e),this.hb=xs("retryDelaySeedMs",1e4,e),this.eb=xs("forwardChannelMaxRetries",2,e),this.xa=xs("forwardChannelRequestTimeoutMs",2e4,e),this.va=e&&e.xmlHttpFactory||void 0,this.Ha=e&&e.dc||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.i=new Zn(e&&e.concurrentRequestLimit),this.Ja=new ls,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=e&&e.bc||!1,e&&e.Ea&&this.l.Ea(),e&&e.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&e&&e.detectBufferingProxy||!1,this.qa=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.qa=e.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function Rs(e){if(Ps(e),3==e.H){var t=e.W++,n=Rn(e.I);if(Fn(n,"SID",e.K),Fn(n,"RID",t),Fn(n,"TYPE","terminate"),Vs(e,n),(t=new gn(e,e.l,t)).L=2,t.v=Vn(Rn(n)),n=!1,ve.navigator&&ve.navigator.sendBeacon)try{n=ve.navigator.sendBeacon(t.v.toString(),"")}catch(e){}!n&&ve.Image&&((new Image).src=t.v,n=!0),n||(t.g=Xs(t.l,null),t.g.ha(t.v)),t.G=Date.now(),Sn(t)}Qs(e)}function Ms(e){e.g&&($s(e),e.g.cancel(),e.g=null)}function Ps(e){Ms(e),e.u&&(ve.clearTimeout(e.u),e.u=null),zs(e),e.i.cancel(),e.m&&("number"==typeof e.m&&ve.clearTimeout(e.m),e.m=null)}function Os(e){if(!ts(e.i)&&!e.m){e.m=!0;var t=e.Na;Lt||Pt(),Rt||(Lt(),Rt=!0),Mt.add(t,e),e.C=0}}function Fs(e,t){var n;n=t?t.m:e.W++;const s=Rn(e.I);Fn(s,"SID",e.K),Fn(s,"RID",n),Fn(s,"AID",e.V),Vs(e,s),e.o&&e.s&&Ns(s,e.o,e.s),n=new gn(e,e.l,n,e.C+1),null===e.o&&(n.I=e.s),t&&(e.j=t.F.concat(e.j)),t=Bs(e,n,1e3),n.setTimeout(Math.round(.5*e.xa)+Math.round(.5*e.xa*Math.random())),is(e.i,n),wn(n,s,t)}function Vs(e,t){e.na&&it(e.na,(function(e,n){Fn(t,n,e)})),e.h&&Nn({},(function(e,n){Fn(t,n,e)}))}function Bs(e,t,n){n=Math.min(e.j.length,n);var s=e.h?Te(e.h.Va,e.h,e):null;e:{var i=e.j;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let r=!0;for(let o=0;o<n;o++){let n=i[o].g;const a=i[o].map;if(n-=t,0>n)t=Math.max(0,i[o].g-100),r=!1;else try{cs(a,e,"req"+n+"_")}catch(e){s&&s(a)}}if(r){s=e.join("&");break e}}}return e=e.j.splice(0,n),t.F=e,s}function Us(e){if(!e.g&&!e.u){e.ba=1;var t=e.Ma;Lt||Pt(),Rt||(Lt(),Rt=!0),Mt.add(t,e),e.A=0}}function qs(e){return!(e.g||e.u||3<=e.A||(e.ba++,e.u=nn(Te(e.Ma,e),Ks(e,e.A)),e.A++,0))}function $s(e){null!=e.B&&(ve.clearTimeout(e.B),e.B=null)}function js(e){e.g=new gn(e,e.l,"rpc",e.ba),null===e.o&&(e.g.I=e.s),e.g.O=0;var t=Rn(e.wa);Fn(t,"RID","rpc"),Fn(t,"SID",e.K),Fn(t,"AID",e.V),Fn(t,"CI",e.G?"0":"1"),!e.G&&e.qa&&Fn(t,"TO",e.qa),Fn(t,"TYPE","xmlhttp"),Vs(e,t),e.o&&e.s&&Ns(t,e.o,e.s),e.L&&e.g.setTimeout(e.L);var n=e.g;e=e.pa,n.L=1,n.v=Vn(Rn(t)),n.s=null,n.S=!0,En(n,e)}function zs(e){null!=e.v&&(ve.clearTimeout(e.v),e.v=null)}function Hs(e,t){var n=null;if(e.g==t){zs(e),$s(e),e.g=null;var s=2}else{if(!ss(e.i,t))return;n=t.F,rs(e.i,t),s=1}if(0!=e.H)if(t.i)if(1==s){n=t.s?t.s.length:0,t=Date.now()-t.G;var i=e.C;St(s=Xt(),new tn(s,n)),Os(e)}else Us(e);else if(3==(i=t.o)||0==i&&0<t.ca||!(1==s&&function(e,t){return!(ns(e.i)>=e.i.j-(e.m?1:0)||(e.m?(e.j=t.F.concat(e.j),0):1==e.H||2==e.H||e.C>=(e.cb?0:e.eb)||(e.m=nn(Te(e.Na,e,t),Ks(e,e.C)),e.C++,0)))}(e,t)||2==s&&qs(e)))switch(n&&0<n.length&&(t=e.i,t.i=t.i.concat(n)),i){case 1:Gs(e,5);break;case 4:Gs(e,10);break;case 3:Gs(e,6);break;default:Gs(e,2)}}function Ks(e,t){let n=e.ab+Math.floor(Math.random()*e.hb);return e.isActive()||(n*=2),n*t}function Gs(e,t){if(e.l.info("Error code "+t),2==t){var n=null;e.h&&(n=null);var s=Te(e.pb,e);n||(n=new Ln("//www.google.com/images/cleardot.gif"),ve.location&&"http"==ve.location.protocol||Mn(n,"https"),Vn(n)),function(e,t){const n=new Kt;if(ve.Image){const s=new Image;s.onload=Ce(us,n,s,"TestLoadImage: loaded",!0,t),s.onerror=Ce(us,n,s,"TestLoadImage: error",!1,t),s.onabort=Ce(us,n,s,"TestLoadImage: abort",!1,t),s.ontimeout=Ce(us,n,s,"TestLoadImage: timeout",!1,t),ve.setTimeout((function(){s.ontimeout&&s.ontimeout()}),1e4),s.src=e}else t(!1)}(n.toString(),s)}else en(2);e.H=0,e.h&&e.h.za(t),Qs(e),Ps(e)}function Qs(e){if(e.H=0,e.ma=[],e.h){const t=os(e.i);0==t.length&&0==e.j.length||(xe(e.ma,t),xe(e.ma,e.j),e.i.i.length=0,Ne(e.j),e.j.length=0),e.h.ya()}}function Ws(e,t,n){var s=n instanceof Ln?Rn(n):new Ln(n);if(""!=s.g)t&&(s.g=t+"."+s.g),Pn(s,s.m);else{var i=ve.location;s=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;var r=new Ln(null);s&&Mn(r,s),t&&(r.g=t),i&&Pn(r,i),n&&(r.l=n),s=r}return n=e.F,t=e.Da,n&&t&&Fn(s,n,t),Fn(s,"VER",e.ra),Vs(e,s),s}function Xs(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=n&&e.Ha&&!e.va?new vs(new hs({ob:!0})):new vs(e.va)).Oa(e.J),t}function Ys(){}function Js(){if($e&&!(10<=Number(Ye)))throw Error("Environmental error: no available transport.")}function Zs(e,t){It.call(this),this.g=new Ls(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.Ca&&(e?e["X-WebChannel-Client-Profile"]=t.Ca:e={"X-WebChannel-Client-Profile":t.Ca}),this.g.U=e,(e=t&&t.cc)&&!Me(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!Me(t)&&(this.g.F=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new ni(this)}function ei(e){hn.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function ti(){dn.call(this),this.status=1}function ni(e){this.g=e}function si(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function ii(e,t,n){n||(n=0);var s=Array(16);if("string"==typeof t)for(var i=0;16>i;++i)s[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;16>i;++i)s[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];var r=e.g[3],o=t+(r^n&(i^r))+s[0]+3614090360&4294967295;o=(n=(i=(r=(t=(n=(i=(r=(t=(n=(i=(r=(t=(n=(i=(r=(t=(n=(i=(r=(t=(n=(i=(r=(t=(n=(i=(r=(t=(n=(i=(r=(t=(n=(i=(r=(t=(n=(i=(r=(t=(n=(i=(r=(t=(n=(i=(r=(t=(n=(i=(r=(t=(n=(i=(r=(t=(n=(i=(r=(t=n+(o<<7&4294967295|o>>>25))+((o=r+(i^t&(n^i))+s[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^r&(t^n))+s[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(r^t))+s[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=t+(r^n&(i^r))+s[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=r+(i^t&(n^i))+s[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^r&(t^n))+s[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(r^t))+s[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=t+(r^n&(i^r))+s[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=r+(i^t&(n^i))+s[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^r&(t^n))+s[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(r^t))+s[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=t+(r^n&(i^r))+s[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=r+(i^t&(n^i))+s[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^r&(t^n))+s[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(r^t))+s[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=t+(i^r&(n^i))+s[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=r+(n^i&(t^n))+s[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(r^t))+s[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(r^t&(i^r))+s[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^r&(n^i))+s[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=r+(n^i&(t^n))+s[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(r^t))+s[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(r^t&(i^r))+s[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^r&(n^i))+s[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=r+(n^i&(t^n))+s[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(r^t))+s[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(r^t&(i^r))+s[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^r&(n^i))+s[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=r+(n^i&(t^n))+s[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(r^t))+s[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(r^t&(i^r))+s[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=t+(n^i^r)+s[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=r+(t^n^i)+s[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=i+(r^t^n)+s[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^r^t)+s[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^r)+s[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=r+(t^n^i)+s[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=i+(r^t^n)+s[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^r^t)+s[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^r)+s[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=r+(t^n^i)+s[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=i+(r^t^n)+s[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^r^t)+s[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^r)+s[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=r+(t^n^i)+s[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=i+(r^t^n)+s[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^r^t)+s[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=t+(i^(n|~r))+s[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=r+(n^(t|~i))+s[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(r|~n))+s[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(r^(i|~t))+s[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=t+(i^(n|~r))+s[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=r+(n^(t|~i))+s[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(r|~n))+s[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(r^(i|~t))+s[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=t+(i^(n|~r))+s[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=r+(n^(t|~i))+s[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(r|~n))+s[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(r^(i|~t))+s[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((r=(t=n+((o=t+(i^(n|~r))+s[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=r+(n^(t|~i))+s[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((i=r+((o=i+(t^(r|~n))+s[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~t))+s[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,e.g[2]=e.g[2]+i&4294967295,e.g[3]=e.g[3]+r&4294967295}function ri(e,t){this.h=t;for(var n=[],s=!0,i=e.length-1;0<=i;i--){var r=0|e[i];s&&r==t||(n[i]=r,s=!1)}this.g=n}(ge=vs.prototype).Oa=function(e){this.M=e},ge.ha=function(e,t,n,s){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+e);t=t?t.toUpperCase():"GET",this.I=e,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():cn.g(),this.C=this.u?an(this.u):an(cn),this.g.onreadystatechange=Te(this.La,this);try{this.G=!0,this.g.open(t,String(e),!0),this.G=!1}catch(e){return void _s(this,e)}if(e=n||"",n=new Map(this.headers),s)if(Object.getPrototypeOf(s)===Object.prototype)for(var i in s)n.set(i,s[i]);else{if("function"!=typeof s.keys||"function"!=typeof s.get)throw Error("Unknown input type for opt_headers: "+String(s));for(const e of s.keys())n.set(e,s.get(e))}s=Array.from(n.keys()).find((e=>"content-type"==e.toLowerCase())),i=ve.FormData&&e instanceof ve.FormData,!(0<=De(bs,t))||s||i||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[e,t]of n)this.g.setRequestHeader(e,t);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{Cs(this),0<this.B&&((this.L=function(e){return $e&&"number"==typeof e.timeout&&void 0!==e.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Te(this.ua,this)):this.A=Bt(this.ua,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(e){_s(this,e)}},ge.ua=function(){void 0!==ye&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,St(this,"timeout"),this.abort(8))},ge.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,St(this,"complete"),St(this,"abort"),Ts(this))},ge.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Ts(this,!0)),vs.$.N.call(this)},ge.La=function(){this.s||(this.G||this.v||this.l?Ss(this):this.kb())},ge.kb=function(){Ss(this)},ge.isActive=function(){return!!this.g},ge.da=function(){try{return 2<ks(this)?this.g.status:-1}catch(e){return-1}},ge.ja=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},ge.Wa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),ys(t)}},ge.Ia=function(){return this.m},ge.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(ge=Ls.prototype).ra=8,ge.H=1,ge.Na=function(e){if(this.m)if(this.m=null,1==this.H){if(!e){this.W=Math.floor(1e5*Math.random()),e=this.W++;const i=new gn(this,this.l,e);let r=this.s;if(this.U&&(r?(r=rt(r),at(r,this.U)):r=this.U),null!==this.o||this.O||(i.I=r,r=null),this.P)e:{for(var t=0,n=0;n<this.j.length;n++){var s=this.j[n];if(void 0===(s="__data__"in s.map&&"string"==typeof(s=s.map.__data__)?s.length:void 0))break;if(4096<(t+=s)){t=n;break e}if(4096===t||n===this.j.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=Bs(this,i,t),Fn(n=Rn(this.I),"RID",e),Fn(n,"CVER",22),this.F&&Fn(n,"X-HTTP-Session-Id",this.F),Vs(this,n),r&&(this.O?t="headers="+encodeURIComponent(String(Ds(r)))+"&"+t:this.o&&Ns(n,this.o,r)),is(this.i,i),this.bb&&Fn(n,"TYPE","init"),this.P?(Fn(n,"$req",t),Fn(n,"SID","null"),i.aa=!0,wn(i,n,null)):wn(i,n,t),this.H=2}}else 3==this.H&&(e?Fs(this,e):0==this.j.length||ts(this.i)||Fs(this))},ge.Ma=function(){if(this.u=null,js(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var e=2*this.S;this.l.info("BP detection timer enabled: "+e),this.B=nn(Te(this.jb,this),e)}},ge.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,en(10),Ms(this),js(this))},ge.ib=function(){null!=this.v&&(this.v=null,Ms(this),qs(this),en(19))},ge.pb=function(e){e?(this.l.info("Successfully pinged google.com"),en(2)):(this.l.info("Failed to ping google.com"),en(1))},ge.isActive=function(){return!!this.h&&this.h.isActive(this)},(ge=Ys.prototype).Ba=function(){},ge.Aa=function(){},ge.za=function(){},ge.ya=function(){},ge.isActive=function(){return!0},ge.Va=function(){},Js.prototype.g=function(e,t){return new Zs(e,t)},ke(Zs,It),Zs.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var e=this.g,t=this.l,n=this.h||void 0;en(0),e.Y=t,e.na=n||{},e.G=e.aa,e.I=Ws(e,null,e.Y),Os(e)},Zs.prototype.close=function(){Rs(this.g)},Zs.prototype.u=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.v&&((n={}).__data__=Ct(e),e=n);t.j.push(new class{constructor(e,t){this.g=e,this.map=t}}(t.fb++,e)),3==t.H&&Os(t)},Zs.prototype.N=function(){this.g.h=null,delete this.j,Rs(this.g),delete this.g,Zs.$.N.call(this)},ke(ei,hn),ke(ti,dn),ke(ni,Ys),ni.prototype.Ba=function(){St(this.g,"a")},ni.prototype.Aa=function(e){St(this.g,new ei(e))},ni.prototype.za=function(e){St(this.g,new ti)},ni.prototype.ya=function(){St(this.g,"b")},ke(si,(function(){this.blockSize=-1})),si.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},si.prototype.j=function(e,t){void 0===t&&(t=e.length);for(var n=t-this.blockSize,s=this.m,i=this.h,r=0;r<t;){if(0==i)for(;r<=n;)ii(this,e,r),r+=this.blockSize;if("string"==typeof e){for(;r<t;)if(s[i++]=e.charCodeAt(r++),i==this.blockSize){ii(this,s),i=0;break}}else for(;r<t;)if(s[i++]=e[r++],i==this.blockSize){ii(this,s),i=0;break}}this.h=i,this.i+=t},si.prototype.l=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.i;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.j(e),e=Array(16),t=n=0;4>t;++t)for(var s=0;32>s;s+=8)e[n++]=this.g[t]>>>s&255;return e};var oi={};function ai(e){return-128<=e&&128>e?function(e,t){var n=oi;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=function(e){return new ri([0|e],0>e?-1:0)}(e)}(e):new ri([0|e],0>e?-1:0)}function li(e){if(isNaN(e)||!isFinite(e))return ui;if(0>e)return mi(li(-e));for(var t=[],n=1,s=0;e>=n;s++)t[s]=e/n|0,n*=ci;return new ri(t,0)}var ci=4294967296,ui=ai(0),hi=ai(1),di=ai(16777216);function fi(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function gi(e){return-1==e.h}function mi(e){for(var t=e.g.length,n=[],s=0;s<t;s++)n[s]=~e.g[s];return new ri(n,~e.h).add(hi)}function pi(e,t){return e.add(mi(t))}function yi(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function vi(e,t){this.g=e,this.h=t}function wi(e,t){if(fi(t))throw Error("division by zero");if(fi(e))return new vi(ui,ui);if(gi(e))return t=wi(mi(e),t),new vi(mi(t.g),mi(t.h));if(gi(t))return t=wi(e,mi(t)),new vi(mi(t.g),t.h);if(30<e.g.length){if(gi(e)||gi(t))throw Error("slowDivide_ only works with positive integers.");for(var n=hi,s=t;0>=s.X(e);)n=Ei(n),s=Ei(s);var i=bi(n,1),r=bi(s,1);for(s=bi(s,2),n=bi(n,2);!fi(s);){var o=r.add(s);0>=o.X(e)&&(i=i.add(n),r=o),s=bi(s,1),n=bi(n,1)}return t=pi(e,i.R(t)),new vi(i,t)}for(i=ui;0<=e.X(t);){for(n=Math.max(1,Math.floor(e.ea()/t.ea())),s=48>=(s=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,s-48),o=(r=li(n)).R(t);gi(o)||0<o.X(e);)o=(r=li(n-=s)).R(t);fi(r)&&(r=hi),i=i.add(r),e=pi(e,o)}return new vi(i,e)}function Ei(e){for(var t=e.g.length+1,n=[],s=0;s<t;s++)n[s]=e.D(s)<<1|e.D(s-1)>>>31;return new ri(n,e.h)}function bi(e,t){var n=t>>5;t%=32;for(var s=e.g.length-n,i=[],r=0;r<s;r++)i[r]=0<t?e.D(r+n)>>>t|e.D(r+n+1)<<32-t:e.D(r+n);return new ri(i,e.h)}(ge=ri.prototype).ea=function(){if(gi(this))return-mi(this).ea();for(var e=0,t=1,n=0;n<this.g.length;n++){var s=this.D(n);e+=(0<=s?s:ci+s)*t,t*=ci}return e},ge.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(fi(this))return"0";if(gi(this))return"-"+mi(this).toString(e);for(var t=li(Math.pow(e,6)),n=this,s="";;){var i=wi(n,t).g,r=((0<(n=pi(n,i.R(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(fi(n=i))return r+s;for(;6>r.length;)r="0"+r;s=r+s}},ge.D=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},ge.X=function(e){return gi(e=pi(this,e))?-1:fi(e)?0:1},ge.abs=function(){return gi(this)?mi(this):this},ge.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],s=0,i=0;i<=t;i++){var r=s+(65535&this.D(i))+(65535&e.D(i)),o=(r>>>16)+(this.D(i)>>>16)+(e.D(i)>>>16);s=o>>>16,r&=65535,o&=65535,n[i]=o<<16|r}return new ri(n,-2147483648&n[n.length-1]?-1:0)},ge.R=function(e){if(fi(this)||fi(e))return ui;if(gi(this))return gi(e)?mi(this).R(mi(e)):mi(mi(this).R(e));if(gi(e))return mi(this.R(mi(e)));if(0>this.X(di)&&0>e.X(di))return li(this.ea()*e.ea());for(var t=this.g.length+e.g.length,n=[],s=0;s<2*t;s++)n[s]=0;for(s=0;s<this.g.length;s++)for(var i=0;i<e.g.length;i++){var r=this.D(s)>>>16,o=65535&this.D(s),a=e.D(i)>>>16,l=65535&e.D(i);n[2*s+2*i]+=o*l,yi(n,2*s+2*i),n[2*s+2*i+1]+=r*l,yi(n,2*s+2*i+1),n[2*s+2*i+1]+=o*a,yi(n,2*s+2*i+1),n[2*s+2*i+2]+=r*a,yi(n,2*s+2*i+2)}for(s=0;s<t;s++)n[s]=n[2*s+1]<<16|n[2*s];for(s=t;s<2*t;s++)n[s]=0;return new ri(n,0)},ge.gb=function(e){return wi(this,e).h},ge.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],s=0;s<t;s++)n[s]=this.D(s)&e.D(s);return new ri(n,this.h&e.h)},ge.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],s=0;s<t;s++)n[s]=this.D(s)|e.D(s);return new ri(n,this.h|e.h)},ge.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],s=0;s<t;s++)n[s]=this.D(s)^e.D(s);return new ri(n,this.h^e.h)},Js.prototype.createWebChannel=Js.prototype.g,Zs.prototype.send=Zs.prototype.u,Zs.prototype.open=Zs.prototype.m,Zs.prototype.close=Zs.prototype.close,sn.NO_ERROR=0,sn.TIMEOUT=8,sn.HTTP_ERROR=6,rn.COMPLETE="complete",ln.EventType=un,un.OPEN="a",un.CLOSE="b",un.ERROR="c",un.MESSAGE="d",It.prototype.listen=It.prototype.O,vs.prototype.listenOnce=vs.prototype.P,vs.prototype.getLastError=vs.prototype.Sa,vs.prototype.getLastErrorCode=vs.prototype.Ia,vs.prototype.getStatus=vs.prototype.da,vs.prototype.getResponseJson=vs.prototype.Wa,vs.prototype.getResponseText=vs.prototype.ja,vs.prototype.send=vs.prototype.ha,vs.prototype.setWithCredentials=vs.prototype.Oa,si.prototype.digest=si.prototype.l,si.prototype.reset=si.prototype.reset,si.prototype.update=si.prototype.j,ri.prototype.add=ri.prototype.add,ri.prototype.multiply=ri.prototype.R,ri.prototype.modulo=ri.prototype.gb,ri.prototype.compare=ri.prototype.X,ri.prototype.toNumber=ri.prototype.ea,ri.prototype.toString=ri.prototype.toString,ri.prototype.getBits=ri.prototype.D,ri.fromNumber=li,ri.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return mi(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var s=li(Math.pow(n,8)),i=ui,r=0;r<t.length;r+=8){var o=Math.min(8,t.length-r),a=parseInt(t.substring(r,r+o),n);8>o?(o=li(Math.pow(n,o)),i=i.R(o).add(li(a))):i=(i=i.R(s)).add(li(a))}return i};var _i=pe.createWebChannelTransport=function(){return new Js},Ii=pe.getStatEventTarget=function(){return Xt()},Si=pe.ErrorCode=sn,Ti=pe.EventType=rn,Ci=pe.Event=Qt,ki=pe.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},Ai=pe.FetchXmlHttpFactory=hs,Di=pe.WebChannel=ln,Ni=pe.XhrIo=vs,xi=pe.Md5=si,Li=pe.Integer=ri;const Ri="@firebase/firestore";class Mi{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Mi.UNAUTHENTICATED=new Mi(null),Mi.GOOGLE_CREDENTIALS=new Mi("google-credentials-uid"),Mi.FIRST_PARTY=new Mi("first-party-uid"),Mi.MOCK_USER=new Mi("mock-user");let Pi="10.1.0";const Oi=new T("@firebase/firestore");function Fi(){return Oi.logLevel}function Vi(e,...t){if(Oi.logLevel<=w.DEBUG){const n=t.map(qi);Oi.debug(`Firestore (${Pi}): ${e}`,...n)}}function Bi(e,...t){if(Oi.logLevel<=w.ERROR){const n=t.map(qi);Oi.error(`Firestore (${Pi}): ${e}`,...n)}}function Ui(e,...t){if(Oi.logLevel<=w.WARN){const n=t.map(qi);Oi.warn(`Firestore (${Pi}): ${e}`,...n)}}function qi(e){if("string"==typeof e)return e;try{return function(e){return JSON.stringify(e)}(e)}catch(t){return e}}function $i(e="Unexpected state"){const t=`FIRESTORE (${Pi}) INTERNAL ASSERTION FAILED: `+e;throw Bi(t),new Error(t)}function ji(e,t){e||$i()}function zi(e,t){return e}const Hi={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Ki extends l{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Gi{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class Qi{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Wi{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(Mi.UNAUTHENTICATED)))}shutdown(){}}class Xi{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class Yi{constructor(e){this.t=e,this.currentUser=Mi.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.i;const s=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let i=new Gi;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Gi,e.enqueueRetryable((()=>s(this.currentUser)))};const r=()=>{const t=i;e.enqueueRetryable((async()=>{await t.promise,await s(this.currentUser)}))},o=e=>{Vi("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),r()};this.t.onInit((e=>o(e))),setTimeout((()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(Vi("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Gi)}}),0),r()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((t=>this.i!==e?(Vi("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(ji("string"==typeof t.accessToken),new Qi(t.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return ji(null===e||"string"==typeof e),new Mi(e)}}class Ji{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=Mi.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class Zi{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new Ji(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable((()=>t(Mi.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class er{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class tr{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){const n=e=>{null!=e.error&&Vi("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const n=e.token!==this.R;return this.R=e.token,Vi("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable((()=>n(t)))};const s=e=>{Vi("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.A.onInit((e=>s(e))),setTimeout((()=>{if(!this.appCheck){const e=this.A.getImmediate({optional:!0});e?s(e):Vi("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((e=>e?(ji("string"==typeof e.token),this.R=e.token,new er(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function nr(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let t=0;t<e;t++)n[t]=Math.floor(256*Math.random());return n}class sr{static V(){const e=62*Math.floor(256/62);let t="";for(;t.length<20;){const n=nr(40);for(let s=0;s<n.length;++s)t.length<20&&n[s]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[s]%62))}return t}}function ir(e,t){return e<t?-1:e>t?1:0}function rr(e,t,n){return e.length===t.length&&e.every(((e,s)=>n(e,t[s])))}class or{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Ki(Hi.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Ki(Hi.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new Ki(Hi.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Ki(Hi.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return or.fromMillis(Date.now())}static fromDate(e){return or.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new or(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?ir(this.nanoseconds,e.nanoseconds):ir(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class ar{constructor(e){this.timestamp=e}static fromTimestamp(e){return new ar(e)}static min(){return new ar(new or(0,0))}static max(){return new ar(new or(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class lr{constructor(e,t,n){void 0===t?t=0:t>e.length&&$i(),void 0===n?n=e.length-t:n>e.length-t&&$i(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===lr.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof lr?e.forEach((e=>{t.push(e)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let s=0;s<n;s++){const n=e.get(s),i=t.get(s);if(n<i)return-1;if(n>i)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class cr extends lr{construct(e,t,n){return new cr(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new Ki(Hi.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter((e=>e.length>0)))}return new cr(t)}static emptyPath(){return new cr([])}}const ur=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class hr extends lr{construct(e,t,n){return new hr(e,t,n)}static isValidIdentifier(e){return ur.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),hr.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new hr(["__name__"])}static fromServerFormat(e){const t=[];let n="",s=0;const i=()=>{if(0===n.length)throw new Ki(Hi.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let r=!1;for(;s<e.length;){const t=e[s];if("\\"===t){if(s+1===e.length)throw new Ki(Hi.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[s+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new Ki(Hi.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,s+=2}else"`"===t?(r=!r,s++):"."!==t||r?(n+=t,s++):(i(),s++)}if(i(),r)throw new Ki(Hi.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new hr(t)}static emptyPath(){return new hr([])}}class dr{constructor(e){this.path=e}static fromPath(e){return new dr(cr.fromString(e))}static fromName(e){return new dr(cr.fromString(e).popFirst(5))}static empty(){return new dr(cr.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===cr.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return cr.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new dr(new cr(e.slice()))}}function fr(e){return new gr(e.readTime,e.key,-1)}class gr{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new gr(ar.min(),dr.empty(),-1)}static max(){return new gr(ar.max(),dr.empty(),-1)}}function mr(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=dr.comparator(e.documentKey,t.documentKey),0!==n?n:ir(e.largestBatchId,t.largestBatchId))}const pr="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class yr{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function vr(e){if(e.code!==Hi.FAILED_PRECONDITION||e.message!==pr)throw e;Vi("LocalStore","Unexpectedly lost primary lease")}class wr{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&$i(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new wr(((n,s)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,s)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,s)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof wr?t:wr.resolve(t)}catch(e){return wr.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):wr.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):wr.reject(t)}static resolve(e){return new wr(((t,n)=>{t(e)}))}static reject(e){return new wr(((t,n)=>{n(e)}))}static waitFor(e){return new wr(((t,n)=>{let s=0,i=0,r=!1;e.forEach((e=>{++s,e.next((()=>{++i,r&&i===s&&t()}),(e=>n(e)))})),r=!0,i===s&&t()}))}static or(e){let t=wr.resolve(!1);for(const n of e)t=t.next((e=>e?wr.resolve(e):n()));return t}static forEach(e,t){const n=[];return e.forEach(((e,s)=>{n.push(t.call(this,e,s))})),this.waitFor(n)}static mapArray(e,t){return new wr(((n,s)=>{const i=e.length,r=new Array(i);let o=0;for(let a=0;a<i;a++){const l=a;t(e[l]).next((e=>{r[l]=e,++o,o===i&&n(r)}),(e=>s(e)))}}))}static doWhile(e,t){return new wr(((n,s)=>{const i=()=>{!0===e()?t().next((()=>{i()}),s):n()};i()}))}}function Er(e){return"IndexedDbTransactionError"===e.name}class br{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.oe(e),this._e=e=>t.writeSequenceNumber(e))}oe(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this._e&&this._e(e),e}}function _r(e){return null==e}function Ir(e){return 0===e&&1/e==-1/0}br.ae=-1;function Sr(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function Tr(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function Cr(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class kr{constructor(e,t){this.comparator=e,this.root=t||Dr.EMPTY}insert(e,t){return new kr(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Dr.BLACK,null,null))}remove(e){return new kr(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Dr.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const s=this.comparator(e,n.key);if(0===s)return t+n.left.size;s<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Ar(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Ar(this.root,e,this.comparator,!1)}getReverseIterator(){return new Ar(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Ar(this.root,e,this.comparator,!0)}}class Ar{constructor(e,t,n,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Dr{constructor(e,t,n,s,i){this.key=e,this.value=t,this.color=null!=n?n:Dr.RED,this.left=null!=s?s:Dr.EMPTY,this.right=null!=i?i:Dr.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,s,i){return new Dr(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=s?s:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let s=this;const i=n(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,n),null):0===i?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,n)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Dr.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),0===t(e,s.key)){if(s.right.isEmpty())return Dr.EMPTY;n=s.right.min(),s=s.copy(n.key,n.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Dr.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Dr.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw $i();if(this.right.isRed())throw $i();const e=this.left.check();if(e!==this.right.check())throw $i();return e+(this.isRed()?0:1)}}Dr.EMPTY=null,Dr.RED=!0,Dr.BLACK=!1,Dr.EMPTY=new class{constructor(){this.size=0}get key(){throw $i()}get value(){throw $i()}get color(){throw $i()}get left(){throw $i()}get right(){throw $i()}copy(e,t,n,s,i){return this}insert(e,t,n){return new Dr(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Nr{constructor(e){this.comparator=e,this.data=new kr(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const s=n.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new xr(this.data.getIterator())}getIteratorFrom(e){return new xr(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((e=>{t=t.add(e)})),t}isEqual(e){if(!(e instanceof Nr))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,s=n.getNext().key;if(0!==this.comparator(e,s))return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new Nr(this.comparator);return t.data=e,t}}class xr{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Lr{constructor(e){this.fields=e,e.sort(hr.comparator)}static empty(){return new Lr([])}unionWith(e){let t=new Nr(hr.comparator);for(const e of this.fields)t=t.add(e);for(const n of e)t=t.add(n);return new Lr(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return rr(this.fields,e.fields,((e,t)=>e.isEqual(t)))}}class Rr extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Mr{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new Rr("Invalid base64 string: "+e):e}}(e);return new Mr(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new Mr(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ir(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Mr.EMPTY_BYTE_STRING=new Mr("");const Pr=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Or(e){if(ji(!!e),"string"==typeof e){let t=0;const n=Pr.exec(e);if(ji(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const s=new Date(e);return{seconds:Math.floor(s.getTime()/1e3),nanos:t}}return{seconds:Fr(e.seconds),nanos:Fr(e.nanos)}}function Fr(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function Vr(e){return"string"==typeof e?Mr.fromBase64String(e):Mr.fromUint8Array(e)}function Br(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Ur(e){const t=e.mapValue.fields.__previous_value__;return Br(t)?Ur(t):t}function qr(e){const t=Or(e.mapValue.fields.__local_write_time__.timestampValue);return new or(t.seconds,t.nanos)}class $r{constructor(e,t,n,s,i,r,o,a,l){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=s,this.ssl=i,this.forceLongPolling=r,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=l}}class jr{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new jr("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof jr&&e.projectId===this.projectId&&e.database===this.database}}const zr={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Hr(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?Br(e)?4:io(e)?9007199254740991:10:$i()}function Kr(e,t){if(e===t)return!0;const n=Hr(e);if(n!==Hr(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return qr(e).isEqual(qr(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=Or(e.timestampValue),s=Or(t.timestampValue);return n.seconds===s.seconds&&n.nanos===s.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return Vr(e.bytesValue).isEqual(Vr(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return Fr(e.geoPointValue.latitude)===Fr(t.geoPointValue.latitude)&&Fr(e.geoPointValue.longitude)===Fr(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return Fr(e.integerValue)===Fr(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=Fr(e.doubleValue),s=Fr(t.doubleValue);return n===s?Ir(n)===Ir(s):isNaN(n)&&isNaN(s)}return!1}(e,t);case 9:return rr(e.arrayValue.values||[],t.arrayValue.values||[],Kr);case 10:return function(e,t){const n=e.mapValue.fields||{},s=t.mapValue.fields||{};if(Sr(n)!==Sr(s))return!1;for(const e in n)if(n.hasOwnProperty(e)&&(void 0===s[e]||!Kr(n[e],s[e])))return!1;return!0}(e,t);default:return $i()}}function Gr(e,t){return void 0!==(e.values||[]).find((e=>Kr(e,t)))}function Qr(e,t){if(e===t)return 0;const n=Hr(e),s=Hr(t);if(n!==s)return ir(n,s);switch(n){case 0:case 9007199254740991:return 0;case 1:return ir(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=Fr(e.integerValue||e.doubleValue),s=Fr(t.integerValue||t.doubleValue);return n<s?-1:n>s?1:n===s?0:isNaN(n)?isNaN(s)?0:-1:1}(e,t);case 3:return Wr(e.timestampValue,t.timestampValue);case 4:return Wr(qr(e),qr(t));case 5:return ir(e.stringValue,t.stringValue);case 6:return function(e,t){const n=Vr(e),s=Vr(t);return n.compareTo(s)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),s=t.split("/");for(let e=0;e<n.length&&e<s.length;e++){const t=ir(n[e],s[e]);if(0!==t)return t}return ir(n.length,s.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=ir(Fr(e.latitude),Fr(t.latitude));return 0!==n?n:ir(Fr(e.longitude),Fr(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){const n=e.values||[],s=t.values||[];for(let e=0;e<n.length&&e<s.length;++e){const t=Qr(n[e],s[e]);if(t)return t}return ir(n.length,s.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===zr.mapValue&&t===zr.mapValue)return 0;if(e===zr.mapValue)return 1;if(t===zr.mapValue)return-1;const n=e.fields||{},s=Object.keys(n),i=t.fields||{},r=Object.keys(i);s.sort(),r.sort();for(let e=0;e<s.length&&e<r.length;++e){const t=ir(s[e],r[e]);if(0!==t)return t;const o=Qr(n[s[e]],i[r[e]]);if(0!==o)return o}return ir(s.length,r.length)}(e.mapValue,t.mapValue);default:throw $i()}}function Wr(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return ir(e,t);const n=Or(e),s=Or(t),i=ir(n.seconds,s.seconds);return 0!==i?i:ir(n.nanos,s.nanos)}function Xr(e){return Yr(e)}function Yr(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=Or(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?function(e){return Vr(e).toBase64()}(e.bytesValue):"referenceValue"in e?function(e){return dr.fromName(e).toString()}(e.referenceValue):"geoPointValue"in e?function(e){return`geo(${e.latitude},${e.longitude})`}(e.geoPointValue):"arrayValue"in e?function(e){let t="[",n=!0;for(const s of e.values||[])n?n=!1:t+=",",t+=Yr(s);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",s=!0;for(const i of t)s?s=!1:n+=",",n+=`${i}:${Yr(e.fields[i])}`;return n+"}"}(e.mapValue):$i()}function Jr(e){return!!e&&"integerValue"in e}function Zr(e){return!!e&&"arrayValue"in e}function eo(e){return!!e&&"nullValue"in e}function to(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function no(e){return!!e&&"mapValue"in e}function so(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return Tr(e.mapValue.fields,((e,n)=>t.mapValue.fields[e]=so(n))),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=so(e.arrayValue.values[n]);return t}return Object.assign({},e)}function io(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}class ro{constructor(e){this.value=e}static empty(){return new ro({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!no(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=so(t)}setAll(e){let t=hr.emptyPath(),n={},s=[];e.forEach(((e,i)=>{if(!t.isImmediateParentOf(i)){const e=this.getFieldsMap(t);this.applyChanges(e,n,s),n={},s=[],t=i.popLast()}e?n[i.lastSegment()]=so(e):s.push(i.lastSegment())}));const i=this.getFieldsMap(t);this.applyChanges(i,n,s)}delete(e){const t=this.field(e.popLast());no(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Kr(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let s=t.mapValue.fields[e.get(n)];no(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,n){Tr(t,((t,n)=>e[t]=n));for(const t of n)delete e[t]}clone(){return new ro(so(this.value))}}function oo(e){const t=[];return Tr(e.fields,((e,n)=>{const s=new hr([e]);if(no(n)){const e=oo(n.mapValue).fields;if(0===e.length)t.push(s);else for(const n of e)t.push(s.child(n))}else t.push(s)})),new Lr(t)}class ao{constructor(e,t,n,s,i,r,o){this.key=e,this.documentType=t,this.version=n,this.readTime=s,this.createTime=i,this.data=r,this.documentState=o}static newInvalidDocument(e){return new ao(e,0,ar.min(),ar.min(),ar.min(),ro.empty(),0)}static newFoundDocument(e,t,n,s){return new ao(e,1,t,ar.min(),n,s,0)}static newNoDocument(e,t){return new ao(e,2,t,ar.min(),ar.min(),ro.empty(),0)}static newUnknownDocument(e,t){return new ao(e,3,t,ar.min(),ar.min(),ro.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(ar.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=ro.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=ro.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ar.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof ao&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new ao(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class lo{constructor(e,t){this.position=e,this.inclusive=t}}function co(e,t,n){let s=0;for(let i=0;i<e.position.length;i++){const r=t[i],o=e.position[i];if(s=r.field.isKeyField()?dr.comparator(dr.fromName(o.referenceValue),n.key):Qr(o,n.data.field(r.field)),"desc"===r.dir&&(s*=-1),0!==s)break}return s}function uo(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!Kr(e.position[n],t.position[n]))return!1;return!0}class ho{constructor(e,t="asc"){this.field=e,this.dir=t}}function fo(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class go{}class mo extends go{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new _o(e,t,n):"array-contains"===t?new Co(e,n):"in"===t?new ko(e,n):"not-in"===t?new Ao(e,n):"array-contains-any"===t?new Do(e,n):new mo(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new Io(e,n):new So(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(Qr(t,this.value)):null!==t&&Hr(this.value)===Hr(t)&&this.matchesComparison(Qr(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return $i()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class po extends go{constructor(e,t){super(),this.filters=e,this.op=t,this.ce=null}static create(e,t){return new po(e,t)}matches(e){return yo(this)?void 0===this.filters.find((t=>!t.matches(e))):void 0!==this.filters.find((t=>t.matches(e)))}getFlattenedFilters(){return null!==this.ce||(this.ce=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.ce}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){const e=this.le((e=>e.isInequality()));return null!==e?e.field:null}le(e){for(const t of this.getFlattenedFilters())if(e(t))return t;return null}}function yo(e){return"and"===e.op}function vo(e){return function(e){for(const t of e.filters)if(t instanceof po)return!1;return!0}(e)&&yo(e)}function wo(e){if(e instanceof mo)return e.field.canonicalString()+e.op.toString()+Xr(e.value);if(vo(e))return e.filters.map((e=>wo(e))).join(",");{const t=e.filters.map((e=>wo(e))).join(",");return`${e.op}(${t})`}}function Eo(e,t){return e instanceof mo?function(e,t){return t instanceof mo&&e.op===t.op&&e.field.isEqual(t.field)&&Kr(e.value,t.value)}(e,t):e instanceof po?function(e,t){return t instanceof po&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce(((e,n,s)=>e&&Eo(n,t.filters[s])),!0)}(e,t):void $i()}function bo(e){return e instanceof mo?function(e){return`${e.field.canonicalString()} ${e.op} ${Xr(e.value)}`}(e):e instanceof po?function(e){return e.op.toString()+" {"+e.getFilters().map(bo).join(" ,")+"}"}(e):"Filter"}class _o extends mo{constructor(e,t,n){super(e,t,n),this.key=dr.fromName(n.referenceValue)}matches(e){const t=dr.comparator(e.key,this.key);return this.matchesComparison(t)}}class Io extends mo{constructor(e,t){super(e,"in",t),this.keys=To(0,t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class So extends mo{constructor(e,t){super(e,"not-in",t),this.keys=To(0,t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function To(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map((e=>dr.fromName(e.referenceValue)))}class Co extends mo{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Zr(t)&&Gr(t.arrayValue,this.value)}}class ko extends mo{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Gr(this.value.arrayValue,t)}}class Ao extends mo{constructor(e,t){super(e,"not-in",t)}matches(e){if(Gr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!Gr(this.value.arrayValue,t)}}class Do extends mo{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Zr(t)||!t.arrayValue.values)&&t.arrayValue.values.some((e=>Gr(this.value.arrayValue,e)))}}class No{constructor(e,t=null,n=[],s=[],i=null,r=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=s,this.limit=i,this.startAt=r,this.endAt=o,this.he=null}}function xo(e,t=null,n=[],s=[],i=null,r=null,o=null){return new No(e,t,n,s,i,r,o)}function Lo(e){const t=zi(e);if(null===t.he){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((e=>wo(e))).join(","),e+="|ob:",e+=t.orderBy.map((e=>function(e){return e.field.canonicalString()+e.dir}(e))).join(","),_r(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((e=>Xr(e))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((e=>Xr(e))).join(",")),t.he=e}return t.he}function Ro(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!fo(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!Eo(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!uo(e.startAt,t.startAt)&&uo(e.endAt,t.endAt)}function Mo(e){return dr.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class Po{constructor(e,t=null,n=[],s=[],i=null,r="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=s,this.limit=i,this.limitType=r,this.startAt=o,this.endAt=a,this.Pe=null,this.Ie=null,this.startAt,this.endAt}}function Oo(e){return new Po(e)}function Fo(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function Vo(e){const t=zi(e);if(null===t.Pe){t.Pe=[];const e=function(e){for(const t of e.filters){const e=t.getFirstInequalityField();if(null!==e)return e}return null}(t),n=function(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}(t);if(null!==e&&null===n)e.isKeyField()||t.Pe.push(new ho(e)),t.Pe.push(new ho(hr.keyField(),"asc"));else{let e=!1;for(const n of t.explicitOrderBy)t.Pe.push(n),n.field.isKeyField()&&(e=!0);if(!e){const e=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";t.Pe.push(new ho(hr.keyField(),e))}}}return t.Pe}function Bo(e){const t=zi(e);if(!t.Ie)if("F"===t.limitType)t.Ie=xo(t.path,t.collectionGroup,Vo(t),t.filters,t.limit,t.startAt,t.endAt);else{const e=[];for(const n of Vo(t)){const t="desc"===n.dir?"asc":"desc";e.push(new ho(n.field,t))}const n=t.endAt?new lo(t.endAt.position,t.endAt.inclusive):null,s=t.startAt?new lo(t.startAt.position,t.startAt.inclusive):null;t.Ie=xo(t.path,t.collectionGroup,e,t.filters,t.limit,n,s)}return t.Ie}function Uo(e,t,n){return new Po(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function qo(e,t){return Ro(Bo(e),Bo(t))&&e.limitType===t.limitType}function $o(e){return`${Lo(Bo(e))}|lt:${e.limitType}`}function jo(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map((e=>bo(e))).join(", ")}]`),_r(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map((e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e))).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((e=>Xr(e))).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((e=>Xr(e))).join(",")),`Target(${t})`}(Bo(e))}; limitType=${e.limitType})`}function zo(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):dr.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of Vo(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const s=co(e,t,n);return e.inclusive?s<=0:s<0}(e.startAt,Vo(e),t)||e.endAt&&!function(e,t,n){const s=co(e,t,n);return e.inclusive?s>=0:s>0}(e.endAt,Vo(e),t))}(e,t)}function Ho(e){return(t,n)=>{let s=!1;for(const i of Vo(e)){const e=Ko(i,t,n);if(0!==e)return e;s=s||i.field.isKeyField()}return 0}}function Ko(e,t,n){const s=e.field.isKeyField()?dr.comparator(t.key,n.key):function(e,t,n){const s=t.data.field(e),i=n.data.field(e);return null!==s&&null!==i?Qr(s,i):$i()}(e.field,t,n);switch(e.dir){case"asc":return s;case"desc":return-1*s;default:return $i()}}class Go{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,s]of n)if(this.equalsFn(t,e))return s}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),s=this.inner[n];if(void 0===s)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<s.length;n++)if(this.equalsFn(s[n][0],e))return void(s[n]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let s=0;s<n.length;s++)if(this.equalsFn(n[s][0],e))return 1===n.length?delete this.inner[t]:n.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Tr(this.inner,((t,n)=>{for(const[t,s]of n)e(t,s)}))}isEmpty(){return Cr(this.inner)}size(){return this.innerSize}}const Qo=new kr(dr.comparator);function Wo(){return Qo}const Xo=new kr(dr.comparator);function Yo(...e){let t=Xo;for(const n of e)t=t.insert(n.key,n);return t}function Jo(e){let t=Xo;return e.forEach(((e,n)=>t=t.insert(e,n.overlayedDocument))),t}function Zo(){return ta()}function ea(){return ta()}function ta(){return new Go((e=>e.toString()),((e,t)=>e.isEqual(t)))}const na=new kr(dr.comparator),sa=new Nr(dr.comparator);function ia(...e){let t=sa;for(const n of e)t=t.add(n);return t}const ra=new Nr(ir);function oa(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ir(t)?"-0":t}}function aa(e){return{integerValue:""+e}}function la(e,t){return function(e){return"number"==typeof e&&Number.isInteger(e)&&!Ir(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}(t)?aa(t):oa(e,t)}class ca{constructor(){this._=void 0}}function ua(e,t,n){return e instanceof fa?function(e,t){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&Br(t)&&(t=Ur(t)),t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof ga?ma(e,t):e instanceof pa?ya(e,t):function(e,t){const n=da(e,t),s=wa(n)+wa(e.Te);return Jr(n)&&Jr(e.Te)?aa(s):oa(e.serializer,s)}(e,t)}function ha(e,t,n){return e instanceof ga?ma(e,t):e instanceof pa?ya(e,t):n}function da(e,t){return e instanceof va?function(e){return Jr(e)||function(e){return!!e&&"doubleValue"in e}(e)}(t)?t:{integerValue:0}:null}class fa extends ca{}class ga extends ca{constructor(e){super(),this.elements=e}}function ma(e,t){const n=Ea(t);for(const t of e.elements)n.some((e=>Kr(e,t)))||n.push(t);return{arrayValue:{values:n}}}class pa extends ca{constructor(e){super(),this.elements=e}}function ya(e,t){let n=Ea(t);for(const t of e.elements)n=n.filter((e=>!Kr(e,t)));return{arrayValue:{values:n}}}class va extends ca{constructor(e,t){super(),this.serializer=e,this.Te=t}}function wa(e){return Fr(e.integerValue||e.doubleValue)}function Ea(e){return Zr(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class ba{constructor(e,t){this.version=e,this.transformResults=t}}class _a{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new _a}static exists(e){return new _a(void 0,e)}static updateTime(e){return new _a(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Ia(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class Sa{}function Ta(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new Pa(e.key,_a.none()):new Na(e.key,e.data,_a.none());{const n=e.data,s=ro.empty();let i=new Nr(hr.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?s.delete(e):s.set(e,t),i=i.add(e)}return new xa(e.key,s,new Lr(i.toArray()),_a.none())}}function Ca(e,t,n){e instanceof Na?function(e,t,n){const s=e.value.clone(),i=Ra(e.fieldTransforms,t,n.transformResults);s.setAll(i),t.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(e,t,n):e instanceof xa?function(e,t,n){if(!Ia(e.precondition,t))return void t.convertToUnknownDocument(n.version);const s=Ra(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(La(e)),i.setAll(s),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function ka(e,t,n,s){return e instanceof Na?function(e,t,n,s){if(!Ia(e.precondition,t))return n;const i=e.value.clone(),r=Ma(e.fieldTransforms,s,t);return i.setAll(r),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,s):e instanceof xa?function(e,t,n,s){if(!Ia(e.precondition,t))return n;const i=Ma(e.fieldTransforms,s,t),r=t.data;return r.setAll(La(e)),r.setAll(i),t.convertToFoundDocument(t.version,r).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map((e=>e.field)))}(e,t,n,s):function(e,t,n){return Ia(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function Aa(e,t){let n=null;for(const s of e.fieldTransforms){const e=t.data.field(s.field),i=da(s.transform,e||null);null!=i&&(null===n&&(n=ro.empty()),n.set(s.field,i))}return n||null}function Da(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&rr(e,t,((e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof ga&&t instanceof ga||e instanceof pa&&t instanceof pa?rr(e.elements,t.elements,Kr):e instanceof va&&t instanceof va?Kr(e.Te,t.Te):e instanceof fa&&t instanceof fa}(e.transform,t.transform)}(e,t)))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class Na extends Sa{constructor(e,t,n,s=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class xa extends Sa{constructor(e,t,n,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function La(e){const t=new Map;return e.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const s=e.data.field(n);t.set(n,s)}})),t}function Ra(e,t,n){const s=new Map;ji(e.length===n.length);for(let i=0;i<n.length;i++){const r=e[i],o=r.transform,a=t.data.field(r.field);s.set(r.field,ha(o,a,n[i]))}return s}function Ma(e,t,n){const s=new Map;for(const i of e){const e=i.transform,r=n.data.field(i.field);s.set(i.field,ua(e,r,t))}return s}class Pa extends Sa{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Oa extends Sa{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Fa{constructor(e,t,n,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=s}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){const s=this.mutations[t];s.key.isEqual(e.key)&&Ca(s,e,n[t])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=ka(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=ka(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=ea();return this.mutations.forEach((s=>{const i=e.get(s.key),r=i.overlayedDocument;let o=this.applyToLocalView(r,i.mutatedFields);o=t.has(s.key)?null:o;const a=Ta(r,o);null!==a&&n.set(s.key,a),r.isValidDocument()||r.convertToNoDocument(ar.min())})),n}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),ia())}isEqual(e){return this.batchId===e.batchId&&rr(this.mutations,e.mutations,((e,t)=>Da(e,t)))&&rr(this.baseMutations,e.baseMutations,((e,t)=>Da(e,t)))}}class Va{constructor(e,t,n,s){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=s}static from(e,t,n){ji(e.mutations.length===n.length);let s=na;const i=e.mutations;for(let e=0;e<i.length;e++)s=s.insert(i[e].key,n[e].version);return new Va(e,t,n,s)}}class Ba{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Ua{constructor(e,t){this.count=e,this.unchangedNames=t}}var qa,$a;function ja(e){if(void 0===e)return Bi("GRPC error has no .code"),Hi.UNKNOWN;switch(e){case qa.OK:return Hi.OK;case qa.CANCELLED:return Hi.CANCELLED;case qa.UNKNOWN:return Hi.UNKNOWN;case qa.DEADLINE_EXCEEDED:return Hi.DEADLINE_EXCEEDED;case qa.RESOURCE_EXHAUSTED:return Hi.RESOURCE_EXHAUSTED;case qa.INTERNAL:return Hi.INTERNAL;case qa.UNAVAILABLE:return Hi.UNAVAILABLE;case qa.UNAUTHENTICATED:return Hi.UNAUTHENTICATED;case qa.INVALID_ARGUMENT:return Hi.INVALID_ARGUMENT;case qa.NOT_FOUND:return Hi.NOT_FOUND;case qa.ALREADY_EXISTS:return Hi.ALREADY_EXISTS;case qa.PERMISSION_DENIED:return Hi.PERMISSION_DENIED;case qa.FAILED_PRECONDITION:return Hi.FAILED_PRECONDITION;case qa.ABORTED:return Hi.ABORTED;case qa.OUT_OF_RANGE:return Hi.OUT_OF_RANGE;case qa.UNIMPLEMENTED:return Hi.UNIMPLEMENTED;case qa.DATA_LOSS:return Hi.DATA_LOSS;default:return $i()}}($a=qa||(qa={}))[$a.OK=0]="OK",$a[$a.CANCELLED=1]="CANCELLED",$a[$a.UNKNOWN=2]="UNKNOWN",$a[$a.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",$a[$a.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",$a[$a.NOT_FOUND=5]="NOT_FOUND",$a[$a.ALREADY_EXISTS=6]="ALREADY_EXISTS",$a[$a.PERMISSION_DENIED=7]="PERMISSION_DENIED",$a[$a.UNAUTHENTICATED=16]="UNAUTHENTICATED",$a[$a.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",$a[$a.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",$a[$a.ABORTED=10]="ABORTED",$a[$a.OUT_OF_RANGE=11]="OUT_OF_RANGE",$a[$a.UNIMPLEMENTED=12]="UNIMPLEMENTED",$a[$a.INTERNAL=13]="INTERNAL",$a[$a.UNAVAILABLE=14]="UNAVAILABLE",$a[$a.DATA_LOSS=15]="DATA_LOSS";class za{constructor(){this.onExistenceFilterMismatchCallbacks=new Map}static get instance(){return Ha}static getOrCreateInstance(){return null===Ha&&(Ha=new za),Ha}onExistenceFilterMismatch(e){const t=Symbol();return this.onExistenceFilterMismatchCallbacks.set(t,e),()=>this.onExistenceFilterMismatchCallbacks.delete(t)}notifyOnExistenceFilterMismatch(e){this.onExistenceFilterMismatchCallbacks.forEach((t=>t(e)))}}let Ha=null;const Ka=new Li([4294967295,4294967295],0);function Ga(e){const t=(new TextEncoder).encode(e),n=new xi;return n.update(t),new Uint8Array(n.digest())}function Qa(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),s=t.getUint32(4,!0),i=t.getUint32(8,!0),r=t.getUint32(12,!0);return[new Li([n,s],0),new Li([i,r],0)]}class Wa{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new Xa(`Invalid padding: ${t}`);if(n<0)throw new Xa(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new Xa(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new Xa(`Invalid padding when bitmap length is 0: ${t}`);this.de=8*e.length-t,this.Ae=Li.fromNumber(this.de)}Re(e,t,n){let s=e.add(t.multiply(Li.fromNumber(n)));return 1===s.compare(Ka)&&(s=new Li([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Ae).toNumber()}Ve(e){return 0!=(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.de)return!1;const t=Ga(e),[n,s]=Qa(t);for(let e=0;e<this.hashCount;e++){const t=this.Re(n,s,e);if(!this.Ve(t))return!1}return!0}static create(e,t,n){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),r=new Wa(i,s,t);return n.forEach((e=>r.insert(e))),r}insert(e){if(0===this.de)return;const t=Ga(e),[n,s]=Qa(t);for(let e=0;e<this.hashCount;e++){const t=this.Re(n,s,e);this.me(t)}}me(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class Xa extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Ya{constructor(e,t,n,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const s=new Map;return s.set(e,Ja.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new Ya(ar.min(),s,new kr(ir),Wo(),ia())}}class Ja{constructor(e,t,n,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new Ja(n,t,ia(),ia(),ia())}}class Za{constructor(e,t,n,s){this.fe=e,this.removedTargetIds=t,this.key=n,this.ge=s}}class el{constructor(e,t){this.targetId=e,this.pe=t}}class tl{constructor(e,t,n=Mr.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=s}}class nl{constructor(){this.ye=0,this.we=rl(),this.Se=Mr.EMPTY_BYTE_STRING,this.be=!1,this.De=!0}get current(){return this.be}get resumeToken(){return this.Se}get ve(){return 0!==this.ye}get Ce(){return this.De}Fe(e){e.approximateByteSize()>0&&(this.De=!0,this.Se=e)}Me(){let e=ia(),t=ia(),n=ia();return this.we.forEach(((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:n=n.add(s);break;default:$i()}})),new Ja(this.Se,this.be,e,t,n)}xe(){this.De=!1,this.we=rl()}Oe(e,t){this.De=!0,this.we=this.we.insert(e,t)}Ne(e){this.De=!0,this.we=this.we.remove(e)}Be(){this.ye+=1}Le(){this.ye-=1}ke(){this.De=!0,this.be=!0}}class sl{constructor(e){this.qe=e,this.Qe=new Map,this.Ke=Wo(),this.$e=il(),this.Ue=new kr(ir)}We(e){for(const t of e.fe)e.ge&&e.ge.isFoundDocument()?this.Ge(t,e.ge):this.ze(t,e.key,e.ge);for(const t of e.removedTargetIds)this.ze(t,e.key,e.ge)}je(e){this.forEachTarget(e,(t=>{const n=this.He(t);switch(e.state){case 0:this.Je(t)&&n.Fe(e.resumeToken);break;case 1:n.Le(),n.ve||n.xe(),n.Fe(e.resumeToken);break;case 2:n.Le(),n.ve||this.removeTarget(t);break;case 3:this.Je(t)&&(n.ke(),n.Fe(e.resumeToken));break;case 4:this.Je(t)&&(this.Ye(t),n.Fe(e.resumeToken));break;default:$i()}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Qe.forEach(((e,n)=>{this.Je(n)&&t(n)}))}Ze(e){var t,n;const s=e.targetId,i=e.pe.count,r=this.Xe(s);if(r){const o=r.target;if(Mo(o))if(0===i){const e=new dr(o.path);this.ze(s,e,ao.newNoDocument(e,ar.min()))}else ji(1===i);else{const r=this.et(s);if(r!==i){const i=this.tt(e,r);if(0!==i.status){this.Ye(s);const e=2===i.status?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ue=this.Ue.insert(s,e)}null===(t=za.instance)||void 0===t||t.notifyOnExistenceFilterMismatch(function(e,t,n,s){var i,r,o,a,l,c;const u={localCacheCount:n,existenceFilterCount:s.count},h=s.unchangedNames;return h&&(u.bloomFilter={applied:0===e,hashCount:null!==(i=null==h?void 0:h.hashCount)&&void 0!==i?i:0,bitmapLength:null!==(a=null===(o=null===(r=null==h?void 0:h.bits)||void 0===r?void 0:r.bitmap)||void 0===o?void 0:o.length)&&void 0!==a?a:0,padding:null!==(c=null===(l=null==h?void 0:h.bits)||void 0===l?void 0:l.padding)&&void 0!==c?c:0},t&&(u.bloomFilter.mightContain=t)),u}(i.status,null!==(n=i.nt)&&void 0!==n?n:null,r,e.pe))}}}}tt(e,t){const{unchangedNames:n,count:s}=e.pe;if(!n||!n.bits)return{status:1};const{bits:{bitmap:i="",padding:r=0},hashCount:o=0}=n;let a,l;try{a=Vr(i).toUint8Array()}catch(e){if(e instanceof Rr)return Ui("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),{status:1};throw e}try{l=new Wa(a,r,o)}catch(e){return Ui(e instanceof Xa?"BloomFilter error: ":"Applying bloom filter failed: ",e),{status:1}}const c=e=>{const t=this.qe.rt();return l.mightContain(`projects/${t.projectId}/databases/${t.database}/documents/${e}`)};return 0===l.de?{status:1}:{status:s===t-this.it(e.targetId,c)?0:2,nt:c}}it(e,t){const n=this.qe.getRemoteKeysForTarget(e);let s=0;return n.forEach((n=>{t(n.path.canonicalString())||(this.ze(e,n,null),s++)})),s}st(e){const t=new Map;this.Qe.forEach(((n,s)=>{const i=this.Xe(s);if(i){if(n.current&&Mo(i.target)){const t=new dr(i.target.path);null!==this.Ke.get(t)||this.ot(s,t)||this.ze(s,t,ao.newNoDocument(t,e))}n.Ce&&(t.set(s,n.Me()),n.xe())}}));let n=ia();this.$e.forEach(((e,t)=>{let s=!0;t.forEachWhile((e=>{const t=this.Xe(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(s=!1,!1)})),s&&(n=n.add(e))})),this.Ke.forEach(((t,n)=>n.setReadTime(e)));const s=new Ya(e,t,this.Ue,this.Ke,n);return this.Ke=Wo(),this.$e=il(),this.Ue=new kr(ir),s}Ge(e,t){if(!this.Je(e))return;const n=this.ot(e,t.key)?2:0;this.He(e).Oe(t.key,n),this.Ke=this.Ke.insert(t.key,t),this.$e=this.$e.insert(t.key,this._t(t.key).add(e))}ze(e,t,n){if(!this.Je(e))return;const s=this.He(e);this.ot(e,t)?s.Oe(t,1):s.Ne(t),this.$e=this.$e.insert(t,this._t(t).delete(e)),n&&(this.Ke=this.Ke.insert(t,n))}removeTarget(e){this.Qe.delete(e)}et(e){const t=this.He(e).Me();return this.qe.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Be(e){this.He(e).Be()}He(e){let t=this.Qe.get(e);return t||(t=new nl,this.Qe.set(e,t)),t}_t(e){let t=this.$e.get(e);return t||(t=new Nr(ir),this.$e=this.$e.insert(e,t)),t}Je(e){const t=null!==this.Xe(e);return t||Vi("WatchChangeAggregator","Detected inactive target",e),t}Xe(e){const t=this.Qe.get(e);return t&&t.ve?null:this.qe.ut(e)}Ye(e){this.Qe.set(e,new nl),this.qe.getRemoteKeysForTarget(e).forEach((t=>{this.ze(e,t,null)}))}ot(e,t){return this.qe.getRemoteKeysForTarget(e).has(t)}}function il(){return new kr(dr.comparator)}function rl(){return new kr(dr.comparator)}const ol={asc:"ASCENDING",desc:"DESCENDING"},al={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},ll={and:"AND",or:"OR"};class cl{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function ul(e,t){return e.useProto3Json||_r(t)?t:{value:t}}function hl(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function dl(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function fl(e,t){return hl(e,t.toTimestamp())}function gl(e){return ji(!!e),ar.fromTimestamp(function(e){const t=Or(e);return new or(t.seconds,t.nanos)}(e))}function ml(e,t){return function(e){return new cr(["projects",e.projectId,"databases",e.database])}(e).child("documents").child(t).canonicalString()}function pl(e){const t=cr.fromString(e);return ji(Ml(t)),t}function yl(e,t){return ml(e.databaseId,t.path)}function vl(e,t){const n=pl(t);if(n.get(1)!==e.databaseId.projectId)throw new Ki(Hi.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new Ki(Hi.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new dr(bl(n))}function wl(e,t){return ml(e.databaseId,t)}function El(e){return new cr(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function bl(e){return ji(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function _l(e,t,n){return{name:yl(e,t),fields:n.value.mapValue.fields}}function Il(e,t){return{documents:[wl(e,t.path)]}}function Sl(e,t){const n={structuredQuery:{}},s=t.path;null!==t.collectionGroup?(n.parent=wl(e,s),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=wl(e,s.popLast()),n.structuredQuery.from=[{collectionId:s.lastSegment()}]);const i=function(e){if(0!==e.length)return Ll(po.create(e,"and"))}(t.filters);i&&(n.structuredQuery.where=i);const r=function(e){if(0!==e.length)return e.map((e=>function(e){return{field:Nl(e.field),direction:kl(e.dir)}}(e)))}(t.orderBy);r&&(n.structuredQuery.orderBy=r);const o=ul(e,t.limit);return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt=function(e){return{before:e.inclusive,values:e.position}}(t.startAt)),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),n}function Tl(e){let t=function(e){const t=pl(e);return 4===t.length?cr.emptyPath():bl(t)}(e.parent);const n=e.structuredQuery,s=n.from?n.from.length:0;let i=null;if(s>0){ji(1===s);const e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let r=[];n.where&&(r=function(e){const t=Cl(e);return t instanceof po&&vo(t)?t.getFilters():[t]}(n.where));let o=[];n.orderBy&&(o=function(e){return e.map((e=>function(e){return new ho(xl(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e)))}(n.orderBy));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,_r(t)?null:t}(n.limit));let l=null;n.startAt&&(l=function(e){const t=!!e.before,n=e.values||[];return new lo(n,t)}(n.startAt));let c=null;return n.endAt&&(c=function(e){const t=!e.before,n=e.values||[];return new lo(n,t)}(n.endAt)),function(e,t,n,s,i,r,o,a){return new Po(e,t,n,s,i,r,o,a)}(t,i,o,r,a,"F",l,c)}function Cl(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=xl(e.unaryFilter.field);return mo.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=xl(e.unaryFilter.field);return mo.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=xl(e.unaryFilter.field);return mo.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=xl(e.unaryFilter.field);return mo.create(i,"!=",{nullValue:"NULL_VALUE"});default:return $i()}}(e):void 0!==e.fieldFilter?function(e){return mo.create(xl(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return $i()}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return po.create(e.compositeFilter.filters.map((e=>Cl(e))),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return $i()}}(e.compositeFilter.op))}(e):$i()}function kl(e){return ol[e]}function Al(e){return al[e]}function Dl(e){return ll[e]}function Nl(e){return{fieldPath:e.canonicalString()}}function xl(e){return hr.fromServerFormat(e.fieldPath)}function Ll(e){return e instanceof mo?function(e){if("=="===e.op){if(to(e.value))return{unaryFilter:{field:Nl(e.field),op:"IS_NAN"}};if(eo(e.value))return{unaryFilter:{field:Nl(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(to(e.value))return{unaryFilter:{field:Nl(e.field),op:"IS_NOT_NAN"}};if(eo(e.value))return{unaryFilter:{field:Nl(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Nl(e.field),op:Al(e.op),value:e.value}}}(e):e instanceof po?function(e){const t=e.getFilters().map((e=>Ll(e)));return 1===t.length?t[0]:{compositeFilter:{op:Dl(e.op),filters:t}}}(e):$i()}function Rl(e){const t=[];return e.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function Ml(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class Pl{constructor(e,t,n,s,i=ar.min(),r=ar.min(),o=Mr.EMPTY_BYTE_STRING,a=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=r,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(e){return new Pl(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Pl(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Pl(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Pl(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Ol{constructor(e){this.ct=e}}function Fl(e){const t=Tl({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?Uo(t,t.limit,"L"):t}class Vl{constructor(){}Pt(e,t){this.It(e,t),t.Tt()}It(e,t){if("nullValue"in e)this.Et(t,5);else if("booleanValue"in e)this.Et(t,10),t.dt(e.booleanValue?1:0);else if("integerValue"in e)this.Et(t,15),t.dt(Fr(e.integerValue));else if("doubleValue"in e){const n=Fr(e.doubleValue);isNaN(n)?this.Et(t,13):(this.Et(t,15),Ir(n)?t.dt(0):t.dt(n))}else if("timestampValue"in e){const n=e.timestampValue;this.Et(t,20),"string"==typeof n?t.At(n):(t.At(`${n.seconds||""}`),t.dt(n.nanos||0))}else if("stringValue"in e)this.Rt(e.stringValue,t),this.Vt(t);else if("bytesValue"in e)this.Et(t,30),t.ft(Vr(e.bytesValue)),this.Vt(t);else if("referenceValue"in e)this.gt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.Et(t,45),t.dt(n.latitude||0),t.dt(n.longitude||0)}else"mapValue"in e?io(e)?this.Et(t,Number.MAX_SAFE_INTEGER):(this.yt(e.mapValue,t),this.Vt(t)):"arrayValue"in e?(this.wt(e.arrayValue,t),this.Vt(t)):$i()}Rt(e,t){this.Et(t,25),this.St(e,t)}St(e,t){t.At(e)}yt(e,t){const n=e.fields||{};this.Et(t,55);for(const e of Object.keys(n))this.Rt(e,t),this.It(n[e],t)}wt(e,t){const n=e.values||[];this.Et(t,50);for(const e of n)this.It(e,t)}gt(e,t){this.Et(t,37),dr.fromName(e).path.forEach((e=>{this.Et(t,60),this.St(e,t)}))}Et(e,t){e.dt(t)}Vt(e){e.dt(2)}}Vl.bt=new Vl;class Bl{constructor(){this.sn=new Ul}addToCollectionParentIndex(e,t){return this.sn.add(t),wr.resolve()}getCollectionParents(e,t){return wr.resolve(this.sn.getEntries(t))}addFieldIndex(e,t){return wr.resolve()}deleteFieldIndex(e,t){return wr.resolve()}getDocumentsMatchingTarget(e,t){return wr.resolve(null)}getIndexType(e,t){return wr.resolve(0)}getFieldIndexes(e,t){return wr.resolve([])}getNextCollectionGroupToUpdate(e){return wr.resolve(null)}getMinOffset(e,t){return wr.resolve(gr.min())}getMinOffsetFromCollectionGroup(e,t){return wr.resolve(gr.min())}updateCollectionGroup(e,t,n){return wr.resolve()}updateIndexEntries(e,t){return wr.resolve()}}class Ul{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),s=this.index[t]||new Nr(cr.comparator),i=!s.has(n);return this.index[t]=s.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),s=this.index[t];return s&&s.has(n)}getEntries(e){return(this.index[e]||new Nr(cr.comparator)).toArray()}}new Uint8Array(0);class ql{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new ql(e,ql.DEFAULT_COLLECTION_PERCENTILE,ql.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}ql.DEFAULT_COLLECTION_PERCENTILE=10,ql.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ql.DEFAULT=new ql(41943040,ql.DEFAULT_COLLECTION_PERCENTILE,ql.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ql.DISABLED=new ql(-1,0,0);class $l{constructor(e){this.Mn=e}next(){return this.Mn+=2,this.Mn}static xn(){return new $l(0)}static On(){return new $l(-1)}}class jl{constructor(){this.changes=new Go((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ao.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?wr.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class zl{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class Hl{constructor(e,t,n,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=s}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next((s=>(n=s,this.remoteDocumentCache.getEntry(e,t)))).next((e=>(null!==n&&ka(n.mutation,e,Lr.empty(),or.now()),e)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.getLocalViewOfDocuments(e,t,ia()).next((()=>t))))}getLocalViewOfDocuments(e,t,n=ia()){const s=Zo();return this.populateOverlays(e,s,t).next((()=>this.computeViews(e,t,s,n).next((e=>{let t=Yo();return e.forEach(((e,n)=>{t=t.insert(e,n.overlayedDocument)})),t}))))}getOverlayedDocuments(e,t){const n=Zo();return this.populateOverlays(e,n,t).next((()=>this.computeViews(e,t,n,ia())))}populateOverlays(e,t,n){const s=[];return n.forEach((e=>{t.has(e)||s.push(e)})),this.documentOverlayCache.getOverlays(e,s).next((e=>{e.forEach(((e,n)=>{t.set(e,n)}))}))}computeViews(e,t,n,s){let i=Wo();const r=ta(),o=ta();return t.forEach(((e,t)=>{const o=n.get(t.key);s.has(t.key)&&(void 0===o||o.mutation instanceof xa)?i=i.insert(t.key,t):void 0!==o?(r.set(t.key,o.mutation.getFieldMask()),ka(o.mutation,t,o.mutation.getFieldMask(),or.now())):r.set(t.key,Lr.empty())})),this.recalculateAndSaveOverlays(e,i).next((e=>(e.forEach(((e,t)=>r.set(e,t))),t.forEach(((e,t)=>{var n;return o.set(e,new zl(t,null!==(n=r.get(e))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(e,t){const n=ta();let s=new kr(((e,t)=>e-t)),i=ia();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((e=>{for(const i of e)i.keys().forEach((e=>{const r=t.get(e);if(null===r)return;let o=n.get(e)||Lr.empty();o=i.applyToLocalView(r,o),n.set(e,o);const a=(s.get(i.batchId)||ia()).add(e);s=s.insert(i.batchId,a)}))})).next((()=>{const r=[],o=s.getReverseIterator();for(;o.hasNext();){const s=o.getNext(),a=s.key,l=s.value,c=ea();l.forEach((e=>{if(!i.has(e)){const s=Ta(t.get(e),n.get(e));null!==s&&c.set(e,s),i=i.add(e)}})),r.push(this.documentOverlayCache.saveOverlays(e,a,c))}return wr.waitFor(r)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.recalculateAndSaveOverlays(e,t)))}getDocumentsMatchingQuery(e,t,n){return function(e){return dr.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):function(e){return null!==e.collectionGroup}(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n):this.getDocumentsMatchingCollectionQuery(e,t,n)}getNextDocuments(e,t,n,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,s).next((i=>{const r=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,s-i.size):wr.resolve(Zo());let o=-1,a=i;return r.next((t=>wr.forEach(t,((t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(t)?wr.resolve():this.remoteDocumentCache.getEntry(e,t).next((e=>{a=a.insert(t,e)}))))).next((()=>this.populateOverlays(e,t,i))).next((()=>this.computeViews(e,a,t,ia()))).next((e=>({batchId:o,changes:Jo(e)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new dr(t)).next((e=>{let t=Yo();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}getDocumentsMatchingCollectionGroupQuery(e,t,n){const s=t.collectionGroup;let i=Yo();return this.indexManager.getCollectionParents(e,s).next((r=>wr.forEach(r,(r=>{const o=function(e,t){return new Po(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,r.child(s));return this.getDocumentsMatchingCollectionQuery(e,o,n).next((e=>{e.forEach(((e,t)=>{i=i.insert(e,t)}))}))})).next((()=>i))))}getDocumentsMatchingCollectionQuery(e,t,n){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next((i=>(s=i,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,s)))).next((e=>{s.forEach(((t,n)=>{const s=n.getKey();null===e.get(s)&&(e=e.insert(s,ao.newInvalidDocument(s)))}));let n=Yo();return e.forEach(((e,i)=>{const r=s.get(e);void 0!==r&&ka(r.mutation,i,Lr.empty(),or.now()),zo(t,i)&&(n=n.insert(e,i))})),n}))}}class Kl{constructor(e){this.serializer=e,this.ar=new Map,this.ur=new Map}getBundleMetadata(e,t){return wr.resolve(this.ar.get(t))}saveBundleMetadata(e,t){return this.ar.set(t.id,function(e){return{id:e.id,version:e.version,createTime:gl(e.createTime)}}(t)),wr.resolve()}getNamedQuery(e,t){return wr.resolve(this.ur.get(t))}saveNamedQuery(e,t){return this.ur.set(t.name,function(e){return{name:e.name,query:Fl(e.bundledQuery),readTime:gl(e.readTime)}}(t)),wr.resolve()}}class Gl{constructor(){this.overlays=new kr(dr.comparator),this.cr=new Map}getOverlay(e,t){return wr.resolve(this.overlays.get(t))}getOverlays(e,t){const n=Zo();return wr.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){return n.forEach(((n,s)=>{this.ht(e,t,s)})),wr.resolve()}removeOverlaysForBatchId(e,t,n){const s=this.cr.get(n);return void 0!==s&&(s.forEach((e=>this.overlays=this.overlays.remove(e))),this.cr.delete(n)),wr.resolve()}getOverlaysForCollection(e,t,n){const s=Zo(),i=t.length+1,r=new dr(t.child("")),o=this.overlays.getIteratorFrom(r);for(;o.hasNext();){const e=o.getNext().value,r=e.getKey();if(!t.isPrefixOf(r.path))break;r.path.length===i&&e.largestBatchId>n&&s.set(e.getKey(),e)}return wr.resolve(s)}getOverlaysForCollectionGroup(e,t,n,s){let i=new kr(((e,t)=>e-t));const r=this.overlays.getIterator();for(;r.hasNext();){const e=r.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=Zo(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=Zo(),a=i.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((e,t)=>o.set(e,t))),!(o.size()>=s)););return wr.resolve(o)}ht(e,t,n){const s=this.overlays.get(n.key);if(null!==s){const e=this.cr.get(s.largestBatchId).delete(n.key);this.cr.set(s.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new Ba(t,n));let i=this.cr.get(t);void 0===i&&(i=ia(),this.cr.set(t,i)),this.cr.set(t,i.add(n.key))}}class Ql{constructor(){this.lr=new Nr(Wl.hr),this.Pr=new Nr(Wl.Ir)}isEmpty(){return this.lr.isEmpty()}addReference(e,t){const n=new Wl(e,t);this.lr=this.lr.add(n),this.Pr=this.Pr.add(n)}Tr(e,t){e.forEach((e=>this.addReference(e,t)))}removeReference(e,t){this.Er(new Wl(e,t))}dr(e,t){e.forEach((e=>this.removeReference(e,t)))}Ar(e){const t=new dr(new cr([])),n=new Wl(t,e),s=new Wl(t,e+1),i=[];return this.Pr.forEachInRange([n,s],(e=>{this.Er(e),i.push(e.key)})),i}Rr(){this.lr.forEach((e=>this.Er(e)))}Er(e){this.lr=this.lr.delete(e),this.Pr=this.Pr.delete(e)}Vr(e){const t=new dr(new cr([])),n=new Wl(t,e),s=new Wl(t,e+1);let i=ia();return this.Pr.forEachInRange([n,s],(e=>{i=i.add(e.key)})),i}containsKey(e){const t=new Wl(e,0),n=this.lr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class Wl{constructor(e,t){this.key=e,this.mr=t}static hr(e,t){return dr.comparator(e.key,t.key)||ir(e.mr,t.mr)}static Ir(e,t){return ir(e.mr,t.mr)||dr.comparator(e.key,t.key)}}class Xl{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.gr=1,this.pr=new Nr(Wl.hr)}checkEmpty(e){return wr.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,s){const i=this.gr;this.gr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const r=new Fa(i,t,n,s);this.mutationQueue.push(r);for(const t of s)this.pr=this.pr.add(new Wl(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return wr.resolve(r)}lookupMutationBatch(e,t){return wr.resolve(this.yr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,s=this.wr(n),i=s<0?0:s;return wr.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return wr.resolve(0===this.mutationQueue.length?-1:this.gr-1)}getAllMutationBatches(e){return wr.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new Wl(t,0),s=new Wl(t,Number.POSITIVE_INFINITY),i=[];return this.pr.forEachInRange([n,s],(e=>{const t=this.yr(e.mr);i.push(t)})),wr.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Nr(ir);return t.forEach((e=>{const t=new Wl(e,0),s=new Wl(e,Number.POSITIVE_INFINITY);this.pr.forEachInRange([t,s],(e=>{n=n.add(e.mr)}))})),wr.resolve(this.Sr(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,s=n.length+1;let i=n;dr.isDocumentKey(i)||(i=i.child(""));const r=new Wl(new dr(i),0);let o=new Nr(ir);return this.pr.forEachWhile((e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===s&&(o=o.add(e.mr)),!0)}),r),wr.resolve(this.Sr(o))}Sr(e){const t=[];return e.forEach((e=>{const n=this.yr(e);null!==n&&t.push(n)})),t}removeMutationBatch(e,t){ji(0===this.br(t.batchId,"removed")),this.mutationQueue.shift();let n=this.pr;return wr.forEach(t.mutations,(s=>{const i=new Wl(s.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)})).next((()=>{this.pr=n}))}Cn(e){}containsKey(e,t){const n=new Wl(t,0),s=this.pr.firstAfterOrEqual(n);return wr.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,wr.resolve()}br(e,t){return this.wr(e)}wr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}yr(e){const t=this.wr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Yl{constructor(e){this.Dr=e,this.docs=new kr(dr.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,s=this.docs.get(n),i=s?s.size:0,r=this.Dr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:r}),this.size+=r-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return wr.resolve(n?n.document.mutableCopy():ao.newInvalidDocument(t))}getEntries(e,t){let n=Wo();return t.forEach((e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():ao.newInvalidDocument(e))})),wr.resolve(n)}getDocumentsMatchingQuery(e,t,n,s){let i=Wo();const r=t.path,o=new dr(r.child("")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:e,value:{document:o}}=a.getNext();if(!r.isPrefixOf(e.path))break;e.path.length>r.length+1||mr(fr(o),n)<=0||(s.has(o.key)||zo(t,o))&&(i=i.insert(o.key,o.mutableCopy()))}return wr.resolve(i)}getAllFromCollectionGroup(e,t,n,s){$i()}vr(e,t){return wr.forEach(this.docs,(e=>t(e)))}newChangeBuffer(e){return new Jl(this)}getSize(e){return wr.resolve(this.size)}}class Jl extends jl{constructor(e){super(),this.sr=e}applyChanges(e){const t=[];return this.changes.forEach(((n,s)=>{s.isValidDocument()?t.push(this.sr.addEntry(e,s)):this.sr.removeEntry(n)})),wr.waitFor(t)}getFromCache(e,t){return this.sr.getEntry(e,t)}getAllFromCache(e,t){return this.sr.getEntries(e,t)}}class Zl{constructor(e){this.persistence=e,this.Cr=new Go((e=>Lo(e)),Ro),this.lastRemoteSnapshotVersion=ar.min(),this.highestTargetId=0,this.Fr=0,this.Mr=new Ql,this.targetCount=0,this.Or=$l.xn()}forEachTarget(e,t){return this.Cr.forEach(((e,n)=>t(n))),wr.resolve()}getLastRemoteSnapshotVersion(e){return wr.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return wr.resolve(this.Fr)}allocateTargetId(e){return this.highestTargetId=this.Or.next(),wr.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Fr&&(this.Fr=t),wr.resolve()}Ln(e){this.Cr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Or=new $l(t),this.highestTargetId=t),e.sequenceNumber>this.Fr&&(this.Fr=e.sequenceNumber)}addTargetData(e,t){return this.Ln(t),this.targetCount+=1,wr.resolve()}updateTargetData(e,t){return this.Ln(t),wr.resolve()}removeTargetData(e,t){return this.Cr.delete(t.target),this.Mr.Ar(t.targetId),this.targetCount-=1,wr.resolve()}removeTargets(e,t,n){let s=0;const i=[];return this.Cr.forEach(((r,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.Cr.delete(r),i.push(this.removeMatchingKeysForTargetId(e,o.targetId)),s++)})),wr.waitFor(i).next((()=>s))}getTargetCount(e){return wr.resolve(this.targetCount)}getTargetData(e,t){const n=this.Cr.get(t)||null;return wr.resolve(n)}addMatchingKeys(e,t,n){return this.Mr.Tr(t,n),wr.resolve()}removeMatchingKeys(e,t,n){this.Mr.dr(t,n);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach((t=>{i.push(s.markPotentiallyOrphaned(e,t))})),wr.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Mr.Ar(t),wr.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Mr.Vr(t);return wr.resolve(n)}containsKey(e,t){return wr.resolve(this.Mr.containsKey(t))}}class ec{constructor(e,t){this.Nr={},this.overlays={},this.Br=new br(0),this.Lr=!1,this.Lr=!0,this.referenceDelegate=e(this),this.kr=new Zl(this),this.indexManager=new Bl,this.remoteDocumentCache=function(e){return new Yl(e)}((e=>this.referenceDelegate.qr(e))),this.serializer=new Ol(t),this.Qr=new Kl(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Lr=!1,Promise.resolve()}get started(){return this.Lr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Gl,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Nr[e.toKey()];return n||(n=new Xl(t,this.referenceDelegate),this.Nr[e.toKey()]=n),n}getTargetCache(){return this.kr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Qr}runTransaction(e,t,n){Vi("MemoryPersistence","Starting transaction:",e);const s=new tc(this.Br.next());return this.referenceDelegate.Kr(),n(s).next((e=>this.referenceDelegate.$r(s).next((()=>e)))).toPromise().then((e=>(s.raiseOnCommittedEvent(),e)))}Ur(e,t){return wr.or(Object.values(this.Nr).map((n=>()=>n.containsKey(e,t))))}}class tc extends yr{constructor(e){super(),this.currentSequenceNumber=e}}class nc{constructor(e){this.persistence=e,this.Wr=new Ql,this.Gr=null}static zr(e){return new nc(e)}get jr(){if(this.Gr)return this.Gr;throw $i()}addReference(e,t,n){return this.Wr.addReference(n,t),this.jr.delete(n.toString()),wr.resolve()}removeReference(e,t,n){return this.Wr.removeReference(n,t),this.jr.add(n.toString()),wr.resolve()}markPotentiallyOrphaned(e,t){return this.jr.add(t.toString()),wr.resolve()}removeTarget(e,t){this.Wr.Ar(t.targetId).forEach((e=>this.jr.add(e.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((e=>{e.forEach((e=>this.jr.add(e.toString())))})).next((()=>n.removeTargetData(e,t)))}Kr(){this.Gr=new Set}$r(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return wr.forEach(this.jr,(n=>{const s=dr.fromPath(n);return this.Hr(e,s).next((e=>{e||t.removeEntry(s,ar.min())}))})).next((()=>(this.Gr=null,t.apply(e))))}updateLimboDocument(e,t){return this.Hr(e,t).next((e=>{e?this.jr.delete(t.toString()):this.jr.add(t.toString())}))}qr(e){return 0}Hr(e,t){return wr.or([()=>wr.resolve(this.Wr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ur(e,t)])}}class sc{constructor(e,t,n,s){this.targetId=e,this.fromCache=t,this.Li=n,this.ki=s}static qi(e,t){let n=ia(),s=ia();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:s=s.add(e.doc.key)}return new sc(e,t.fromCache,n,s)}}class ic{constructor(){this.Qi=!1}initialize(e,t){this.Ki=e,this.indexManager=t,this.Qi=!0}getDocumentsMatchingQuery(e,t,n,s){return this.$i(e,t).next((i=>i||this.Ui(e,t,s,n))).next((n=>n||this.Wi(e,t)))}$i(e,t){if(Fo(t))return wr.resolve(null);let n=Bo(t);return this.indexManager.getIndexType(e,n).next((s=>0===s?null:(null!==t.limit&&1===s&&(t=Uo(t,null,"F"),n=Bo(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next((s=>{const i=ia(...s);return this.Ki.getDocuments(e,i).next((s=>this.indexManager.getMinOffset(e,n).next((n=>{const r=this.Gi(t,s);return this.zi(t,r,i,n.readTime)?this.$i(e,Uo(t,null,"F")):this.ji(e,r,t,n)}))))})))))}Ui(e,t,n,s){return Fo(t)||s.isEqual(ar.min())?this.Wi(e,t):this.Ki.getDocuments(e,n).next((i=>{const r=this.Gi(t,i);return this.zi(t,r,n,s)?this.Wi(e,t):(Fi()<=w.DEBUG&&Vi("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),jo(t)),this.ji(e,r,t,function(e,t){const n=e.toTimestamp().seconds,s=e.toTimestamp().nanoseconds+1,i=ar.fromTimestamp(1e9===s?new or(n+1,0):new or(n,s));return new gr(i,dr.empty(),t)}(s,-1)))}))}Gi(e,t){let n=new Nr(Ho(e));return t.forEach(((t,s)=>{zo(e,s)&&(n=n.add(s))})),n}zi(e,t,n,s){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Wi(e,t){return Fi()<=w.DEBUG&&Vi("QueryEngine","Using full collection scan to execute query:",jo(t)),this.Ki.getDocumentsMatchingQuery(e,t,gr.min())}ji(e,t,n,s){return this.Ki.getDocumentsMatchingQuery(e,n,s).next((e=>(t.forEach((t=>{e=e.insert(t.key,t)})),e)))}}class rc{constructor(e,t,n,s){this.persistence=e,this.Hi=t,this.serializer=s,this.Ji=new kr(ir),this.Yi=new Go((e=>Lo(e)),Ro),this.Zi=new Map,this.Xi=e.getRemoteDocumentCache(),this.kr=e.getTargetCache(),this.Qr=e.getBundleCache(),this.es(n)}es(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Hl(this.Xi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Xi.setIndexManager(this.indexManager),this.Hi.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ji)))}}async function oc(e,t){const n=zi(e);return await n.persistence.runTransaction("Handle user change","readonly",(e=>{let s;return n.mutationQueue.getAllMutationBatches(e).next((i=>(s=i,n.es(t),n.mutationQueue.getAllMutationBatches(e)))).next((t=>{const i=[],r=[];let o=ia();for(const e of s){i.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){r.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return n.localDocuments.getDocuments(e,o).next((e=>({ts:e,removedBatchIds:i,addedBatchIds:r})))}))}))}function ac(e){const t=zi(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.kr.getLastRemoteSnapshotVersion(e)))}function lc(e,t){const n=zi(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t))))}async function cc(e,t,n){const s=zi(e),i=s.Ji.get(t),r=n?"readwrite":"readwrite-primary";try{n||await s.persistence.runTransaction("Release target",r,(e=>s.persistence.referenceDelegate.removeTarget(e,i)))}catch(e){if(!Er(e))throw e;Vi("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}s.Ji=s.Ji.remove(t),s.Yi.delete(i.target)}function uc(e,t,n){const s=zi(e);let i=ar.min(),r=ia();return s.persistence.runTransaction("Execute query","readonly",(e=>function(e,t,n){const s=zi(e),i=s.Yi.get(n);return void 0!==i?wr.resolve(s.Ji.get(i)):s.kr.getTargetData(t,n)}(s,e,Bo(t)).next((t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,s.kr.getMatchingKeysForTargetId(e,t.targetId).next((e=>{r=e}))})).next((()=>s.Hi.getDocumentsMatchingQuery(e,t,n?i:ar.min(),n?r:ia()))).next((e=>(function(e,t,n){let s=e.Zi.get(t)||ar.min();n.forEach(((e,t)=>{t.readTime.compareTo(s)>0&&(s=t.readTime)})),e.Zi.set(t,s)}(s,function(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}(t),e),{documents:e,ss:r})))))}class hc{constructor(){this.activeTargetIds=ra}hs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Ps(e){this.activeTargetIds=this.activeTargetIds.delete(e)}ls(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class dc{constructor(){this.Hs=new hc,this.Js={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.Hs.hs(e),this.Js[e]||"not-current"}updateQueryState(e,t,n){this.Js[e]=t}removeLocalQueryTarget(e){this.Hs.Ps(e)}isLocalQueryTarget(e){return this.Hs.activeTargetIds.has(e)}clearQueryState(e){delete this.Js[e]}getAllActiveQueryTargets(){return this.Hs.activeTargetIds}isActiveQueryTarget(e){return this.Hs.activeTargetIds.has(e)}start(){return this.Hs=new hc,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class fc{Ys(e){}shutdown(){}}class gc{constructor(){this.Zs=()=>this.Xs(),this.eo=()=>this.no(),this.ro=[],this.io()}Ys(e){this.ro.push(e)}shutdown(){window.removeEventListener("online",this.Zs),window.removeEventListener("offline",this.eo)}io(){window.addEventListener("online",this.Zs),window.addEventListener("offline",this.eo)}Xs(){Vi("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ro)e(0)}no(){Vi("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ro)e(1)}static v(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let mc=null;function pc(){return null===mc?mc=268435456+Math.round(2147483648*Math.random()):mc++,"0x"+mc.toString(16)}const yc={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class vc{constructor(e){this.so=e.so,this.oo=e.oo}_o(e){this.ao=e}uo(e){this.co=e}onMessage(e){this.lo=e}close(){this.oo()}send(e){this.so(e)}ho(){this.ao()}Po(e){this.co(e)}Io(e){this.lo(e)}}const wc="WebChannelConnection";class Ec extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.To=t+"://"+e.host,this.Eo=`projects/${n}/databases/${s}`,this.Ao="(default)"===this.databaseId.database?`project_id=${n}`:`project_id=${n}&database_id=${s}`}get Ro(){return!1}Vo(e,t,n,s,i){const r=pc(),o=this.mo(e,t);Vi("RestConnection",`Sending RPC '${e}' ${r}:`,o,n);const a={"google-cloud-resource-prefix":this.Eo,"x-goog-request-params":this.Ao};return this.fo(a,s,i),this.po(e,o,a,n).then((t=>(Vi("RestConnection",`Received RPC '${e}' ${r}: `,t),t)),(t=>{throw Ui("RestConnection",`RPC '${e}' ${r} failed with error: `,t,"url: ",o,"request:",n),t}))}yo(e,t,n,s,i,r){return this.Vo(e,t,n,s,i)}fo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+Pi,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((t,n)=>e[n]=t)),n&&n.headers.forEach(((t,n)=>e[n]=t))}mo(e,t){const n=yc[e];return`${this.To}/v1/${t}:${n}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}po(e,t,n,s){const i=pc();return new Promise(((r,o)=>{const a=new Ni;a.setWithCredentials(!0),a.listenOnce(Ti.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case Si.NO_ERROR:const t=a.getResponseJson();Vi(wc,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(t)),r(t);break;case Si.TIMEOUT:Vi(wc,`RPC '${e}' ${i} timed out`),o(new Ki(Hi.DEADLINE_EXCEEDED,"Request time out"));break;case Si.HTTP_ERROR:const n=a.getStatus();if(Vi(wc,`RPC '${e}' ${i} failed with status:`,n,"response text:",a.getResponseText()),n>0){let e=a.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=null==e?void 0:e.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(Hi).indexOf(t)>=0?t:Hi.UNKNOWN}(t.status);o(new Ki(e,t.message))}else o(new Ki(Hi.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new Ki(Hi.UNAVAILABLE,"Connection failed."));break;default:$i()}}finally{Vi(wc,`RPC '${e}' ${i} completed.`)}}));const l=JSON.stringify(s);Vi(wc,`RPC '${e}' ${i} sending request:`,s),a.send(t,"POST",l,n,15)}))}wo(e,t,n){const s=pc(),i=[this.To,"/","google.firestore.v1.Firestore","/",e,"/channel"],r=_i(),o=Ii(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;void 0!==l&&(a.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(a.xmlHttpFactory=new Ai({})),this.fo(a.initMessageHeaders,t,n),a.encodeInitMessageHeaders=!0;const c=i.join("");Vi(wc,`Creating RPC '${e}' stream ${s}: ${c}`,a);const u=r.createWebChannel(c,a);let h=!1,d=!1;const f=new vc({so:t=>{d?Vi(wc,`Not sending because RPC '${e}' stream ${s} is closed:`,t):(h||(Vi(wc,`Opening RPC '${e}' stream ${s} transport.`),u.open(),h=!0),Vi(wc,`RPC '${e}' stream ${s} sending:`,t),u.send(t))},oo:()=>u.close()}),g=(e,t,n)=>{e.listen(t,(e=>{try{n(e)}catch(e){setTimeout((()=>{throw e}),0)}}))};return g(u,Di.EventType.OPEN,(()=>{d||Vi(wc,`RPC '${e}' stream ${s} transport opened.`)})),g(u,Di.EventType.CLOSE,(()=>{d||(d=!0,Vi(wc,`RPC '${e}' stream ${s} transport closed`),f.Po())})),g(u,Di.EventType.ERROR,(t=>{d||(d=!0,Ui(wc,`RPC '${e}' stream ${s} transport errored:`,t),f.Po(new Ki(Hi.UNAVAILABLE,"The operation could not be completed")))})),g(u,Di.EventType.MESSAGE,(t=>{var n;if(!d){const i=t.data[0];ji(!!i);const r=i,o=r.error||(null===(n=r[0])||void 0===n?void 0:n.error);if(o){Vi(wc,`RPC '${e}' stream ${s} received error:`,o);const t=o.status;let n=function(e){const t=qa[e];if(void 0!==t)return ja(t)}(t),i=o.message;void 0===n&&(n=Hi.INTERNAL,i="Unknown error status: "+t+" with message "+o.message),d=!0,f.Po(new Ki(n,i)),u.close()}else Vi(wc,`RPC '${e}' stream ${s} received:`,i),f.Io(i)}})),g(o,Ci.STAT_EVENT,(t=>{t.stat===ki.PROXY?Vi(wc,`RPC '${e}' stream ${s} detected buffering proxy`):t.stat===ki.NOPROXY&&Vi(wc,`RPC '${e}' stream ${s} detected no buffering proxy`)})),setTimeout((()=>{f.ho()}),0),f}}function bc(){return"undefined"!=typeof document?document:null}function _c(e){return new cl(e,!0)}class Ic{constructor(e,t,n=1e3,s=1.5,i=6e4){this.ii=e,this.timerId=t,this.So=n,this.bo=s,this.Do=i,this.vo=0,this.Co=null,this.Fo=Date.now(),this.reset()}reset(){this.vo=0}Mo(){this.vo=this.Do}xo(e){this.cancel();const t=Math.floor(this.vo+this.Oo()),n=Math.max(0,Date.now()-this.Fo),s=Math.max(0,t-n);s>0&&Vi("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.vo} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Co=this.ii.enqueueAfterDelay(this.timerId,s,(()=>(this.Fo=Date.now(),e()))),this.vo*=this.bo,this.vo<this.So&&(this.vo=this.So),this.vo>this.Do&&(this.vo=this.Do)}No(){null!==this.Co&&(this.Co.skipDelay(),this.Co=null)}cancel(){null!==this.Co&&(this.Co.cancel(),this.Co=null)}Oo(){return(Math.random()-.5)*this.vo}}class Sc{constructor(e,t,n,s,i,r,o,a){this.ii=e,this.Bo=n,this.Lo=s,this.connection=i,this.authCredentialsProvider=r,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.ko=0,this.qo=null,this.Qo=null,this.stream=null,this.Ko=new Ic(e,t)}$o(){return 1===this.state||5===this.state||this.Uo()}Uo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Wo()}async stop(){this.$o()&&await this.close(0)}Go(){this.state=0,this.Ko.reset()}zo(){this.Uo()&&null===this.qo&&(this.qo=this.ii.enqueueAfterDelay(this.Bo,6e4,(()=>this.jo())))}Ho(e){this.Jo(),this.stream.send(e)}async jo(){if(this.Uo())return this.close(0)}Jo(){this.qo&&(this.qo.cancel(),this.qo=null)}Yo(){this.Qo&&(this.Qo.cancel(),this.Qo=null)}async close(e,t){this.Jo(),this.Yo(),this.Ko.cancel(),this.ko++,4!==e?this.Ko.reset():t&&t.code===Hi.RESOURCE_EXHAUSTED?(Bi(t.toString()),Bi("Using maximum backoff delay to prevent overloading the backend."),this.Ko.Mo()):t&&t.code===Hi.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Zo(),this.stream.close(),this.stream=null),this.state=e,await this.listener.uo(t)}Zo(){}auth(){this.state=1;const e=this.Xo(this.ko),t=this.ko;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([e,n])=>{this.ko===t&&this.e_(e,n)}),(t=>{e((()=>{const e=new Ki(Hi.UNKNOWN,"Fetching auth token failed: "+t.message);return this.t_(e)}))}))}e_(e,t){const n=this.Xo(this.ko);this.stream=this.n_(e,t),this.stream._o((()=>{n((()=>(this.state=2,this.Qo=this.ii.enqueueAfterDelay(this.Lo,1e4,(()=>(this.Uo()&&(this.state=3),Promise.resolve()))),this.listener._o())))})),this.stream.uo((e=>{n((()=>this.t_(e)))})),this.stream.onMessage((e=>{n((()=>this.onMessage(e)))}))}Wo(){this.state=5,this.Ko.xo((async()=>{this.state=0,this.start()}))}t_(e){return Vi("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Xo(e){return t=>{this.ii.enqueueAndForget((()=>this.ko===e?t():(Vi("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Tc extends Sc{constructor(e,t,n,s,i,r){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,s,r),this.serializer=i}n_(e,t){return this.connection.wo("Listen",e,t)}onMessage(e){this.Ko.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const s=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:$i()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],r=function(e,t){return e.useProto3Json?(ji(void 0===t||"string"==typeof t),Mr.fromBase64String(t||"")):(ji(void 0===t||t instanceof Uint8Array),Mr.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(e){const t=void 0===e.code?Hi.UNKNOWN:ja(e.code);return new Ki(t,e.message||"")}(o);n=new tl(s,i,r,a||null)}else if("documentChange"in t){t.documentChange;const s=t.documentChange;s.document,s.document.name,s.document.updateTime;const i=vl(e,s.document.name),r=gl(s.document.updateTime),o=s.document.createTime?gl(s.document.createTime):ar.min(),a=new ro({mapValue:{fields:s.document.fields}}),l=ao.newFoundDocument(i,r,o,a),c=s.targetIds||[],u=s.removedTargetIds||[];n=new Za(c,u,l.key,l)}else if("documentDelete"in t){t.documentDelete;const s=t.documentDelete;s.document;const i=vl(e,s.document),r=s.readTime?gl(s.readTime):ar.min(),o=ao.newNoDocument(i,r),a=s.removedTargetIds||[];n=new Za([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;const s=t.documentRemove;s.document;const i=vl(e,s.document),r=s.removedTargetIds||[];n=new Za([],r,i,null)}else{if(!("filter"in t))return $i();{t.filter;const e=t.filter;e.targetId;const{count:s=0,unchangedNames:i}=e,r=new Ua(s,i),o=e.targetId;n=new el(o,r)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return ar.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?ar.min():t.readTime?gl(t.readTime):ar.min()}(e);return this.listener.r_(t,n)}i_(e){const t={};t.database=El(this.serializer),t.addTarget=function(e,t){let n;const s=t.target;if(n=Mo(s)?{documents:Il(e,s)}:{query:Sl(e,s)},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=dl(e,t.resumeToken);const s=ul(e,t.expectedCount);null!==s&&(n.expectedCount=s)}else if(t.snapshotVersion.compareTo(ar.min())>0){n.readTime=hl(e,t.snapshotVersion.toTimestamp());const s=ul(e,t.expectedCount);null!==s&&(n.expectedCount=s)}return n}(this.serializer,e);const n=function(e,t){const n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return $i()}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.Ho(t)}s_(e){const t={};t.database=El(this.serializer),t.removeTarget=e,this.Ho(t)}}class Cc extends Sc{constructor(e,t,n,s,i,r){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,s,r),this.serializer=i,this.o_=!1}get __(){return this.o_}start(){this.o_=!1,this.lastStreamToken=void 0,super.start()}Zo(){this.o_&&this.a_([])}n_(e,t){return this.connection.wo("Write",e,t)}onMessage(e){if(ji(!!e.streamToken),this.lastStreamToken=e.streamToken,this.o_){this.Ko.reset();const t=function(e,t){return e&&e.length>0?(ji(void 0!==t),e.map((e=>function(e,t){let n=e.updateTime?gl(e.updateTime):gl(t);return n.isEqual(ar.min())&&(n=gl(t)),new ba(n,e.transformResults||[])}(e,t)))):[]}(e.writeResults,e.commitTime),n=gl(e.commitTime);return this.listener.u_(n,t)}return ji(!e.writeResults||0===e.writeResults.length),this.o_=!0,this.listener.c_()}l_(){const e={};e.database=El(this.serializer),this.Ho(e)}a_(e){const t={streamToken:this.lastStreamToken,writes:e.map((e=>function(e,t){let n;if(t instanceof Na)n={update:_l(e,t.key,t.value)};else if(t instanceof Pa)n={delete:yl(e,t.key)};else if(t instanceof xa)n={update:_l(e,t.key,t.data),updateMask:Rl(t.fieldMask)};else{if(!(t instanceof Oa))return $i();n={verify:yl(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((e=>function(e,t){const n=t.transform;if(n instanceof fa)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof ga)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof pa)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof va)return{fieldPath:t.field.canonicalString(),increment:n.Te};throw $i()}(0,e)))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:fl(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:$i()}(e,t.precondition)),n}(this.serializer,e)))};this.Ho(t)}}class kc extends class{}{constructor(e,t,n,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=s,this.h_=!1}P_(){if(this.h_)throw new Ki(Hi.FAILED_PRECONDITION,"The client has already been terminated.")}Vo(e,t,n){return this.P_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,i])=>this.connection.Vo(e,t,n,s,i))).catch((e=>{throw"FirebaseError"===e.name?(e.code===Hi.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new Ki(Hi.UNKNOWN,e.toString())}))}yo(e,t,n,s){return this.P_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,r])=>this.connection.yo(e,t,n,i,r,s))).catch((e=>{throw"FirebaseError"===e.name?(e.code===Hi.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new Ki(Hi.UNKNOWN,e.toString())}))}terminate(){this.h_=!0}}class Ac{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.T_=0,this.E_=null,this.d_=!0}A_(){0===this.T_&&(this.R_("Unknown"),this.E_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.E_=null,this.V_("Backend didn't respond within 10 seconds."),this.R_("Offline"),Promise.resolve()))))}m_(e){"Online"===this.state?this.R_("Unknown"):(this.T_++,this.T_>=1&&(this.f_(),this.V_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.R_("Offline")))}set(e){this.f_(),this.T_=0,"Online"===e&&(this.d_=!1),this.R_(e)}R_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}V_(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.d_?(Bi(t),this.d_=!1):Vi("OnlineStateTracker",t)}f_(){null!==this.E_&&(this.E_.cancel(),this.E_=null)}}class Dc{constructor(e,t,n,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.g_=[],this.p_=new Map,this.y_=new Set,this.w_=[],this.S_=i,this.S_.Ys((e=>{n.enqueueAndForget((async()=>{Vc(this)&&(Vi("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=zi(e);t.y_.add(4),await xc(t),t.b_.set("Unknown"),t.y_.delete(4),await Nc(t)}(this))}))})),this.b_=new Ac(n,s)}}async function Nc(e){if(Vc(e))for(const t of e.w_)await t(!0)}async function xc(e){for(const t of e.w_)await t(!1)}function Lc(e,t){const n=zi(e);n.p_.has(t.targetId)||(n.p_.set(t.targetId,t),Fc(n)?Oc(n):tu(n).Uo()&&Mc(n,t))}function Rc(e,t){const n=zi(e),s=tu(n);n.p_.delete(t),s.Uo()&&Pc(n,t),0===n.p_.size&&(s.Uo()?s.zo():Vc(n)&&n.b_.set("Unknown"))}function Mc(e,t){if(e.D_.Be(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(ar.min())>0){const n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}tu(e).i_(t)}function Pc(e,t){e.D_.Be(t),tu(e).s_(t)}function Oc(e){e.D_=new sl({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),ut:t=>e.p_.get(t)||null,rt:()=>e.datastore.serializer.databaseId}),tu(e).start(),e.b_.A_()}function Fc(e){return Vc(e)&&!tu(e).$o()&&e.p_.size>0}function Vc(e){return 0===zi(e).y_.size}function Bc(e){e.D_=void 0}async function Uc(e){e.p_.forEach(((t,n)=>{Mc(e,t)}))}async function qc(e,t){Bc(e),Fc(e)?(e.b_.m_(t),Oc(e)):e.b_.set("Unknown")}async function $c(e,t,n){if(e.b_.set("Online"),t instanceof tl&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const s of t.targetIds)e.p_.has(s)&&(await e.remoteSyncer.rejectListen(s,n),e.p_.delete(s),e.D_.removeTarget(s))}(e,t)}catch(n){Vi("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await jc(e,n)}else if(t instanceof Za?e.D_.We(t):t instanceof el?e.D_.Ze(t):e.D_.je(t),!n.isEqual(ar.min()))try{const t=await ac(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.D_.st(t);return n.targetChanges.forEach(((n,s)=>{if(n.resumeToken.approximateByteSize()>0){const i=e.p_.get(s);i&&e.p_.set(s,i.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach(((t,n)=>{const s=e.p_.get(t);if(!s)return;e.p_.set(t,s.withResumeToken(Mr.EMPTY_BYTE_STRING,s.snapshotVersion)),Pc(e,t);const i=new Pl(s.target,t,n,s.sequenceNumber);Mc(e,i)})),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){Vi("RemoteStore","Failed to raise snapshot:",t),await jc(e,t)}}async function jc(e,t,n){if(!Er(t))throw t;e.y_.add(1),await xc(e),e.b_.set("Offline"),n||(n=()=>ac(e.localStore)),e.asyncQueue.enqueueRetryable((async()=>{Vi("RemoteStore","Retrying IndexedDB access"),await n(),e.y_.delete(1),await Nc(e)}))}function zc(e,t){return t().catch((n=>jc(e,n,t)))}async function Hc(e){const t=zi(e),n=nu(t);let s=t.g_.length>0?t.g_[t.g_.length-1].batchId:-1;for(;Kc(t);)try{const e=await lc(t.localStore,s);if(null===e){0===t.g_.length&&n.zo();break}s=e.batchId,Gc(t,e)}catch(e){await jc(t,e)}Qc(t)&&Wc(t)}function Kc(e){return Vc(e)&&e.g_.length<10}function Gc(e,t){e.g_.push(t);const n=nu(e);n.Uo()&&n.__&&n.a_(t.mutations)}function Qc(e){return Vc(e)&&!nu(e).$o()&&e.g_.length>0}function Wc(e){nu(e).start()}async function Xc(e){nu(e).l_()}async function Yc(e){const t=nu(e);for(const n of e.g_)t.a_(n.mutations)}async function Jc(e,t,n){const s=e.g_.shift(),i=Va.from(s,t,n);await zc(e,(()=>e.remoteSyncer.applySuccessfulWrite(i))),await Hc(e)}async function Zc(e,t){t&&nu(e).__&&await async function(e,t){if(function(e){return function(e){switch(e){default:return $i();case Hi.CANCELLED:case Hi.UNKNOWN:case Hi.DEADLINE_EXCEEDED:case Hi.RESOURCE_EXHAUSTED:case Hi.INTERNAL:case Hi.UNAVAILABLE:case Hi.UNAUTHENTICATED:return!1;case Hi.INVALID_ARGUMENT:case Hi.NOT_FOUND:case Hi.ALREADY_EXISTS:case Hi.PERMISSION_DENIED:case Hi.FAILED_PRECONDITION:case Hi.ABORTED:case Hi.OUT_OF_RANGE:case Hi.UNIMPLEMENTED:case Hi.DATA_LOSS:return!0}}(e)&&e!==Hi.ABORTED}(t.code)){const n=e.g_.shift();nu(e).Go(),await zc(e,(()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t))),await Hc(e)}}(e,t),Qc(e)&&Wc(e)}async function eu(e,t){const n=zi(e);n.asyncQueue.verifyOperationInProgress(),Vi("RemoteStore","RemoteStore received new credentials");const s=Vc(n);n.y_.add(3),await xc(n),s&&n.b_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.y_.delete(3),await Nc(n)}function tu(e){return e.v_||(e.v_=function(e,t,n){const s=zi(e);return s.P_(),new Tc(t,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,n)}(e.datastore,e.asyncQueue,{_o:Uc.bind(null,e),uo:qc.bind(null,e),r_:$c.bind(null,e)}),e.w_.push((async t=>{t?(e.v_.Go(),Fc(e)?Oc(e):e.b_.set("Unknown")):(await e.v_.stop(),Bc(e))}))),e.v_}function nu(e){return e.C_||(e.C_=function(e,t,n){const s=zi(e);return s.P_(),new Cc(t,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,n)}(e.datastore,e.asyncQueue,{_o:Xc.bind(null,e),uo:Zc.bind(null,e),c_:Yc.bind(null,e),u_:Jc.bind(null,e)}),e.w_.push((async t=>{t?(e.C_.Go(),await Hc(e)):(await e.C_.stop(),e.g_.length>0&&(Vi("RemoteStore",`Stopping write stream with ${e.g_.length} pending writes`),e.g_=[]))}))),e.C_}class su{constructor(e,t,n,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=s,this.removalCallback=i,this.deferred=new Gi,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((e=>{}))}static createAndSchedule(e,t,n,s,i){const r=Date.now()+n,o=new su(e,t,r,s,i);return o.start(n),o}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Ki(Hi.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function iu(e,t){if(Bi("AsyncQueue",`${t}: ${e}`),Er(e))return new Ki(Hi.UNAVAILABLE,`${t}: ${e}`);throw e}class ru{constructor(e){this.comparator=e?(t,n)=>e(t,n)||dr.comparator(t.key,n.key):(e,t)=>dr.comparator(e.key,t.key),this.keyedMap=Yo(),this.sortedSet=new kr(this.comparator)}static emptySet(e){return new ru(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof ru))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,s=n.getNext().key;if(!e.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new ru;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class ou{constructor(){this.F_=new kr(dr.comparator)}track(e){const t=e.doc.key,n=this.F_.get(t);n?0!==e.type&&3===n.type?this.F_=this.F_.insert(t,e):3===e.type&&1!==n.type?this.F_=this.F_.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.F_=this.F_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.F_=this.F_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.F_=this.F_.remove(t):1===e.type&&2===n.type?this.F_=this.F_.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.F_=this.F_.insert(t,{type:2,doc:e.doc}):$i():this.F_=this.F_.insert(t,e)}M_(){const e=[];return this.F_.inorderTraversal(((t,n)=>{e.push(n)})),e}}class au{constructor(e,t,n,s,i,r,o,a,l){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=s,this.mutatedKeys=i,this.fromCache=r,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=l}static fromInitialDocuments(e,t,n,s,i){const r=[];return t.forEach((e=>{r.push({type:0,doc:e})})),new au(e,t,ru.emptySet(t),r,n,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&qo(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class lu{constructor(){this.x_=void 0,this.listeners=[]}}class cu{constructor(){this.queries=new Go((e=>$o(e)),qo),this.onlineState="Unknown",this.O_=new Set}}function uu(e,t){const n=zi(e);let s=!1;for(const e of t){const t=e.query,i=n.queries.get(t);if(i){for(const t of i.listeners)t.B_(e)&&(s=!0);i.x_=e}}s&&du(n)}function hu(e,t,n){const s=zi(e),i=s.queries.get(t);if(i)for(const e of i.listeners)e.onError(n);s.queries.delete(t)}function du(e){e.O_.forEach((e=>{e.next()}))}class fu{constructor(e,t,n){this.query=e,this.L_=t,this.k_=!1,this.q_=null,this.onlineState="Unknown",this.options=n||{}}B_(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new au(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.k_?this.Q_(e)&&(this.L_.next(e),t=!0):this.K_(e,this.onlineState)&&(this.U_(e),t=!0),this.q_=e,t}onError(e){this.L_.error(e)}N_(e){this.onlineState=e;let t=!1;return this.q_&&!this.k_&&this.K_(this.q_,e)&&(this.U_(this.q_),t=!0),t}K_(e,t){if(!e.fromCache)return!0;const n="Offline"!==t;return(!this.options.W_||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Q_(e){if(e.docChanges.length>0)return!0;const t=this.q_&&this.q_.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}U_(e){e=au.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.k_=!0,this.L_.next(e)}}class gu{constructor(e){this.key=e}}class mu{constructor(e){this.key=e}}class pu{constructor(e,t){this.query=e,this.X_=t,this.ea=null,this.hasCachedResults=!1,this.current=!1,this.ta=ia(),this.mutatedKeys=ia(),this.na=Ho(e),this.ra=new ru(this.na)}get ia(){return this.X_}sa(e,t){const n=t?t.oa:new ou,s=t?t.ra:this.ra;let i=t?t.mutatedKeys:this.mutatedKeys,r=s,o=!1;const a="F"===this.query.limitType&&s.size===this.query.limit?s.last():null,l="L"===this.query.limitType&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal(((e,t)=>{const c=s.get(e),u=zo(this.query,t)?t:null,h=!!c&&this.mutatedKeys.has(c.key),d=!!u&&(u.hasLocalMutations||this.mutatedKeys.has(u.key)&&u.hasCommittedMutations);let f=!1;c&&u?c.data.isEqual(u.data)?h!==d&&(n.track({type:3,doc:u}),f=!0):this._a(c,u)||(n.track({type:2,doc:u}),f=!0,(a&&this.na(u,a)>0||l&&this.na(u,l)<0)&&(o=!0)):!c&&u?(n.track({type:0,doc:u}),f=!0):c&&!u&&(n.track({type:1,doc:c}),f=!0,(a||l)&&(o=!0)),f&&(u?(r=r.add(u),i=d?i.add(e):i.delete(e)):(r=r.delete(e),i=i.delete(e)))})),null!==this.query.limit)for(;r.size>this.query.limit;){const e="F"===this.query.limitType?r.last():r.first();r=r.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{ra:r,oa:n,zi:o,mutatedKeys:i}}_a(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){const s=this.ra;this.ra=e.ra,this.mutatedKeys=e.mutatedKeys;const i=e.oa.M_();i.sort(((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return $i()}};return n(e)-n(t)}(e.type,t.type)||this.na(e.doc,t.doc))),this.aa(n);const r=t?this.ua():[],o=0===this.ta.size&&this.current?1:0,a=o!==this.ea;return this.ea=o,0!==i.length||a?{snapshot:new au(this.query,e.ra,s,i,e.mutatedKeys,0===o,a,!1,!!n&&n.resumeToken.approximateByteSize()>0),ca:r}:{ca:r}}N_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({ra:this.ra,oa:new ou,mutatedKeys:this.mutatedKeys,zi:!1},!1)):{ca:[]}}la(e){return!this.X_.has(e)&&!!this.ra.has(e)&&!this.ra.get(e).hasLocalMutations}aa(e){e&&(e.addedDocuments.forEach((e=>this.X_=this.X_.add(e))),e.modifiedDocuments.forEach((e=>{})),e.removedDocuments.forEach((e=>this.X_=this.X_.delete(e))),this.current=e.current)}ua(){if(!this.current)return[];const e=this.ta;this.ta=ia(),this.ra.forEach((e=>{this.la(e.key)&&(this.ta=this.ta.add(e.key))}));const t=[];return e.forEach((e=>{this.ta.has(e)||t.push(new mu(e))})),this.ta.forEach((n=>{e.has(n)||t.push(new gu(n))})),t}ha(e){this.X_=e.ss,this.ta=ia();const t=this.sa(e.documents);return this.applyChanges(t,!0)}Pa(){return au.fromInitialDocuments(this.query,this.ra,this.mutatedKeys,0===this.ea,this.hasCachedResults)}}class yu{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class vu{constructor(e){this.key=e,this.Ia=!1}}class wu{constructor(e,t,n,s,i,r){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=r,this.Ta={},this.Ea=new Go((e=>$o(e)),qo),this.da=new Map,this.Aa=new Set,this.Ra=new kr(dr.comparator),this.Va=new Map,this.ma=new Ql,this.fa={},this.ga=new Map,this.pa=$l.On(),this.onlineState="Unknown",this.ya=void 0}get isPrimaryClient(){return!0===this.ya}}async function Eu(e,t){const n=function(e){const t=zi(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=_u.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Ou.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Su.bind(null,t),t.Ta.r_=uu.bind(null,t.eventManager),t.Ta.Sa=hu.bind(null,t.eventManager),t}(e);let s,i;const r=n.Ea.get(t);if(r)s=r.targetId,n.sharedClientState.addLocalQueryTarget(s),i=r.view.Pa();else{const e=await function(e,t){const n=zi(e);return n.persistence.runTransaction("Allocate target","readwrite",(e=>{let s;return n.kr.getTargetData(e,t).next((i=>i?(s=i,wr.resolve(s)):n.kr.allocateTargetId(e).next((i=>(s=new Pl(t,i,"TargetPurposeListen",e.currentSequenceNumber),n.kr.addTargetData(e,s).next((()=>s)))))))})).then((e=>{const s=n.Ji.get(e.targetId);return(null===s||e.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(n.Ji=n.Ji.insert(e.targetId,e),n.Yi.set(t,e.targetId)),e}))}(n.localStore,Bo(t)),r=n.sharedClientState.addLocalQueryTarget(e.targetId);s=e.targetId,i=await async function(e,t,n,s,i){e.wa=(t,n,s)=>async function(e,t,n,s){let i=t.view.sa(n);i.zi&&(i=await uc(e.localStore,t.query,!1).then((({documents:e})=>t.view.sa(e,i))));const r=s&&s.targetChanges.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,r);return xu(e,t.targetId,o.ca),o.snapshot}(e,t,n,s);const r=await uc(e.localStore,t,!0),o=new pu(t,r.ss),a=o.sa(r.documents),l=Ja.createSynthesizedTargetChangeForCurrentChange(n,s&&"Offline"!==e.onlineState,i),c=o.applyChanges(a,e.isPrimaryClient,l);xu(e,n,c.ca);const u=new yu(t,n,o);return e.Ea.set(t,u),e.da.has(n)?e.da.get(n).push(t):e.da.set(n,[t]),c.snapshot}(n,t,s,"current"===r,e.resumeToken),n.isPrimaryClient&&Lc(n.remoteStore,e)}return i}async function bu(e,t){const n=zi(e),s=n.Ea.get(t),i=n.da.get(s.targetId);if(i.length>1)return n.da.set(s.targetId,i.filter((e=>!qo(e,t)))),void n.Ea.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(s.targetId),n.sharedClientState.isActiveQueryTarget(s.targetId)||await cc(n.localStore,s.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(s.targetId),Rc(n.remoteStore,s.targetId),Du(n,s.targetId)})).catch(vr)):(Du(n,s.targetId),await cc(n.localStore,s.targetId,!0))}async function _u(e,t){const n=zi(e);try{const e=await function(e,t){const n=zi(e),s=t.snapshotVersion;let i=n.Ji;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(e=>{const r=n.Xi.newChangeBuffer({trackRemovals:!0});i=n.Ji;const o=[];t.targetChanges.forEach(((r,a)=>{const l=i.get(a);if(!l)return;o.push(n.kr.removeMatchingKeys(e,r.removedDocuments,a).next((()=>n.kr.addMatchingKeys(e,r.addedDocuments,a))));let c=l.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(a)?c=c.withResumeToken(Mr.EMPTY_BYTE_STRING,ar.min()).withLastLimboFreeSnapshotVersion(ar.min()):r.resumeToken.approximateByteSize()>0&&(c=c.withResumeToken(r.resumeToken,s)),i=i.insert(a,c),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(l,c,r)&&o.push(n.kr.updateTargetData(e,c))}));let a=Wo(),l=ia();if(t.documentUpdates.forEach((s=>{t.resolvedLimboDocuments.has(s)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,s))})),o.push(function(e,t,n){let s=ia(),i=ia();return n.forEach((e=>s=s.add(e))),t.getEntries(e,s).next((e=>{let s=Wo();return n.forEach(((n,r)=>{const o=e.get(n);r.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),r.isNoDocument()&&r.version.isEqual(ar.min())?(t.removeEntry(n,r.readTime),s=s.insert(n,r)):!o.isValidDocument()||r.version.compareTo(o.version)>0||0===r.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(r),s=s.insert(n,r)):Vi("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",r.version)})),{ns:s,rs:i}}))}(e,r,t.documentUpdates).next((e=>{a=e.ns,l=e.rs}))),!s.isEqual(ar.min())){const t=n.kr.getLastRemoteSnapshotVersion(e).next((t=>n.kr.setTargetsMetadata(e,e.currentSequenceNumber,s)));o.push(t)}return wr.waitFor(o).next((()=>r.apply(e))).next((()=>n.localDocuments.getLocalViewOfDocuments(e,a,l))).next((()=>a))})).then((e=>(n.Ji=i,e)))}(n.localStore,t);t.targetChanges.forEach(((e,t)=>{const s=n.Va.get(t);s&&(ji(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?s.Ia=!0:e.modifiedDocuments.size>0?ji(s.Ia):e.removedDocuments.size>0&&(ji(s.Ia),s.Ia=!1))})),await Mu(n,e,t)}catch(e){await vr(e)}}function Iu(e,t,n){const s=zi(e);if(s.isPrimaryClient&&0===n||!s.isPrimaryClient&&1===n){const e=[];s.Ea.forEach(((n,s)=>{const i=s.view.N_(t);i.snapshot&&e.push(i.snapshot)})),function(e,t){const n=zi(e);n.onlineState=t;let s=!1;n.queries.forEach(((e,n)=>{for(const e of n.listeners)e.N_(t)&&(s=!0)})),s&&du(n)}(s.eventManager,t),e.length&&s.Ta.r_(e),s.onlineState=t,s.isPrimaryClient&&s.sharedClientState.setOnlineState(t)}}async function Su(e,t,n){const s=zi(e);s.sharedClientState.updateQueryState(t,"rejected",n);const i=s.Va.get(t),r=i&&i.key;if(r){let e=new kr(dr.comparator);e=e.insert(r,ao.newNoDocument(r,ar.min()));const n=ia().add(r),i=new Ya(ar.min(),new Map,new kr(ir),e,n);await _u(s,i),s.Ra=s.Ra.remove(r),s.Va.delete(t),Ru(s)}else await cc(s.localStore,t,!1).then((()=>Du(s,t,n))).catch(vr)}async function Tu(e,t){const n=zi(e),s=t.batch.batchId;try{const e=await function(e,t){const n=zi(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(e=>{const s=t.batch.keys(),i=n.Xi.newChangeBuffer({trackRemovals:!0});return function(e,t,n,s){const i=n.batch,r=i.keys();let o=wr.resolve();return r.forEach((e=>{o=o.next((()=>s.getEntry(t,e))).next((t=>{const r=n.docVersions.get(e);ji(null!==r),t.version.compareTo(r)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),s.addEntry(t)))}))})),o.next((()=>e.mutationQueue.removeMutationBatch(t,i)))}(n,e,t,i).next((()=>i.apply(e))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,s,t.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=ia();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t)))).next((()=>n.localDocuments.getDocuments(e,s)))}))}(n.localStore,t);Au(n,s,null),ku(n,s),n.sharedClientState.updateMutationState(s,"acknowledged"),await Mu(n,e)}catch(e){await vr(e)}}async function Cu(e,t,n){const s=zi(e);try{const e=await function(e,t){const n=zi(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",(e=>{let s;return n.mutationQueue.lookupMutationBatch(e,t).next((t=>(ji(null!==t),s=t.keys(),n.mutationQueue.removeMutationBatch(e,t)))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,s,t))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,s))).next((()=>n.localDocuments.getDocuments(e,s)))}))}(s.localStore,t);Au(s,t,n),ku(s,t),s.sharedClientState.updateMutationState(t,"rejected",n),await Mu(s,e)}catch(n){await vr(n)}}function ku(e,t){(e.ga.get(t)||[]).forEach((e=>{e.resolve()})),e.ga.delete(t)}function Au(e,t,n){const s=zi(e);let i=s.fa[s.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),s.fa[s.currentUser.toKey()]=i}}function Du(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const s of e.da.get(t))e.Ea.delete(s),n&&e.Ta.Sa(s,n);e.da.delete(t),e.isPrimaryClient&&e.ma.Ar(t).forEach((t=>{e.ma.containsKey(t)||Nu(e,t)}))}function Nu(e,t){e.Aa.delete(t.path.canonicalString());const n=e.Ra.get(t);null!==n&&(Rc(e.remoteStore,n),e.Ra=e.Ra.remove(t),e.Va.delete(n),Ru(e))}function xu(e,t,n){for(const s of n)s instanceof gu?(e.ma.addReference(s.key,t),Lu(e,s)):s instanceof mu?(Vi("SyncEngine","Document no longer in limbo: "+s.key),e.ma.removeReference(s.key,t),e.ma.containsKey(s.key)||Nu(e,s.key)):$i()}function Lu(e,t){const n=t.key,s=n.path.canonicalString();e.Ra.get(n)||e.Aa.has(s)||(Vi("SyncEngine","New document in limbo: "+n),e.Aa.add(s),Ru(e))}function Ru(e){for(;e.Aa.size>0&&e.Ra.size<e.maxConcurrentLimboResolutions;){const t=e.Aa.values().next().value;e.Aa.delete(t);const n=new dr(cr.fromString(t)),s=e.pa.next();e.Va.set(s,new vu(n)),e.Ra=e.Ra.insert(n,s),Lc(e.remoteStore,new Pl(Bo(Oo(n.path)),s,"TargetPurposeLimboResolution",br.ae))}}async function Mu(e,t,n){const s=zi(e),i=[],r=[],o=[];s.Ea.isEmpty()||(s.Ea.forEach(((e,a)=>{o.push(s.wa(a,t,n).then((e=>{if((e||n)&&s.isPrimaryClient&&s.sharedClientState.updateQueryState(a.targetId,(null==e?void 0:e.fromCache)?"not-current":"current"),e){i.push(e);const t=sc.qi(a.targetId,e);r.push(t)}})))})),await Promise.all(o),s.Ta.r_(i),await async function(e,t){const n=zi(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(e=>wr.forEach(t,(t=>wr.forEach(t.Li,(s=>n.persistence.referenceDelegate.addReference(e,t.targetId,s))).next((()=>wr.forEach(t.ki,(s=>n.persistence.referenceDelegate.removeReference(e,t.targetId,s)))))))))}catch(e){if(!Er(e))throw e;Vi("LocalStore","Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=n.Ji.get(t),s=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(s);n.Ji=n.Ji.insert(t,i)}}}(s.localStore,r))}async function Pu(e,t){const n=zi(e);if(!n.currentUser.isEqual(t)){Vi("SyncEngine","User change. New user:",t.toKey());const e=await oc(n.localStore,t);n.currentUser=t,function(e,t){e.ga.forEach((e=>{e.forEach((e=>{e.reject(new Ki(Hi.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),e.ga.clear()}(n),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await Mu(n,e.ts)}}function Ou(e,t){const n=zi(e),s=n.Va.get(t);if(s&&s.Ia)return ia().add(s.key);{let e=ia();const s=n.da.get(t);if(!s)return e;for(const t of s){const s=n.Ea.get(t);e=e.unionWith(s.view.ia)}return e}}function Fu(e){const t=zi(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Tu.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Cu.bind(null,t),t}class Vu{constructor(){this.synchronizeTabs=!1}async initialize(e){this.serializer=_c(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return function(e,t,n,s){return new rc(e,t,n,s)}(this.persistence,new ic,e.initialUser,this.serializer)}createPersistence(e){return new ec(nc.zr,this.serializer)}createSharedClientState(e){return new dc}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class Bu{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>Iu(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=Pu.bind(null,this.syncEngine),await async function(e,t){const n=zi(e);t?(n.y_.delete(2),await Nc(n)):t||(n.y_.add(2),await xc(n),n.b_.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new cu}createDatastore(e){const t=_c(e.databaseInfo.databaseId),n=function(e){return new Ec(e)}(e.databaseInfo);return function(e,t,n,s){return new kc(e,t,n,s)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(e,t,n,s,i){return new Dc(e,t,n,s,i)}(this.localStore,this.datastore,e.asyncQueue,(e=>Iu(this.syncEngine,e,0)),gc.v()?new gc:new fc)}createSyncEngine(e,t){return function(e,t,n,s,i,r,o){const a=new wu(e,t,n,s,i,r);return o&&(a.ya=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(e){const t=zi(e);Vi("RemoteStore","RemoteStore shutting down."),t.y_.add(5),await xc(t),t.S_.shutdown(),t.b_.set("Unknown")}(this.remoteStore)}}class Uu{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.va(this.observer.next,e)}error(e){this.observer.error?this.va(this.observer.error,e):Bi("Uncaught Error in snapshot listener:",e.toString())}Ca(){this.muted=!0}va(e,t){this.muted||setTimeout((()=>{this.muted||e(t)}),0)}}class qu{constructor(e,t,n,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=s,this.user=Mi.UNAUTHENTICATED,this.clientId=sr.V(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async e=>{Vi("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e})),this.appCheckCredentials.start(n,(e=>(Vi("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user))))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new Ki(Hi.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Gi;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=iu(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}async function $u(e,t){e.asyncQueue.verifyOperationInProgress(),Vi("FirestoreClient","Initializing OfflineComponentProvider");const n=await e.getConfiguration();await t.initialize(n);let s=n.initialUser;e.setCredentialChangeListener((async e=>{s.isEqual(e)||(await oc(t.localStore,e),s=e)})),t.persistence.setDatabaseDeletedListener((()=>e.terminate())),e._offlineComponents=t}async function ju(e,t){e.asyncQueue.verifyOperationInProgress();const n=await async function(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){Vi("FirestoreClient","Using user provided OfflineComponentProvider");try{await $u(e,e._uninitializedComponentsProvider._offline)}catch(t){const n=t;if(!function(e){return"FirebaseError"===e.name?e.code===Hi.FAILED_PRECONDITION||e.code===Hi.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}(n))throw n;Ui("Error using user provided cache. Falling back to memory cache: "+n),await $u(e,new Vu)}}else Vi("FirestoreClient","Using default OfflineComponentProvider"),await $u(e,new Vu);return e._offlineComponents}(e);Vi("FirestoreClient","Initializing OnlineComponentProvider");const s=await e.getConfiguration();await t.initialize(n,s),e.setCredentialChangeListener((e=>eu(t.remoteStore,e))),e.setAppCheckTokenChangeListener(((e,n)=>eu(t.remoteStore,n))),e._onlineComponents=t}async function zu(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(Vi("FirestoreClient","Using user provided OnlineComponentProvider"),await ju(e,e._uninitializedComponentsProvider._online)):(Vi("FirestoreClient","Using default OnlineComponentProvider"),await ju(e,new Bu))),e._onlineComponents}async function Hu(e){const t=await zu(e),n=t.eventManager;return n.onListen=Eu.bind(null,t.syncEngine),n.onUnlisten=bu.bind(null,t.syncEngine),n}function Ku(e,t,n={}){const s=new Gi;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,s,i){const r=new Uu({next:n=>{t.enqueueAndForget((()=>async function(e,t){const n=zi(e),s=t.query;let i=!1;const r=n.queries.get(s);if(r){const e=r.listeners.indexOf(t);e>=0&&(r.listeners.splice(e,1),i=0===r.listeners.length)}if(i)return n.queries.delete(s),n.onUnlisten(s)}(e,o))),n.fromCache&&"server"===s.source?i.reject(new Ki(Hi.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:e=>i.reject(e)}),o=new fu(n,r,{includeMetadataChanges:!0,W_:!0});return async function(e,t){const n=zi(e),s=t.query;let i=!1,r=n.queries.get(s);if(r||(i=!0,r=new lu),i)try{r.x_=await n.onListen(s)}catch(e){const n=iu(e,`Initialization of query '${jo(t.query)}' failed`);return void t.onError(n)}n.queries.set(s,r),r.listeners.push(t),t.N_(n.onlineState),r.x_&&t.B_(r.x_)&&du(n)}(e,o)}(await Hu(e),e.asyncQueue,t,n,s))),s.promise}function Gu(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const Qu=new Map;function Wu(e,t,n){if(!n)throw new Ki(Hi.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function Xu(e){if(!dr.isDocumentKey(e))throw new Ki(Hi.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function Yu(e){if(dr.isDocumentKey(e))throw new Ki(Hi.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function Ju(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return"function"==typeof e?"a function":$i()}function Zu(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new Ki(Hi.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Ju(e);throw new Ki(Hi.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}class eh{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new Ki(Hi.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new Ki(Hi.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,s){if(!0===t&&!0===s)throw new Ki(Hi.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")})(0,e.experimentalForceLongPolling,0,e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Gu(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new Ki(Hi.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new Ki(Hi.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new Ki(Hi.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(e,t){return e.timeoutSeconds===t.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class th{constructor(e,t,n,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new eh({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new Ki(Hi.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new Ki(Hi.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new eh(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new Wi;switch(e.type){case"firstParty":return new Zi(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new Ki(Hi.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=Qu.get(e);t&&(Vi("ComponentProvider","Removing Datastore"),Qu.delete(e),t.terminate())}(this),Promise.resolve()}}class nh{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new nh(this.firestore,e,this._query)}}class sh{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ih(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new sh(this.firestore,e,this._key)}}class ih extends nh{constructor(e,t,n){super(e,t,Oo(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new sh(this.firestore,null,new dr(e))}withConverter(e){return new ih(this.firestore,e,this._path)}}class rh{constructor(){this.Wa=Promise.resolve(),this.Ga=[],this.za=!1,this.ja=[],this.Ha=null,this.Ja=!1,this.Ya=!1,this.Za=[],this.Ko=new Ic(this,"async_queue_retry"),this.Xa=()=>{const e=bc();e&&Vi("AsyncQueue","Visibility state changed to "+e.visibilityState),this.Ko.No()};const e=bc();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Xa)}get isShuttingDown(){return this.za}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.eu(),this.tu(e)}enterRestrictedMode(e){if(!this.za){this.za=!0,this.Ya=e||!1;const t=bc();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Xa)}}enqueue(e){if(this.eu(),this.za)return new Promise((()=>{}));const t=new Gi;return this.tu((()=>this.za&&this.Ya?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Ga.push(e),this.nu())))}async nu(){if(0!==this.Ga.length){try{await this.Ga[0](),this.Ga.shift(),this.Ko.reset()}catch(e){if(!Er(e))throw e;Vi("AsyncQueue","Operation failed with retryable error: "+e)}this.Ga.length>0&&this.Ko.xo((()=>this.nu()))}}tu(e){const t=this.Wa.then((()=>(this.Ja=!0,e().catch((e=>{this.Ha=e,this.Ja=!1;const t=function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e);throw Bi("INTERNAL UNHANDLED ERROR: ",t),e})).then((e=>(this.Ja=!1,e))))));return this.Wa=t,t}enqueueAfterDelay(e,t,n){this.eu(),this.Za.indexOf(e)>-1&&(t=0);const s=su.createAndSchedule(this,e,t,n,(e=>this.ru(e)));return this.ja.push(s),s}eu(){this.Ha&&$i()}verifyOperationInProgress(){}async iu(){let e;do{e=this.Wa,await e}while(e!==this.Wa)}su(e){for(const t of this.ja)if(t.timerId===e)return!0;return!1}ou(e){return this.iu().then((()=>{this.ja.sort(((e,t)=>e.targetTimeMs-t.targetTimeMs));for(const t of this.ja)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.iu()}))}_u(e){this.Za.push(e)}ru(e){const t=this.ja.indexOf(e);this.ja.splice(t,1)}}class oh extends th{constructor(e,t,n,s){super(e,t,n,s),this.type="firestore",this._queue=new rh,this._persistenceKey=(null==s?void 0:s.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||lh(this),this._firestoreClient.terminate()}}function ah(e){return e._firestoreClient||lh(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function lh(e){var t,n,s;const i=e._freezeSettings(),r=function(e,t,n,s){return new $r(e,t,n,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,Gu(s.experimentalLongPollingOptions),s.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,i);e._firestoreClient=new qu(e._authCredentials,e._appCheckCredentials,e._queue,r),(null===(n=i.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(s=i.localCache)||void 0===s?void 0:s._onlineComponentProvider)&&(e._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}class ch{constructor(e){this._byteString=e}static fromBase64String(e){try{return new ch(Mr.fromBase64String(e))}catch(e){throw new Ki(Hi.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new ch(Mr.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class uh{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new Ki(Hi.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new hr(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class hh{constructor(e){this._methodName=e}}class dh{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Ki(Hi.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Ki(Hi.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return ir(this._lat,e._lat)||ir(this._long,e._long)}}const fh=/^__.*__$/;class gh{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new xa(e,this.data,this.fieldMask,t,this.fieldTransforms):new Na(e,this.data,t,this.fieldTransforms)}}function mh(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw $i()}}class ph{constructor(e,t,n,s,i,r){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=s,void 0===i&&this.au(),this.fieldTransforms=i||[],this.fieldMask=r||[]}get path(){return this.settings.path}get uu(){return this.settings.uu}cu(e){return new ph(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}lu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),s=this.cu({path:n,hu:!1});return s.Pu(e),s}Iu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),s=this.cu({path:n,hu:!1});return s.au(),s}Tu(e){return this.cu({path:void 0,hu:!0})}Eu(e){return kh(e,this.settings.methodName,this.settings.du||!1,this.path,this.settings.Au)}contains(e){return void 0!==this.fieldMask.find((t=>e.isPrefixOf(t)))||void 0!==this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))}au(){if(this.path)for(let e=0;e<this.path.length;e++)this.Pu(this.path.get(e))}Pu(e){if(0===e.length)throw this.Eu("Document fields must not be empty");if(mh(this.uu)&&fh.test(e))throw this.Eu('Document fields cannot begin and end with "__"')}}class yh{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||_c(e)}Ru(e,t,n,s=!1){return new ph({uu:e,methodName:t,Au:n,path:hr.emptyPath(),hu:!1,du:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function vh(e){const t=e._freezeSettings(),n=_c(e._databaseId);return new yh(e._databaseId,!!t.ignoreUndefinedProperties,n)}function wh(e,t,n,s,i,r={}){const o=e.Ru(r.merge||r.mergeFields?2:0,t,n,i);Ih("Data must be an object, but it was:",o,s);const a=bh(s,o);let l,c;if(r.merge)l=new Lr(o.fieldMask),c=o.fieldTransforms;else if(r.mergeFields){const e=[];for(const s of r.mergeFields){const i=Sh(t,s,n);if(!o.contains(i))throw new Ki(Hi.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);Ah(e,i)||e.push(i)}l=new Lr(e),c=o.fieldTransforms.filter((e=>l.covers(e.field)))}else l=null,c=o.fieldTransforms;return new gh(new ro(a),l,c)}function Eh(e,t){if(_h(e=f(e)))return Ih("Unsupported field value:",t,e),bh(e,t);if(e instanceof hh)return function(e,t){if(!mh(t.uu))throw t.Eu(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.Eu(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.hu&&4!==t.uu)throw t.Eu("Nested arrays are not supported");return function(e,t){const n=[];let s=0;for(const i of e){let e=Eh(i,t.Tu(s));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),s++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=f(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return la(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=or.fromDate(e);return{timestampValue:hl(t.serializer,n)}}if(e instanceof or){const n=new or(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:hl(t.serializer,n)}}if(e instanceof dh)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof ch)return{bytesValue:dl(t.serializer,e._byteString)};if(e instanceof sh){const n=t.databaseId,s=e.firestore._databaseId;if(!s.isEqual(n))throw t.Eu(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:ml(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.Eu(`Unsupported field value: ${Ju(e)}`)}(e,t)}function bh(e,t){const n={};return Cr(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Tr(e,((e,s)=>{const i=Eh(s,t.lu(e));null!=i&&(n[e]=i)})),{mapValue:{fields:n}}}function _h(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof or||e instanceof dh||e instanceof ch||e instanceof sh||e instanceof hh)}function Ih(e,t,n){if(!_h(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){const s=Ju(n);throw"an object"===s?t.Eu(e+" a custom object"):t.Eu(e+" "+s)}}function Sh(e,t,n){if((t=f(t))instanceof uh)return t._internalPath;if("string"==typeof t)return Ch(e,t);throw kh("Field path arguments must be of type string or ",e,!1,void 0,n)}const Th=new RegExp("[~\\*/\\[\\]]");function Ch(e,t,n){if(t.search(Th)>=0)throw kh(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new uh(...t.split("."))._internalPath}catch(s){throw kh(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function kh(e,t,n,s,i){const r=s&&!s.isEmpty(),o=void 0!==i;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(r||o)&&(l+=" (found",r&&(l+=` in field ${s}`),o&&(l+=` in document ${i}`),l+=")"),new Ki(Hi.INVALID_ARGUMENT,a+e+l)}function Ah(e,t){return e.some((e=>e.isEqual(t)))}class Dh{constructor(e,t,n,s,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new sh(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new Nh(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(xh("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Nh extends Dh{data(){return super.data()}}function xh(e,t){return"string"==typeof t?Ch(e,t):t instanceof uh?t._internalPath:t._delegate._internalPath}class Lh{convertValue(e,t="none"){switch(Hr(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Fr(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Vr(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw $i()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return Tr(e,((e,s)=>{n[e]=this.convertValue(s,t)})),n}convertGeoPoint(e){return new dh(Fr(e.latitude),Fr(e.longitude))}convertArray(e,t){return(e.values||[]).map((e=>this.convertValue(e,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const n=Ur(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(qr(e));default:return null}}convertTimestamp(e){const t=Or(e);return new or(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=cr.fromString(e);ji(Ml(n));const s=new jr(n.get(1),n.get(3)),i=new dr(n.popFirst(5));return s.isEqual(t)||Bi(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}class Rh{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Mh extends Dh{constructor(e,t,n,s,i,r){super(e,t,n,s,r),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Ph(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(xh("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class Ph extends Mh{data(e={}){return super.data(e)}}class Oh{constructor(e,t,n,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new Rh(s.hasPendingWrites,s.fromCache),this.query=n}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach((n=>{e.call(t,new Ph(this._firestore,this._userDataWriter,n.key,n,new Rh(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Ki(Hi.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map((n=>{const s=new Ph(e._firestore,e._userDataWriter,n.doc.key,n.doc,new Rh(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:s,oldIndex:-1,newIndex:t++}}))}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter((e=>t||3!==e.type)).map((t=>{const s=new Ph(e._firestore,e._userDataWriter,t.doc.key,t.doc,new Rh(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let i=-1,r=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),r=n.indexOf(t.doc.key)),{type:Fh(t.type),doc:s,oldIndex:i,newIndex:r}}))}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function Fh(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return $i()}}class Vh extends Lh{constructor(e){super(),this.firestore=e}convertBytes(e){return new ch(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new sh(this.firestore,null,t)}}function Bh(e,t){const n=Zu(e.firestore,oh),s=function(e,t,...n){if(e=f(e),1===arguments.length&&(t=sr.V()),Wu("doc","path",t),e instanceof th){const s=cr.fromString(t,...n);return Xu(s),new sh(e,null,new dr(s))}{if(!(e instanceof sh||e instanceof ih))throw new Ki(Hi.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=e._path.child(cr.fromString(t,...n));return Xu(s),new sh(e.firestore,e instanceof ih?e.converter:null,new dr(s))}}(e),i=function(e,t,n){let s;return s=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,s}(e.converter,t);return function(e,t){return function(e,t){const n=new Gi;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){const s=Fu(e);try{const e=await function(e,t){const n=zi(e),s=or.now(),i=t.reduce(((e,t)=>e.add(t.key)),ia());let r,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(e=>{let a=Wo(),l=ia();return n.Xi.getEntries(e,i).next((e=>{a=e,a.forEach(((e,t)=>{t.isValidDocument()||(l=l.add(e))}))})).next((()=>n.localDocuments.getOverlayedDocuments(e,a))).next((i=>{r=i;const o=[];for(const e of t){const t=Aa(e,r.get(e.key).overlayedDocument);null!=t&&o.push(new xa(e.key,t,oo(t.value.mapValue),_a.exists(!0)))}return n.mutationQueue.addMutationBatch(e,s,o,t)})).next((t=>{o=t;const s=t.applyToLocalDocumentSet(r,l);return n.documentOverlayCache.saveOverlays(e,t.batchId,s)}))})).then((()=>({batchId:o.batchId,changes:Jo(r)})))}(s.localStore,t);s.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let s=e.fa[e.currentUser.toKey()];s||(s=new kr(ir)),s=s.insert(t,n),e.fa[e.currentUser.toKey()]=s}(s,e.batchId,n),await Mu(s,e.changes),await Hc(s.remoteStore)}catch(e){const t=iu(e,"Failed to persist write");n.reject(t)}}(await function(e){return zu(e).then((e=>e.syncEngine))}(e),t,n))),n.promise}(ah(e),t)}(n,[wh(vh(e.firestore),"addDoc",s._key,i,null!==e.converter,{}).toMutation(s._key,_a.exists(!1))]).then((()=>s))}!function(e,t=!0){Pi="10.1.0",J(new g("firestore",((e,{instanceIdentifier:n,options:s})=>{const i=e.getProvider("app").getImmediate(),r=new oh(new Yi(e.getProvider("auth-internal")),new tr(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new Ki(Hi.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new jr(e.options.projectId,t)}(i,n),i);return s=Object.assign({useFetchStreams:t},s),r._setSettings(s),r}),"PUBLIC").setMultipleInstances(!0)),ne(Ri,"4.1.0",e),ne(Ri,"4.1.0","esm2017")}();let Uh,qh,$h,jh,zh,Hh,Kh,Gh=0,Qh=0,Wh=0,Xh=[],Yh=0,Jh=0,Zh=0,ed=!1,td=0,nd=0,sd=[],id=[],rd=!1,od=!1,ad=0,ld=0,cd=0,ud=0,hd=[];function dd(e){const t=document.getElementById(e),n=t.selectedIndex;return t.options[n].textContent}document.getElementById("hotel-id");const fd=["2023-08-10","2023-08-11","2023-08-12","2023-08-13","2023-08-14","2023-08-15","2023-08-16","2023-08-17","2023-08-18","2023-09-15","2023-09-16","2023-09-17","2023-09-18","2023-09-19","2023-09-20","2023-09-21","2023-09-28","2023-09-29","2023-09-30","2023-10-01","2023-10-02","2023-10-03"];function gd(){const e=document.querySelector(".hidden-select"),t=document.querySelector(".hidden-radio"),n=document.querySelector(".hiddenQuestion"),s=document.querySelector(".hidden-two-wheeler"),i=document.querySelector(".two-wheeler-question"),r=document.querySelector(".four-wheeler-question");document.getElementById("self-drive-cars").checked&&(Id(),e.style.display="none",n.style.display="none",s.style.display="none",i.style.display="none",r.style.display="block"),document.getElementById("Vechicle--driver").checked&&(n.style.display="block",t.style.display="none",e.style.display="block",s.style.display="none",i.style.display="none",r.style.display="none"),document.getElementById("Two-Wheeler").checked&&(_d(),t.style.display="none",e.style.display="none",n.style.display="none",i.style.display="block",r.style.display="none")}document.getElementById("no-of-persons").selectedIndex=null,document.getElementById("goa-location1").selectedIndex=null,document.getElementById("goa-location2").selectedIndex=null,document.getElementById("goa-location3").selectedIndex=null,document.getElementById("goa-location4").selectedIndex=null,document.getElementById("food-id").selectedIndex=-1,document.querySelector(".Submit").addEventListener("click",(function(e){console.log("validating before every other Event listner");const t=document.getElementById("no-of-persons"),n=document.getElementById("check-in"),s=document.getElementById("check-out"),i=document.getElementById("hotel-type-id"),r=document.getElementById("food-id");document.querySelector(".add-pickup"),document.querySelector(".add-drop"),console.log(document.querySelector(".add-pickup-drop").textContent);const o=[t,n,s,i,r];for(let e=0;e<o.length;e++)if(!o[e].value)return console.log(`checking the ${o[e].nodeName} field`),o[e].classList.add("error"),setTimeout((()=>{o[e].classList.remove("error")}),1e3),!1;return!0})),document.querySelector(".Submit").addEventListener("click",(function(e){console.log("-----------------------1st Evnt listner it has following cost---------------------------------"),e.preventDefault(),Gh=document.getElementById("no-of-persons").value,console.log("totalPersons "+Gh),Uh=document.getElementById("twoshare"),qh=document.getElementById("threeshare"),$h=document.getElementById("fourshare"),Number(document.getElementById("food-id").value);{jh=function(){let e=0;if(document.getElementById("self-drive-cars").checked&&(e=Id()),document.getElementById("Vechicle--driver").checked){const t=Number(document.getElementById("HQ").value);console.log("switches "+t),wd=Number(document.getElementById("goa-location1").value),Ed=Number(document.getElementById("goa-location2").value),bd=Number(document.getElementById("goa-location3").value);const n=[wd,Ed,bd,6-(wd+Ed+bd)];console.log(n),e=function(e,t){const n=e.fill(-1,t,4),s=Sd();console.log(`You will get ${s} seater`);const i={4:[2500,2500,3e3,5e3],7:[3200,3200,3700,7300],13:[3700,3700,4500,7300],17:[3800,3800,4700,8300],20:[3800,3800,4500,8300],26:[4700,4700,5e3,9700],30:[6e3,6e3,7e3,11e3],40:[7e3,7e3,8e3,12e3]};console.log(i[s]);const r=i[s];console.log(n);const o=n.filter((e=>e>-1));console.log(o);let a=0,l=0,c=Math.trunc(Gh/40);console.log(c),console.log(o.length);for(let e=0;e<=o.length-1;e++)a+=r[o[e]],l+=i[40][o[e]];return console.log("sumForfourties "+l),console.log("sumForfourties* "+l*c),console.log("sum "+a),a+l*c}(n,t+1)}return document.getElementById("Two-Wheeler").checked&&(e=_d()),console.log("sumForSightSeeing :"+e),e}();const e=Sd();zh=Rd(e,Dd.value,Nd.value),Wh=jh+zh,console.log("sightSeeingCost "+jh),console.log("costForPickandDrop "+zh),console.log("_______End of first Event listner____________________________")}})),hd=document.querySelectorAll('input[name="sight-seeing"]'),hd.forEach((e=>{e.addEventListener("click",gd)}));const md=document.querySelector(".goa-span1"),pd=document.querySelector(".goa-span2"),yd=document.querySelector(".goa-span3"),vd=document.querySelector(".goa-span4");document.getElementById("HQ").addEventListener("change",(function(){const e=document.getElementById("HQ").value;switch(console.log(e),e){case"0":md.style.display="block",pd.style.display="none",yd.style.display="none",vd.style.display="none";break;case"1":md.style.display="block",pd.style.display="block",yd.style.display="none",vd.style.display="none";break;case"2":md.style.display="block",pd.style.display="block",yd.style.display="block",vd.style.display="none";break;case"3":md.style.display="block",pd.style.display="block",yd.style.display="block",vd.style.display="block";case" ":md.style.display="block",pd.style.display="block",yd.style.display="block",vd.style.display="block"}}));let wd=document.getElementById("goa-location1").value,Ed=document.getElementById("goa-location2"),bd=document.getElementById("goa-location3");document.getElementById("goa-location4"),document.getElementById("goa-location1").selectedIndex=-1,document.getElementById("goa-location1").addEventListener("change",(function(){document.getElementById("goa-location2").innerHTML='<option value="0">North-Goa I</option>\n  <option value="1">North-Goa II</option>\n  <option value="2">South Goa</option>\n  <option value="3">Extreme south Goa</option>',wd=document.getElementById("goa-location1").value,console.log("selectedLevel1 "+wd),Ed=document.getElementById("goa-location2"),Ed.removeChild(Ed.children[wd]),document.getElementById("goa-location2").selectedIndex=-1})),document.getElementById("goa-location2").addEventListener("change",(function(){document.getElementById("goa-location3").innerHTML='<option value="0">North-Goa I</option>\n  <option value="1">North-Goa II</option>\n  <option value="2">South Goa</option>\n  <option value="3">Extreme south Goa</option>',wd=Number(document.getElementById("goa-location1").value),Ed=Number(document.getElementById("goa-location2").value),document.getElementById("goa-location3").removeChild(document.getElementById("goa-location3").children[Ed]),document.getElementById("goa-location3").removeChild(document.getElementById("goa-location3").children[wd]),document.getElementById("goa-location3").selectedIndex=-1})),document.getElementById("goa-location3").addEventListener("change",(function(){wd=Number(document.getElementById("goa-location1").value),Ed=Number(document.getElementById("goa-location2").value),bd=Number(document.getElementById("goa-location3").value);const e=6-(wd+Ed+bd);document.getElementById("goa-location4").innerHTML=`your Day 4 is set to ${{0:"North-Goa I",1:"North-Goa II",2:"South Goa",3:"Extreme south Goa"}[e]}`}));const _d=function(){document.querySelector(".hidden-two-wheeler").style.display="block",Gh=document.getElementById("no-of-persons").value;const e=document.getElementById("two-wheeler-question").value;document.getElementById("htw").innerHTML=`You Will Get ${Math.round(Gh/2)} bikes`;const t=400*Math.round(Gh/2)*e;return console.log("costForTwoWheeler 1 day: "+400*Math.round(Gh/2)),console.log(`costForTwoWheeler ${e} days: ${t}`),t},Id=function(){Gh=document.getElementById("no-of-persons").value;const e=document.getElementById("four-wheeler-question").value;console.log(Gh);const t=Gh;let n=0,s=0,i=t%8,r=Math.floor(t/8);0==i?(s=r,n=0):t<8?(t<=5&&(n=1,s=0),t>5&&t<8&&(s=1,n=0)):(i<=2&&(s=r-1,n=2),i>=6&&(s=r+1,n=0),i>=3&&i<=5&&(n=1,s=r)),document.getElementById("hr").style.display="block",document.getElementById("hr").innerHTML=`You will get ${s} Eight seater and ${n} Five seater`;const o=(2500*s+1500*n)*e;return console.log("costForSelfDrive for 1 day: "+(2500*s+1500*n)),console.log(`costForSelfDrive for ${e} days: ${o}`),o};function Sd(){let e=0;const t=document.getElementById("no-of-persons").value;console.log("totalPerson "+t);let n=t;return t>40&&(console.log(t%40,Math.trunc(t/40)),n=t%40),n<=4&&(e=4),n>4&&n<=7&&(e=7),n>7&&n<=13&&(e=13),n>13&&n<=17&&(e=17),n>17&&n<=20&&(e=20),n>20&&n<=26&&(e=26),n>26&&n<=30&&(e=30),n>30&&n<=40&&(e=40),e}Gh=document.getElementById("no-of-persons").value;const Td=document.getElementsByClassName("sight");for(let e=0;e<Td.length;e++)Td[e].addEventListener("click",(function(e){let t=this.nextElementSibling;"add-sight"===e.target.className&&(document.querySelector(".content"),t.style.maxHeight?(console.log("hello"),t.style.maxHeight=null):t.style.maxHeight="353px")}));const Cd=document.querySelector(".add-sight");Cd.addEventListener("click",(function(e){e.preventDefault(),"Remove service"===Cd.textContent?Cd.textContent="Add service":Cd.textContent="Remove service"}));const kd=document.querySelector(".pickup-drop-container"),Ad=document.querySelector(".add-pickup-drop"),Dd=document.querySelector(".add-pickup"),Nd=document.querySelector(".add-drop"),xd=document.querySelector(".message-pick-up"),Ld=document.querySelector(".message-drop");document.querySelector(".pick-up-text"),Dd.selectedIndex=Nd.selectedIndex=-1,kd.addEventListener("click",(function(e){if(e.preventDefault(),"add-pickup-drop"===e.target.className){document.querySelector(".pick-drop-content");let e=this.lastElementChild;"Remove service"===Ad.textContent?(Ad.textContent="Add service",console.log("from if"),Dd.value=Nd.value=""):Ad.textContent="Remove service",e.style.maxHeight?e.style.maxHeight=null:e.style.maxHeight=e.scrollHeight+"px"}if(xd.style.visibility=Ld.style.visibility="hidden",console.log(Dd.value),-1!=Dd.selectedIndex){const e=Sd();xd.style.visibility="visible",xd.textContent="Not Needed"!==Dd.value?`A ${e} seater will Pick you at ${Dd.value}`:"Pick up service Removed"}if(-1!=Nd.selectedIndex){const e=Sd();Ld.style.visibility="visible",Ld.textContent="Not Needed"!==Nd.value?`A ${e} seater will Drop you at ${Nd.value}`:"Drop service Removed",Rd(e,Dd.value,Nd.value)}}));const Rd=function(e,t,n){const s=[{vehicle:"4 Seater","Not Needed":0,Madgon:1700,Vasco:1700,Thivim:1e3,"Dabolim Airport":1700,"Mopa Airport":1500,Panjim:1e3,Mapusa:900},{vehicle:"7 Seater","Not Needed":0,Madgon:2200,Vasco:2200,Thivim:1700,"Dabolim Airport":2200,"Mopa Airport":2500,Panjim:1500,Mapusa:1400},{vehicle:"13 Seater","Not Needed":0,Madgon:3200,Vasco:3200,Thivim:2200,"Dabolim Airport":3200,"Mopa Airport":3500,Panjim:2e3,Mapusa:1800},{vehicle:"17 Seater","Not Needed":0,Madgon:4200,Vasco:4200,Thivim:2600,"Dabolim Airport":3800,"Mopa Airport":4500,Panjim:2600,Mapusa:2400},{vehicle:"20 Seater","Not Needed":0,Madgon:4500,Vasco:4500,Thivim:3700,"Dabolim Airport":4500,"Mopa Airport":5200,Panjim:3700,Mapusa:3500},{vehicle:"26 Seater","Not Needed":0,Madgon:5500,Vasco:5500,Thivim:4e3,"Dabolim Airport":5500,"Mopa Airport":5500,Panjim:4e3,Mapusa:3700},{vehicle:"30 Seater","Not Needed":0,Madgon:7e3,Vasco:7e3,Thivim:4500,"Dabolim Airport":7500,"Mopa Airport":7500,Panjim:4500,Mapusa:4e3},{vehicle:"40 Seater","Not Needed":0,Madgon:8e3,Vasco:8e3,Thivim:5e3,"Dabolim Airport":8500,"Mopa Airport":8500,Panjim:5e3,Mapusa:4500}].find((t=>t.vehicle===`${e} Seater`));return"Remove service"==Ad.textContent?s[t]+s[n]:0};document.querySelector(".addon-container").addEventListener("click",(function(e){if(e.preventDefault(),"add-add-on"===e.target.className){console.log(e.target.textContent);let t=this.lastElementChild;console.log(this),e.target.textContent="Remove service"===e.target.textContent?"Add service":"Remove service","Add service"===e.target.textContent&&(document.getElementById("add-on-options").selectedIndex=-1),t.style.maxHeight=t.style.maxHeight?null:t.scrollHeight+"px"}}));const Md=document.getElementById("hotel-id");new MutationObserver(((e,t)=>{for(const t of e)if("childList"===t.type){console.log("Dropdown got filled with options.");break}})).observe(Md,{childList:!0});const Pd={};let Od="1KP1-2HrfPObwMr4_IIEuuS0Vpk_KObKfog7qArUbhxk",Fd="Sheet1",Vd="AIzaSyAiexK0EyyHNWViGEp29zbkCwTnklGYvVc",Bd=document.getElementById("add-on-options");function Ud(e){fetch(`https://sheets.googleapis.com/v4/spreadsheets/${Od}/values/${e}!A1:B12?key=${Vd}`).then((e=>e.json())).then((e=>{console.log(e.values);const t=e.values;for(let e=1;e<t.length;e++){const n=t[e][0],s=t[e][1];Pd[n]=s}Hh=Pd,console.log(Pd);const n=Object.keys(Pd);for(console.log(n);Bd.firstChild;)Bd.removeChild(Bd.firstChild);n.forEach((e=>{const t=document.createElement("option");t.value=e,t.text=e,t.title="press Ctrl to Select more than one option",Bd.appendChild(t)})),Bd.selectedIndex=-1,document.querySelector(".Submit").addEventListener("click",qd)})).catch((e=>{console.error(e)}))}function qd(){let e=[];console.log("                                                                              "),console.log("_____________________I am 2nd Event Listner___________"),console.log(Pd);let t=document.getElementById("add-on-options").selectedOptions;t=Array.from(t).map((e=>e.value)),console.log(t),t.forEach((t=>{Hh=Pd[t],e.push(parseFloat(Hh.replace(/,/g,""))),void 0===Jh&&(Jh=0)})),Jh=e.reduce(((e,t)=>e+t),0),console.log("costForAddon :"+Jh+" "+typeof Jh),console.log(" costForAddon blockDates Included :"+Jh),console.log(`for ${Gh} persons ${Jh*Gh}`),console.log(Wh+" sight seeing + pickup and drop"),Wh=Gh*(Wh+Jh),console.log("room hotel rate "+Yh),console.log("----------------------------End of Event Listner 2--------------------------------------------")}function $d(e,t){console.log("readfing for the "+e),Od="1KP1-2HrfPObwMr4_IIEuuS0Vpk_KObKfog7qArUbhxk",Vd="AIzaSyAiexK0EyyHNWViGEp29zbkCwTnklGYvVc";let n=document.getElementById("hotel-id");fetch(`https://sheets.googleapis.com/v4/spreadsheets/${Od}/values/${e}!${t}?key=${Vd}`).then((e=>e.json())).then((t=>{console.log(t.values);const s=t.values;let i=[];const r=[];let o,a=[];document.getElementById("food-id").addEventListener("change",(function(){for(console.log("-------------------------------------------------------------------------------------"),i=[],a=[],i.push(document.getElementById("twoshare").selectedIndex>0,document.getElementById("threeshare").selectedIndex>0,document.getElementById("fourshare").selectedIndex>0),console.log("roomStatus :"+i),i.forEach(((e,t)=>{!0===e&&r.push(t)})),console.log("truePos :"+r),s.forEach((e=>{let t=[];if(o=Hd(e,this.selectedIndex),0!=o.length){console.log(o),i.forEach(((e,n)=>{t.push(void 0!==o[n])})),console.log("roomsNeeded :"+i),console.log("choosedRoomAvailability :"+t);let e=!1;for(let n=0;n<r.length;n++)e=!0===t[r[n]];e&&(console.log("hotelName :"+Xh),a.push(Xh))}})),console.log(o),function(e,t,n,s){console.log("reading for calcautecostforhetle "+s),document.querySelector(".Submit").addEventListener("click",(function(e){0!==td&&0!==nd||(sd=[]),console.log("sheet name from calcualte hotes cost"+s);let i=0;console.log("originalTotalNights "+ad),console.log("                                    "),console.log("----------------------3rd event listnre for submit----------------------");const r=n.find((e=>e[0]===t.value));console.log(r);const o=Hd(r,document.getElementById("food-id").selectedIndex).map((e=>[e])).map((e=>e[0].slice(-4)));console.log("_______________________________"),console.log(o),console.log("_______________________________");const a=[Uh.value,qh.value,$h.value].slice(0,o.length);console.log(Uh.value,qh.value),console.log(a,a.length),a.forEach(((e,t)=>{if(void 0!==e){const n=Number(e),s=Number(o[t]);console.log(n),console.log(s),i+=n*s,console.log(i+" totalCostForHotelRooms for 1 night")}})),console.log(i+" totalCostForHotelRooms for 1 night"),console.log(`for${Qh} nights ${i*Qh}`),"Sheet1"===s?(Qh!==ad&&(Qh=ad),console.log(Qh+" total nights reduced to "+nd+" normal days as it is sheet 1"),Qh=nd):(Qh!==ad&&(Qh=ad),console.log(Qh+" total nights reduced to "+td+" blocked day as it is sheet 2"),Qh=td),sd.push(i*Qh),console.log("trackroomAndFoodCost "+sd),i=sd.slice(0,2).reduce(((e,t)=>e+t),0),console.log("The sum is: "+i),console.log("sightSeeingCost "+jh),console.log("costForPickandDrop "+zh),console.log(" costForAddon :"+Gh*Jh);const l=function(){const e=document.querySelectorAll(".it");Zh=0,e.forEach((e=>{void 0===e&&(e=0),id.push(Number(e.value))})),console.log(id);const t=[120,150,150];for(let e=0;e<t.length;e++)Zh+=t[e]*id[e]*Gh;return console.log(Gh),Zh}();console.log("south indian food "+l),Wh=Qh*(Wh+i),console.log(document.getElementById("hotel-type-id").selectedIndex);const c=document.getElementById("service-id").value;if(5!==document.getElementById("hotel-type-id").selectedIndex)cd=i+jh+zh+Gh*Jh,ud=cd/Gh,ld=ud+Number(c),0===document.getElementById("food-id").selectedIndex&&(cd=i*Qh+jh+zh+l+Gh*Jh),mf(cd,ld);else{let e="",t=i*Qh+jh+zh+Gh*Jh;for(const n of Kh){const s=n.slice(-4),i=n.slice(0,-4);console.log(Number(s),i),e+=`Package ${i} ${Number(s)+t} \n`,console.log(e),document.getElementById("result").innerHTML=`<pre style="text-align: left">${e} </pre>`}}console.log("-------------------End of 3rd event listner------------------")}))}(0,n,s,e),console.log(a);n.firstChild;)n.removeChild(n.firstChild);a.forEach((e=>{const t=document.createElement("option");t.value=e,t.text=e,n.appendChild(t)}))}))})).catch((e=>{console.error(e)}))}function jd(e){console.log(ed+"isblockdate"),0!=td&&(console.log("blocked date is true"),Fd="Sheet2",$d(Fd,e),Ud(Fd)),0!=nd&&(console.log("normal date is true"),Fd="Sheet1",$d(Fd,e),Ud(Fd)),console.log("i am using "+Fd)}const zd=document.getElementById("hotel-type-id");function Hd(e,t){console.log("i am inside filtered hotel"),console.log(e);let n=6,s=11,i=16,r=21;5!==zd.selectedIndex&&(n=4,s=7,i=10,r=13),Xh=e[0];const o=[e.slice(1,n),e.slice(n,s),e.slice(s,i),e.slice(i,r)];console.log(o);const a=o[t].filter(((e,t)=>"NULL"!==e));return console.log("+++++++++++++++++++++++++++++++++++"),console.log(a,a.length,typeof a),a.length>0&&(Kh=a[0].split("|"),console.log(Kh)),console.log("+++++++++++++++++++++++++++++++++++"),a}let Kd,Gd,Qd;zd.selectedIndex=-1,zd.addEventListener("change",(function(e){switch(document.getElementById("twoshare").value=document.getElementById("threeshare").value=document.getElementById("fourshare").value=0,console.log(this.selectedIndex),this.selectedIndex){case 0:jd("A16:M29");break;case 1:jd("A33:M41");break;case 2:jd("A45:M48");break;case 3:jd("A52:M59");break;case 5:Od="1KP1-2HrfPObwMr4_IIEuuS0Vpk_KObKfog7qArUbhxk",Fd="Sheet1",Vd="AIzaSyAiexK0EyyHNWViGEp29zbkCwTnklGYvVc";break;default:console.log("no matching")}})),document.querySelector(".hotel").addEventListener("click",(function(e){const t=document.querySelector(".fourshare-insert"),n=document.createElement("span");for(console.log(zd.selectedIndex);t.nextElementSibling;)console.dir(t.nextElementSibling),t.nextElementSibling.remove();5===zd.selectedIndex?(t.insertAdjacentElement("afterend",n),n.innerHTML='\n    <label class="text" for="fiveshare">5 Sharing</label>\n\n    <select name="fiveshare" id="fiveshare">\n      <option value="0">0</option>\n      <option value="1">1</option>\n      <option value="2">2</option>\n      <option value="3">3</option>\n      <option value="4">4</option>\n      <option value="5">5</option>\n      <option value="6">6</option>\n      <option value="7">7</option>\n      <option value="8">8</option>\n    </select>'):console.log(t.nextElementSibling)})),document.querySelector(".fill").addEventListener("click",(function(){document.getElementById("no-of-persons").value=100,document.getElementById("check-in").value="2023-07-16",document.getElementById("check-out").value="2023-07-19"})),document.getElementById("food-id").addEventListener("change",(function(){console.log("reading");let e=document.querySelector(".south-indian-food");0===this.selectedIndex?(console.log(e),e.style.maxHeight=e.style.maxHeight?null:e.scrollHeight+"px"):(console.log(e),e.style.maxHeight=null)}));let Wd=[];const Xd=new Date;function Yd(e,t,n){Kd=e,Gd=t;const s=new Date(Kd,Gd+1,0).getDate(),i=new Date(Kd,Gd,1).getDay();Wd=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"in"===n&&(Qd=document.querySelector(".table-date"),Qd.innerHTML="",document.getElementById("date-text").textContent=`${Wd[Gd]} ${Kd}`,Jd.textContent=`${Wd[Gd]} ${Kd}`),"out"===n&&(Qd=document.querySelector(".table-date-out"),Qd.innerHTML="",document.getElementById("date-text-out").textContent=`${Wd[Gd]} ${Kd}`,Zd.textContent=`${Wd[Gd]} ${Kd}`);const r=Qd.insertRow();["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].forEach((e=>{r.insertCell().textContent=e}));let o=1;for(let e=0;e<6;e++){const t=Qd.insertRow();for(let n=0;n<7;n++)if(0===e&&n<i)t.insertCell().textContent="";else if(o>s)t.insertCell().textContent="";else{const e=t.insertCell();e.textContent=o,e.dataset.date=new Date(Kd,Gd,o).toISOString().slice(0,10);const n=Xd.toISOString().slice(0,10);e.dataset.date===n&&(console.log(n),e.classList.add("today")),e.dataset.date<n&&e.classList.add("past-date"),fd.forEach((t=>{e.dataset.date===t&&e.classList.add("block-dates")})),o++}}}console.log("today "+Xd);const Jd=document.getElementById("blur-text"),Zd=document.querySelector(".blur-month-out");function ef(e){let t="";console.log(e.target.className),"btn nav-arrow-in"===e.target.className&&(Qd=document.querySelector(".table-date"),Qd.innerHTML="",t="in",console.log(t),Gd=new Date(`${this.previousElementSibling.textContent} 1`).getMonth()),"btn nav-arrow-out"===e.target.className&&(Qd=document.querySelector(".table-date-out"),Qd.innerHTML="",t="out",console.log(t),Gd=new Date(`${this.previousElementSibling.textContent} 1`).getMonth(),console.log(new Date(`${this.previousElementSibling.textContent} 1`).getDate())),console.log("before Clicking: "+Gd),e.preventDefault(),11===Gd&&(console.log(`this is the ${Gd} month`),Gd=-1,Kd++),Gd+=1,console.log("after Clicking: "+Gd),Yd(Kd,Gd,t)}function tf(e){e.preventDefault();let t="";console.log("btn nav-arrow-in"===e.target.className),"btn nav-arrow-in"===e.target.className&&(Qd=document.querySelector(".table-date"),Qd.innerHTML="",t="in",console.log(t),Gd=new Date(`${this.nextElementSibling.textContent} 1`).getMonth()),"btn nav-arrow-out"===e.target.className&&(Qd=document.querySelector(".table-date-out"),Qd.innerHTML="",t="out",console.log(t),Gd=new Date(`${this.nextElementSibling.textContent} 1`).getMonth()),console.log(Gd),0===Gd&&(console.log(`this is the ${Gd} month`),Gd=12,Kd--),Gd-=1,Yd(Kd,Gd,t)}Yd(Xd.getFullYear(),Xd.getMonth(),"in"),Yd(Xd.getFullYear(),Xd.getMonth(),"out"),document.getElementById("next-month").addEventListener("click",ef),document.getElementById("next-month-out").addEventListener("click",ef),document.getElementById("pre-month").addEventListener("click",tf),document.getElementById("pre-month-out").addEventListener("click",tf);const nf=document.querySelector(".test"),sf=document.querySelector(".test-right");function rf(e){e.preventDefault();let t="";console.log(e.target.className),"test show"===e.target.className&&(Qd=document.querySelector(".table-date"),Qd.innerHTML="",t="in",console.log(t),Gd=new Date(`${document.getElementById("pre-month").nextElementSibling.textContent} 1`).getMonth()),"test test-out show"===e.target.className&&(console.log("reading"),Qd=document.querySelector(".table-date"),Qd.innerHTML="",t="out",console.log(t),Gd=new Date(`${document.getElementById("pre-month-out").nextElementSibling.textContent} 1`).getMonth(),console.log(Gd)),0===Gd&&(console.log(`this is the ${Gd} month`),Gd=12,Kd--),Gd-=1,Yd(Kd,Gd,t)}function of(e){e.preventDefault();let t="";console.log(e.target.className),"test-right show"===e.target.className&&(Qd=document.querySelector(".table-date"),Qd.innerHTML="",t="in",console.log(t),Gd=new Date(`${document.getElementById("next-month").previousElementSibling.textContent} 1`).getMonth()),"test-right test-right-out show"===e.target.className&&(Qd=document.querySelector(".table-date-out"),Qd.innerHTML="",t="out",console.log(t),Gd=new Date(`${document.getElementById("next-month-out").previousElementSibling.textContent} 1`).getMonth()),11===Gd&&(console.log(`this is the ${Gd} month`),Gd=-1,Kd++),Gd+=1,console.log("after Clicking: "+Gd),Yd(Kd,Gd,t)}nf.addEventListener("click",rf),document.querySelector(".test-out").addEventListener("click",rf),sf.addEventListener("click",of),document.querySelector(".test-right-out").addEventListener("click",of);const af=document.getElementById("date-text"),lf=document.getElementById("date-text-out"),cf=document.querySelector(".overlay");function uf(e){e.preventDefault(),console.log(e.target.className),"btn month-in"===e.target.className?(document.querySelector(".table-date").classList.toggle("show"),cf.style.display="block",nf.classList.toggle("show"),sf.classList.toggle("show"),document.querySelector(".blur-month").classList.toggle("show"),document.querySelector(".tebut").classList.add("show")):(document.querySelector(".table-date-out").classList.toggle("show"),document.querySelector(".tebut-out").classList.add("show"),document.querySelector(".test-out").classList.add("show"),document.querySelector(".test-right-out").classList.add("show"),document.querySelector(".blur-month-out").classList.add("show"),cf.style.display="block")}function hf(e){if(e.target.closest(".table-date")){document.querySelector(".table-date").classList.remove("show"),nf.classList.remove("show"),sf.classList.remove("show"),document.querySelector(".blur-month").classList.remove("show"),cf.style.display="none",console.log(e.target.textContent);const t=e.target.textContent;document.getElementById("date-text").textContent=`${t} ${Wd[Gd]} ${Kd}`}if(e.target.closest(".table-date-out")){document.querySelector(".table-date-out").classList.remove("show"),cf.style.display="none",console.log(e.target);const t=e.target.textContent;document.querySelector(".tebut-out").classList.remove("show"),document.querySelector(".test-out").classList.remove("show"),document.querySelector(".test-right-out").classList.remove("show"),document.querySelector(".blur-month-out").classList.remove("show"),document.getElementById("date-text-out").textContent=`${t} ${Wd[Gd]} ${Kd}`}}af.addEventListener("click",uf),lf.addEventListener("click",uf),document.querySelector(".table-date").addEventListener("click",hf),document.querySelector(".table-date-out").addEventListener("click",hf);let df=[],ff=[];function gf(e){e.preventDefault();const t=window.prompt("Enter Customer name:"),n=window.prompt("Enter Customer Location"),s=window.prompt("Enter Travel Assistant Name"),i=window.prompt("Enter translator Language");console.log(cd,Gh,ld);let r="pickup drop service ",o=`${Qh} Nights Accommodation in AC Rooms with Swimming Pool Resorts in North Goa, near Calangute Beach`,a="All Days On Restaurant - Map  Times Times",l="Sight Seeing Service North Goa and South Goa",c=`Local ${i} Speaking Coordinator assistance 24/7 over the course of your stay. `,u="Basic Medical Support with Free Taxi service for near by Hospital is also Included in this Package.";const h=document.getElementById("food-id").selectedIndex;let d=[],f=[],g=[];""===Dd.value&&""===Nd.value||(console.log("changing the pickup and drop value"),r=`Pickup service from ${Dd.value} , Drop service to ${Nd.value}`,od=!0);let m=dd("food-id"),p=Qh*Number(h);if(console.log(id),console.log("0"===h),console.log(h),0===h){m="South Indian Food";let e=0;document.querySelectorAll(".it").forEach((t=>{void 0===t&&(t=0),e=Number(t.value)+e})),p=e,console.log("countOfFood "+p)}console.log(m),a=`All Days On Restaurant ${m} - Map ${p} Times`;let y="";for(const e of hd)if(e.checked){y=e.value,rd=!0,console.log(y);break}rd&&(l=`${Qh+1} days North Goa & South Goa Sightseeing by ${y}`),console.log(r,l),g=[od,rd,""];let v=[r,l];d=[o,a,c,u],g.forEach(((e,t)=>{!0===e&&d.splice(2,0,v[t])})),f=[r,o,a,l,c,u,"Two way Train Tickets from your Hometown to Goa, Round Trip Flight ","Gst 5%","Alcoholic beverages","Any activities not specifically mentioned in the inclusions"].filter((e=>!d.includes(e))),console.log(f);let w={header:{stack:[{image:dataURL,width:600,height:120,alignment:"center"}],margin:[-20,0]},content:[{text:'"Sun-Kissed Delights: Unveiling the Best of Goa - Customized Quotation"',style:"header",relativePosition:{x:0,y:140}},{text:"Dear Brother/Sister,",relativePosition:{x:0,y:250}},{text:"Thank you for considering Tick your Tour Private Limited for your upcoming trip to Goa. We are delighted to present you with a customized quotation for our exciting Goa Package. Please find the details below.",relativePosition:{x:0,y:270}},{table:{widths:[250,250],heights:[30,30,30,30,30,30,30],body:[["Date",`${Xd.toISOString().slice(0,10)}`],["Name ",`${t}`],["Location ",`${n}`],["Number of travellers ",`${Gh}`],["Duration ",`${Qh} Nights/${Qh+1} days`],["Travel Assissant Name ",`${s}`],["Tour Date ",`${document.getElementById("date-text").textContent}`]]},relativePosition:{x:0,y:350},color:"blue"},{text:"Inclusions :",color:"red",fontSize:15,pageBreak:"before",relativePosition:{x:0,y:100}},{ul:d,relativePosition:{x:10,y:120}},{text:"Exclusions :",color:"red",fontSize:15,relativePosition:{x:0,y:250}},{ul:f,relativePosition:{x:10,y:270}},{table:{widths:[250,250],heights:[30,30,30,30,30,30,30],body:[["Type of Package",`${dd("hotel-type-id")}`],["Hotel Options",`${dd("hotel-id")}`],["Number of Rooms ","Another one here"],["Travelling ","No Train/Flight/Bus"],["Package Price Per Head ","Rs "+cd/Gh],["GST 5% ",`Rs ${.05*ld+ld}`],["Total Package Price Including GST ",`Rs ${.05*ld+cd}`]]},relativePosition:{x:0,y:400},color:"blue",bold:!0},{text:'"Fun in the Sun: Comic Capers in Coastal Playground of Goa!"',pageBreak:"before",color:"red",fontSize:"14",alignment:"center",relativePosition:{x:0,y:100}},{table:{widths:[200,300],heights:[10,30,30,30,30,30,30],body:[[{image:agodaFort,fit:[200,200]},{text:"Aguda Fort: Prepare for a blast from the past at Aguda Fort! This ancient stronghold has seen it all - from fierce battles to jaw-dropping views. It is the perfect spot to channel your inner history buff while enjoying some fort-ified fun!"}],[{image:anjunaBeach,fit:[200,200]},{text:"Anjuna Beach: Get ready to beach out at Anjuna Beach! Known for its lively flea markets, bohemian vibes, and groovy beach parties, this place is a haven for free spirits and dancing souls. Do not forget your dancing shoes and your inner hippie!"}],[{image:bagaBeach,fit:[200,200]},{text:"Baga Beach: Prepare yourself for a beach experience like no other at Baga Beach! From thrilling water sports that will make your heart race to vibrant beach shacks serving up lip-smacking seafood, this place will have you saying, Baga, please!"}],[{image:calBeach,fit:[200,200]},{text:"Calangute Beach: Calangute Beach is the epitome of beach bliss! Sun, sand, and a never-ending carousel of water sports await you. So grab your sunscreen, put on your coolest shades, and get ready to make waves of unforgettable memories!"}]]},pageBreak:"after",relativePosition:{x:0,y:130}},{text:"Payment Policy",alignment:"center",fontSize:20,color:"red",relativePosition:{x:0,y:80}},{table:{body:[[{text:"Step 1: Plan your Travel Date",color:"blue"}],["Choose your preferred travel dates for a memorable journey. Our team will assist you in securing the best discounted prices for flights, trains, or buses, ensuring a cost-effective and convenient travel experience."]]},layout:"noBorders",relativePosition:{x:0,y:120}},{table:{body:[[{text:"Step 2: Provide Co-Traveler Details",color:"blue"}],["Please prepare a list of co-travelers names along with their valid government ID proof. This information is essential for a smooth booking process and ensures compliance with travel regulations."]]},layout:"noBorders",relativePosition:{x:0,y:200}},{table:{body:[[{text:"Step 3: Secure your Booking with a Token Advance",color:"blue"}],["To confirm your trip, a token advance of ₹1500 is required. This advance payment guarantees your reservation and allows us to make the necessary arrangements to provide you with a seamless travel experience."]]},layout:"noBorders",relativePosition:{x:0,y:280}},{table:{body:[[{text:"Step 4: Payment Options",color:"blue"}],["The remaining balance can be paid at the time of your travel, providing you with flexibility and convenience. Alternatively, you can also visit one of our nearby Tick your Tour offices to confirm your tour by making a direct payment"]]},layout:"noBorders",relativePosition:{x:0,y:360}},{table:{body:[[{text:"Account Details ",color:"red",alignment:"center"}],[{text:"Account Number : 234805000946\nAccount Holder is name : TICK YOUR TOUR PRIVATE LIMITED\nUPI : tickyourtour@Icici\nIFSC Code: ICIC0002348",alignment:"center"}]]},alignment:"center",relativePosition:{x:95,y:500},pageBreak:"after"},{text:"Terms & Conditions",alignment:"center",fontSize:20,color:"red",relativePosition:{x:0,y:80}},{image:termsAndCond,relativePosition:{x:0,y:120},width:530},{text:"Cancellation Policy",relativePosition:{x:0,y:600},color:"red"},{ul:["90% Refund if canceled 30 days prior to scheduled arrival.","70% refund, if canceled more than 15 days prior to scheduled arrival (but less than 30 days)","50% refund  if canceled more than 15 days prior to scheduled arrival.","No refund, if canceled less than 7 days prior to scheduled arrival.","During the Trip if canceled there will be No Refund.","Incase of refund the refund period would be 15 days (working)"],relativePosition:{x:0,y:620},margin:[15,0],pageBreak:"after"},{text:["Thank you for considering",{text:" Tick your Tour",color:"red"}," for your Goa Package! We have carefully crafted a customized quotation to ensure an unforgettable experience. Should you have any questions or need further information, please do not hesitate to contact us. We value your trust and would greatly appreciate it if you could provide a reference for our services. We look forward to serving you and creating lasting memories."],relativePosition:{x:0,y:300},fontSize:15},{text:"Our Branches ",relativePosition:{x:0,y:600},color:"red"},{ul:["Chennai : 23/1, Ground Floor, Alagiri Nagar 5th Street, Vadapalani, Chennai – 600023 ","Kochi : 2422, Bank Rd, Kaloor, Kochi, Kerala 682017"],relativePosition:{x:0,y:620},margin:[15,0]}],styles:{header:{bold:!0,fontSize:23,alignment:"center",color:"red"}}};pdfMake.createPdf(w).download("Goa_Booking.pdf")}function mf(e,t){const n=document.querySelector(".overlay"),s=document.querySelector(".message-card");n.style.display="block",s.style.display="block",document.getElementById("result-test").innerHTML=`<h1 style="\n  background: black;\n  color: white;\n  padding-left: 25%;\n">Packge Cost</h1>\n<table class="tbl-result" style="\n  border: none;\n"><tbody><tr><td>The Cost of your Customised Package is</td> <td class="rate"> Rs ${e}</td></tr>\n<tr><td>The cost per head is </td> <td class="rate"> Rs ${e/Gh}</td>\n\n</tr><tr><td>The cost per head including service charge </td> <td class="rate"> Rs ${t}</td></tr>\n<tr><td>The cost per head including Service and GST </td> <td class="rate"> Rs ${.05*t+t} </td></tr></tbody></table>`,document.querySelector(".btn-close").addEventListener("click",(function(){n.style.display="none",s.style.display="none"}))}document.querySelector(".date-in-out").addEventListener("click",(function(e){let t=document.querySelector(".table-date"),n=document.querySelector(".table-date-out");const s=e.target.getAttribute("data-date");if(e.target.closest(".table-date")){t=s,console.log("dateIn "+t);const i=new Date(t);console.log("inDate "+i),df.push(i),ff.push(t)}else if(e.target.closest(".table-date-out")){n=s,console.log(n);const r=new Date(n);df.push(r),ff.push(n)}if(console.log("calenderDates "+df),df.length>1){const o=df[0];let a=df[1].getTime()-o.getTime();function l(e,t){const n=[],s=new Date(e),i=new Date(t);for(;s<i;){const e=`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}-${String(s.getDate()+1).padStart(2,"0")}`;console.log(e),n.push(e),s.setDate(s.getDate()+1)}return n}Qh=Math.ceil(a/864e5),console.log("Nights: "+Qh),ad=Qh;const c=l(ff[0],ff[1]);function u(e,t){return c.filter((e=>t.includes(e))).length}console.log(c),td=u(0,fd),console.log("total block dates "+td),nd=Qh-td,console.log("normal dates "+nd)}for(const h of fd)if(s===h)return ed=!0,Fd="Sheet2",Ud(Fd),Fd;return Fd="Sheet1",ed=!1,Ud(Fd),Fd})),document.addEventListener("DOMContentLoaded",(function(){document.getElementById("generate-pdf-btn").addEventListener("click",gf)})),document.querySelector(".Submit").addEventListener("click",mf),te({apiKey:"AIzaSyBPIn98znYDQH3TPSQBJiQ2AIwjYZLKy3U",authDomain:"goa-firebase.firebaseapp.com",projectId:"goa-firebase",storageBucket:"goa-firebase.appspot.com",messagingSenderId:"497483938786",appId:"1:497483938786:web:9f5c35eb43c32d0736d7bb",measurementId:"G-CB36YB3SJN"});const pf=function(e,t,...n){if(e=f(e),Wu("collection","path",t),e instanceof th){const s=cr.fromString(t,...n);return Yu(s),new ih(e,null,s)}{if(!(e instanceof sh||e instanceof ih))throw new Ki(Hi.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=e._path.child(cr.fromString(t,...n));return Yu(s),new ih(e.firestore,null,s)}}(function(e,t){const n=function(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}(function(e=G){const t=W.get(e);if(!t&&e===G&&o())return te();if(!t)throw Z.create("no-app",{appName:e});return t}(),"firestore").getImmediate({identifier:"(default)"});if(!n._initialized){const e=(e=>{const t=(e=>{var t,n;return null===(n=null===(t=r())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]})(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const s=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),s]:[t.substring(0,n),s]})("firestore");e&&function(e,t,n,s={}){var r;const o=(e=Zu(e,th))._getSettings(),a=`${t}:${n}`;if("firestore.googleapis.com"!==o.host&&o.host!==a&&Ui("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),e._setSettings(Object.assign(Object.assign({},o),{host:a,ssl:!1})),s.mockUserToken){let t,n;if("string"==typeof s.mockUserToken)t=s.mockUserToken,n=Mi.MOCK_USER;else{t=function(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",s=e.iat||0,r=e.sub||e.user_id;if(!r)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:s,exp:s+3600,auth_time:s,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}}},e);return[i(JSON.stringify({alg:"none",type:"JWT"})),i(JSON.stringify(o)),""].join(".")}(s.mockUserToken,null===(r=e._app)||void 0===r?void 0:r.options.projectId);const o=s.mockUserToken.sub||s.mockUserToken.user_id;if(!o)throw new Ki(Hi.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new Mi(o)}e._authCredentials=new Xi(new Qi(t,n))}}(n,...e)}return n}(),"login");(function(e){e=Zu(e,nh);const t=Zu(e.firestore,oh),n=ah(t),s=new Vh(t);return function(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new Ki(Hi.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(e._query),Ku(n,e._query).then((n=>new Oh(t,s,e,n)))})(pf).then((e=>{let t=[];e.docs.forEach((e=>{t.push({...e.data(),id:e.id})})),console.log(t)})).catch((e=>{console.log(e.message)})),document.querySelector(".Submit").addEventListener("click",(e=>{e.preventDefault(),Bh(pf,{paxNumber:noOfPersons,totalNights:Qh})}))})();